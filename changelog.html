<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>变更日志 - PyO3 user guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/tabs-52f01167.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-78070eb0.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-c528a6fa.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">PyO3 user guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/tree/main/guide" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/edit/main/guide/src/changelog.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="更新日志"><a class="header" href="#更新日志">更新日志</a></h1>
<p>所有对本项目的重要更改都将记录在此文件中。有关更新到新版本 PyO3 的帮助，请参阅<a href="https://pyo3.rs/latest/migration.html">迁移指南</a>。</p>
<p>该格式基于 <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a>，本项目遵循 <a href="https://semver.org/spec/v2.0.0.html">语义化版本控制</a>。</p>
<p>要查看尚未发布的更改，请参阅 <a href="https://pyo3.rs/main/changelog.html">主分支上的更新日志指南</a>。</p>
<!-- towncrier release notes start -->
<h2 id="0272---2025-11-30"><a class="header" href="#0272---2025-11-30">[0.27.2] - 2025-11-30</a></h2>
<h3 id="更改"><a class="header" href="#更改">更改</a></h3>
<ul>
<li>禁用在 GraalPy 上对 <code>PyDict</code> 的子类化（目前不支持，可能在运行时崩溃）。<a href="https://github.com/PyO3/pyo3/pull/5653">#5653</a></li>
</ul>
<h3 id="修复"><a class="header" href="#修复">修复</a></h3>
<ul>
<li>修复在 Rust 1.92+ 上启用 debug 断言和优化时编译导致的崩溃问题。<a href="https://github.com/PyO3/pyo3/pull/5638">#5638</a></li>
<li>修复 PyPy 上 <code>PyDictObject</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/5653">#5653</a></li>
</ul>
<h2 id="0271---2025-10-21"><a class="header" href="#0271---2025-10-21">[0.27.1] - 2025-10-21</a></h2>
<h3 id="修复-1"><a class="header" href="#修复-1">修复</a></h3>
<ul>
<li>修复 <code>#[pyfunction]</code> 引起的 <code>clippy:declare_interior_mutable_const</code> 警告。<a href="https://github.com/PyO3/pyo3/pull/5538">#5538</a></li>
<li>在公共 API 中暴露 <code>pyo3::types::PySendResult</code>。<a href="https://github.com/PyO3/pyo3/pull/5539">#5539</a></li>
</ul>
<h2 id="0270---2025-10-19"><a class="header" href="#0270---2025-10-19">[0.27.0] - 2025-10-19</a></h2>
<h3 id="打包"><a class="header" href="#打包">打包</a></h3>
<ul>
<li>扩展可选依赖 <code>hashbrown</code> 支持的版本范围，包含 0.16 版本。<a href="https://github.com/PyO3/pyo3/pull/5428">#5428</a></li>
<li>将可选依赖 <code>num-bigint</code> 的最低版本提升至 0.4.4。<a href="https://github.com/PyO3/pyo3/pull/5471">#5471</a></li>
<li>增加对 Python 3.14 正式版的测试。<a href="https://github.com/PyO3/pyo3/pull/5499">#5499</a></li>
<li>停止支持 PyPy 3.9 和 3.10。<a href="https://github.com/PyO3/pyo3/pull/5516">#5516</a></li>
<li>在用旧版本 PyO3 构建过新 Python 版本时提供更清晰的错误信息。<a href="https://github.com/PyO3/pyo3/pull/5519">#5519</a></li>
</ul>
<h3 id="新增"><a class="header" href="#新增">新增</a></h3>
<ul>
<li>添加 <code>FromPyObjectOwned</code>，在数据未从 Python 借用时，作为 <code>FromPyObject</code> 的便捷 trait 约束。<a href="https://github.com/PyO3/pyo3/pull/4390">#4390</a></li>
<li>添加 <code>Borrowed::extract</code>，与 <code>PyAnyMethods::extract</code> 相同，但不会因解引用而限制生命周期。<a href="https://github.com/PyO3/pyo3/pull/4390">#4390</a></li>
<li><code>experimental-inspect</code>：基础支持 <code>#[derive(IntoPyObject)]</code>（暂不支持结构体字段）。<a href="https://github.com/PyO3/pyo3/pull/5365">#5365</a></li>
<li><code>experimental-inspect</code>：支持 <code>#[pyo3(get, set)]</code> 和 <code>#[pyclass(get_all, set_all)]</code>。<a href="https://github.com/PyO3/pyo3/pull/5370">#5370</a></li>
<li>添加 <code>PyTypeCheck::classinfo_object</code>，返回可用于 <code>isinstance</code> 或 <code>issubclass</code> 的对象。<a href="https://github.com/PyO3/pyo3/pull/5387">#5387</a></li>
<li>即使启用受限 API，也在 <code>datetime.*</code> 类型上实现 <code>PyTypeInfo</code>。<a href="https://github.com/PyO3/pyo3/pull/5388">#5388</a></li>
<li>在 <code>PyIterator</code>、<code>PyMapping</code> 和 <code>PySequence</code> 上实现 <code>PyTypeInfo</code>。<a href="https://github.com/PyO3/pyo3/pull/5402">#5402</a></li>
<li>在使用稳定 ABI 时，为 <code>PyCode</code> 实现 <code>PyTypeInfo</code>。<a href="https://github.com/PyO3/pyo3/pull/5403">#5403</a></li>
<li>在使用稳定 ABI 时，为 <code>PyWeakrefReference</code> 实现 <code>PyTypeInfo</code>。<a href="https://github.com/PyO3/pyo3/pull/5404">#5404</a></li>
<li>添加 <code>pyo3::sync::RwLockExt</code> trait，类似于 <code>pyo3::sync::MutexExt</code>，但用于读写锁。<a href="https://github.com/PyO3/pyo3/pull/5435">#5435</a></li>
<li>添加 <code>PyString::from_bytes</code>。<a href="https://github.com/PyO3/pyo3/pull/5437">#5437</a></li>
<li>为 <code>PyBytes</code> 实现 <code>AsRef&lt;[u8]&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/5445">#5445</a></li>
<li>添加 <code>CastError</code> 和 <code>CastIntoError</code>。<a href="https://github.com/PyO3/pyo3/pull/5468">#5468</a></li>
<li>添加 <code>PyCapsuleMethods::pointer_checked</code> 和 <code>PyCapsuleMethods::is_valid_checked</code>。<a href="https://github.com/PyO3/pyo3/pull/5474">#5474</a></li>
<li>添加 <code>Borrowed::cast</code>、<code>Borrowed::cast_exact</code> 和 <code>Borrowed::cast_unchecked</code>。<a href="https://github.com/PyO3/pyo3/pull/5475">#5475</a></li>
<li>添加对 <code>jiff::civil::ISOWeekDate</code> 的转换支持。<a href="https://github.com/PyO3/pyo3/pull/5478">#5478</a></li>
<li>添加对 <code>&amp;Cstr</code>、<code>Cstring</code> 和 <code>Cow&lt;Cstr&gt;</code> 的转换支持。<a href="https://github.com/PyO3/pyo3/pull/5482">#5482</a></li>
<li>添加 <code>#[pyclass(skip_from_py_object)]</code> 选项，用于取消 <code>FromPyObject: PyClass + Clone</code> 的默认实现。<a href="https://github.com/PyO3/pyo3/pull/5488">#5488</a></li>
<li>添加 <code>PyErr::add_note</code>。<a href="https://github.com/PyO3/pyo3/pull/5489">#5489</a></li>
<li>为 <code>Cow&lt;Path&gt;</code> 和 <code>Cow&lt;OsStr&gt;</code> 添加 <code>FromPyObject</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/5497">#5497</a></li>
<li>添加 <code>#[pyclass(from_py_object)]</code> pyclass 选项，允许按值提取 pyclass（需要 <code>Clone</code>）。<a href="https://github.com/PyO3/pyo3/pull/5506">#5506</a></li>
</ul>
<h3 id="更改-1"><a class="header" href="#更改-1">更改</a></h3>
<ul>
<li>重构 <code>FromPyObject</code> trait 以提高灵活性和性能：<a href="https://github.com/PyO3/pyo3/pull/4390">#4390</a>
<ul>
<li>为 <code>FromPyObject</code> 添加第二个生命周期，以允许从 Python 对象借用数据（例如，从 Python <code>str</code> 借用 <code>&amp;str</code>）。</li>
<li>使用 <code>extract</code> 代替 <code>extract_bound</code>，现在接受 <code>Borrowed&lt;'a, 'py, PyAny&gt;</code>。</li>
</ul>
</li>
<li>优化 <code>bytes</code> 和 <code>bytearray</code> 类型的 <code>Vec&lt;u8&gt;</code> 和 <code>[u8; N]</code> 的 <code>FromPyObject</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/5244">#5244</a></li>
<li>弃用 <code>#[pyfn]</code> 属性。<a href="https://github.com/PyO3/pyo3/pull/5384">#5384</a></li>
<li>在类型转换失败时动态获取类型名称，而非使用 <code>PyTypeCheck::NAME</code>。<a href="https://github.com/PyO3/pyo3/pull/5387">#5387</a></li>
<li>弃用 <code>PyTypeCheck::NAME</code>，推荐使用可运行时提供类型信息的 <code>PyTypeCheck::classinfo_object</code>。<a href="https://github.com/PyO3/pyo3/pull/5387">#5387</a></li>
<li>现在 <code>PyClassGuard(Mut)</code> 和 <code>PyRef(Mut)</code> 的提取会返回一个不透明的 Rust 错误。<a href="https://github.com/PyO3/pyo3/pull/5413">#5413</a></li>
<li>使用 <code>#[pymodule_use]</code> 导出实现 <code>PyTypeInfo</code> 的类型时，动态获取类型名称。<a href="https://github.com/PyO3/pyo3/pull/5414">#5414</a></li>
<li>改进 <code>PyBuffer&lt;T&gt;</code> 的 <code>Debug</code> 输出格式。<a href="https://github.com/PyO3/pyo3/pull/5442">#5442</a></li>
<li><code>experimental-inspect</code>：修改二进制文件中的内省数据生成方式，避免指针间接并简化解析。<a href="https://github.com/PyO3/pyo3/pull/5450">#5450</a></li>
<li>针对附加到 Python 解释器的情况优化 <code>Py&lt;T&gt;::drop</code>。<a href="https://github.com/PyO3/pyo3/pull/5454">#5454</a></li>
<li>使用 <code>CastError</code> 和 <code>CastIntoError</code> 替代 <code>DowncastError</code> 和 <code>DowncastIntoError</code>。<a href="https://github.com/PyO3/pyo3/pull/5468">#5468</a></li>
<li>在 <code>GraalPy</code> 上为 128 位整数转换启用快速路径。<a href="https://github.com/PyO3/pyo3/pull/5471">#5471</a></li>
<li>弃用 <code>PyAnyMethods::downcast</code>，推荐使用 <code>Bound::cast</code>。<a href="https://github.com/PyO3/pyo3/pull/5472">#5472</a></li>
<li>将 <code>PyTypeCheck</code> 设为 <code>unsafe trait</code>。<a href="https://github.com/PyO3/pyo3/pull/5473">#5473</a></li>
<li>弃用不安全的 <code>PyCapsuleMethods</code> 方法：<code>pointer()</code>、<code>reference()</code> 和 <code>is_valid()</code>。<a href="https://github.com/PyO3/pyo3/pull/5474">#5474</a></li>
<li>缩短 <code>PyCapsuleMethods::reference</code> 返回值的生命周期。<a href="https://github.com/PyO3/pyo3/pull/5474">#5474</a></li>
<li><code>PyCapsuleMethods::name</code> 现在返回 <code>CapsuleName</code> 包装类型而非 <code>&amp;CStr</code>。<a href="https://github.com/PyO3/pyo3/pull/5474">#5474</a></li>
<li>弃用 <code>import_exception_bound</code>，推荐使用 <code>import_exception</code>。<a href="https://github.com/PyO3/pyo3/pull/5480">#5480</a></li>
<li><code>PyList::get_item_unchecked</code>、<code>PyTuple::get_item_unchecked</code> 和 <code>PyTuple::get_borrowed_item_unchecked</code> 不再检查索引位置是否为 null 值。<a href="https://github.com/PyO3/pyo3/pull/5494">#5494</a></li>
<li>允许将 naive datetime 转换为 chrono 的 <code>DateTime&lt;Local&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/5507">#5507</a></li>
</ul>
<h3 id="移除"><a class="header" href="#移除">移除</a></h3>
<ul>
<li>移除 <code>FromPyObjectBound</code> trait。<a href="https://github.com/PyO3/pyo3/pull/4390">#4390</a></li>
</ul>
<h3 id="修复-2"><a class="header" href="#修复-2">修复</a></h3>
<ul>
<li>修复在 <code>wasm32-wasip2</code> 上的编译失败问题。<a href="https://github.com/PyO3/pyo3/pull/5368">#5368</a></li>
<li>修复 Windows 上非 UTF-8 字符串的 <code>OsStr</code> 转换问题。<a href="https://github.com/PyO3/pyo3/pull/5444">#5444</a></li>
<li>修复因 git 忽略的构建产物 <code>emscripten/pybuilddir.txt</code> 导致的 <code>cargo vendor</code> 问题。<a href="https://github.com/PyO3/pyo3/pull/5456">#5456</a></li>
<li>停止在 <code>#[pyfunction]</code> 宏生成的代码中泄露 <code>PyMethodDef</code> 实例。<a href="https://github.com/PyO3/pyo3/pull/5459">#5459</a></li>
<li>不再导出 32 位 Python 3.14 上不存在的 FFI 结构体 <code>PyObjectObFlagsAndRefcnt</code> 的定义。<a href="https://github.com/PyO3/pyo3/pull/5499">#5499</a></li>
<li>修复在 Windows 上使用 maturin 内置 sysconfig 结合 <code>generate-import-lib</code> 功能构建 <code>abi3</code> 解释器时的失败问题。<a href="https://github.com/PyO3/pyo3/pull/5503">#5503</a></li>
<li>修复 PyPy 上 <code>PyModule_ExecDef</code> 和 <code>PyModule_FromDefAndSpec2</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/5529">#5529</a></li>
</ul>
<h2 id="0260---2025-08-29"><a class="header" href="#0260---2025-08-29">[0.26.0] - 2025-08-29</a></h2>
<h3 id="打包-1"><a class="header" href="#打包-1">打包</a></h3>
<ul>
<li>将 <code>hashbrown</code> 依赖升级至 0.15。<a href="https://github.com/PyO3/pyo3/pull/5152">#5152</a></li>
<li>更新最低支持 Rust 版本（MSRV）为 1.74。<a href="https://github.com/PyO3/pyo3/pull/5171">#5171</a></li>
<li>为替代解释器设置与 CPython 相同的最大支持版本。<a href="https://github.com/PyO3/pyo3/pull/5192">#5192</a></li>
<li>添加可选的 <code>bytes</code> 依赖以支持 <code>bytes::Bytes</code> 的转换。<a href="https://github.com/PyO3/pyo3/pull/5252">#5252</a></li>
<li>发布新 crate <code>pyo3-introspection</code>，与 <code>experimental-inspect</code> 功能配套使用。<a href="https://github.com/PyO3/pyo3/pull/5300">#5300</a></li>
<li><code>PYO3_BUILD_EXTENSION_MODULE</code> 现在与 <code>extension-module</code> 功能作用相同。未来 maturin 和 setuptools-rust 将自动设置该环境变量，使用自定义构建系统的用户也需手动设置。<a href="https://github.com/PyO3/pyo3/pull/5343">#5343</a></li>
</ul>
<h3 id="新增-1"><a class="header" href="#新增-1">新增</a></h3>
<ul>
<li>添加 <code>#[pyo3(warn(message = "...", category = ...))]</code> 属性，用于自动为 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 生成警告信息。<a href="https://github.com/PyO3/pyo3/pull/4364">#4364</a></li>
<li>添加 <code>PyMutex</code>，在 Python 3.13 及以上版本可用。<a href="https://github.com/PyO3/pyo3/pull/4523">#4523</a></li>
<li>添加 FFI 定义 <code>PyMutex_IsLocked</code>，在 Python 3.14 及以上版本可用。<a href="https://github.com/PyO3/pyo3/pull/4523">#4523</a></li>
<li>添加 <code>PyString::from_encoded_object</code>。<a href="https://github.com/PyO3/pyo3/pull/5017">#5017</a></li>
<li><code>experimental-inspect</code>：添加基本的输入类型注解支持。<a href="https://github.com/PyO3/pyo3/pull/5089">#5089</a>- 添加来自 CPython 3.13 的 <code>PyFrameObject</code> 的 FFI 函数定义。<a href="https://github.com/PyO3/pyo3/pull/5154">#5154</a></li>
<li><code>experimental-inspect</code>：为使用 <code>#[pymodule]</code> 或 <code>#[pymodule_init]</code> 函数创建的模块标记为不完整状态。<a href="https://github.com/PyO3/pyo3/pull/5207">#5207</a></li>
<li><code>experimental-inspect</code>：添加基本的返回类型支持。<a href="https://github.com/PyO3/pyo3/pull/5208">#5208</a></li>
<li>添加 <code>PyCode::compile</code> 和 <code>PyCodeMethods::run</code> 以创建和执行代码对象。<a href="https://github.com/PyO3/pyo3/pull/5217">#5217</a></li>
<li>添加用于线程安全单次初始化的 <code>PyOnceLock</code> 类型。<a href="https://github.com/PyO3/pyo3/pull/5223">#5223</a></li>
<li>添加 <code>PyClassGuard(Mut)</code> pyclass 持有器，未来将取代 <code>PyRef(Mut)</code>。<a href="https://github.com/PyO3/pyo3/pull/5233">#5233</a></li>
<li><code>experimental-inspect</code>：允许在 <code>#[pyo3(signature)]</code> 签名属性中使用注解。<a href="https://github.com/PyO3/pyo3/pull/5241">#5241</a></li>
<li>为 parking_lot / lock_api 的 <code>ReentrantMutex</code> 实现 <code>MutexExt</code>。<a href="https://github.com/PyO3/pyo3/pull/5258">#5258</a></li>
<li><code>experimental-inspect</code>：支持类关联常量。<a href="https://github.com/PyO3/pyo3/pull/5272">#5272</a></li>
<li>添加替代 <code>PyAnyMethods::downcast</code> 系列函数的 <code>Bound::cast</code> 函数族。<a href="https://github.com/PyO3/pyo3/pull/5289">#5289</a></li>
<li>添加 FFI 定义 <code>Py_Version</code> 和 <code>Py_IsFinalizing</code>。<a href="https://github.com/PyO3/pyo3/pull/5317">#5317</a></li>
<li><code>experimental-inspect</code>：为 <code>#[pyclass]</code> 添加输出类型注解。<a href="https://github.com/PyO3/pyo3/pull/5320">#5320</a></li>
<li><code>experimental-inspect</code>：支持 <code>#[pyclass(eq, eq_int, ord, hash, str)]</code>。<a href="https://github.com/PyO3/pyo3/pull/5338">#5338</a></li>
<li><code>experimental-inspect</code>：为 <code>#[derive(FromPyObject)]</code> 添加基本支持（尚不支持结构体字段）。<a href="https://github.com/PyO3/pyo3/pull/5339">#5339</a></li>
<li>添加 <code>Python::try_attach</code>。<a href="https://github.com/PyO3/pyo3/pull/5342">#5342</a></li>
</ul>
<h3 id="变更"><a class="header" href="#变更">变更</a></h3>
<ul>
<li>对于未使用 <code>#[new]</code> 的 <code>#[pyclass]</code>，在 Python 3.10 及以上版本中使用 <code>Py_TPFLAGS_DISALLOW_INSTANTIATION</code> 替代总是失败的 <code>__new__</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/4568">#4568</a></li>
<li><code>PyModule::from_code</code> 现在若 <code>file_name</code> 为空，则默认为 <code>&lt;string&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4777">#4777</a></li>
<li>弃用 <code>PyString::from_object</code>，推荐使用 <code>PyString::from_encoded_object</code>。<a href="https://github.com/PyO3/pyo3/pull/5017">#5017</a></li>
<li>当使用 <code>abi3</code> 构建且目标 Python 版本高于 PyO3 支持的版本时，自动回退到支持的最新版本的 abi3 构建。<a href="https://github.com/PyO3/pyo3/pull/5144">#5144</a></li>
<li>将 <code>is_instance_of</code> 的 trait bound 从 <code>PyTypeInfo</code> 更改为 <code>PyTypeCheck</code>。<a href="https://github.com/PyO3/pyo3/pull/5146">#5146</a></li>
<li>许多 PyO3 过程宏现在会报告多个错误而非仅第一个。<a href="https://github.com/PyO3/pyo3/pull/5159">#5159</a></li>
<li>更改 <code>MutexExt</code> 的返回类型为关联类型。<a href="https://github.com/PyO3/pyo3/pull/5201">#5201</a></li>
<li>使用 <code>PyCallArgs</code> 实现 <code>Py::call</code> 及其相关函数，使其与对应的 <code>Bound</code> 方法等效。<a href="https://github.com/PyO3/pyo3/pull/5206">#5206</a></li>
<li>将 <code>Python::with_gil</code> 重命名为 <code>Python::attach</code>。<a href="https://github.com/PyO3/pyo3/pull/5209">#5209</a></li>
<li>将 <code>Python::allow_threads</code> 重命名为 <code>Python::detach</code>。<a href="https://github.com/PyO3/pyo3/pull/5221">#5221</a></li>
<li>弃用 <code>GILOnceCell</code> 类型，推荐使用 <code>PyOnceLock</code>。<a href="https://github.com/PyO3/pyo3/pull/5223">#5223</a></li>
<li>将 <code>pyo3::prepare_freethreaded_python</code> 重命名为 <code>Python::initialize</code>。<a href="https://github.com/PyO3/pyo3/pull/5247">#5247</a></li>
<li>在 <code>PyMemoryError</code> 与 <code>io::ErrorKind::OutOfMemory</code> 之间进行转换。<a href="https://github.com/PyO3/pyo3/pull/5256">#5256</a></li>
<li>弃用 <code>GILProtected</code>。<a href="https://github.com/PyO3/pyo3/pull/5285">#5285</a></li>
<li>将 <code>#[pyclass]</code> 文档字符串格式化从导入时移至编译时。<a href="https://github.com/PyO3/pyo3/pull/5286">#5286</a></li>
<li>若 Python 解释器正在关闭，则 <code>Python::attach</code> 现在会触发 panic。<a href="https://github.com/PyO3/pyo3/pull/5317">#5317</a></li>
<li>为 <code>#[pyclass]</code> 类型在 <code>PyTypeInfo::type_object</code> 中添加快速路径。<a href="https://github.com/PyO3/pyo3/pull/5324">#5324</a></li>
<li>弃用 <code>PyObject</code> 作为 <code>Py&lt;PyAny&gt;</code> 的类型别名。<a href="https://github.com/PyO3/pyo3/pull/5325">#5325</a></li>
<li>将 <code>Python::with_gil_unchecked</code> 重命名为 <code>Python::attach_unchecked</code>。<a href="https://github.com/PyO3/pyo3/pull/5340">#5340</a></li>
<li>将 <code>Python::assume_gil_acquired</code> 重命名为 <code>Python::assume_attached</code>。<a href="https://github.com/PyO3/pyo3/pull/5354">#5354</a></li>
</ul>
<h3 id="移除-1"><a class="header" href="#移除-1">移除</a></h3>
<ul>
<li>移除 <code>PyFrameObject</code> 内部结构的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/5154">#5154</a></li>
<li>移除 FFI 定义 <code>PyGetSetDef</code> 的 <code>Eq</code> 和 <code>PartialEq</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/5196">#5196</a></li>
<li>移除私有的 FFI 定义 <code>_Py_IsCoreInitialized</code> 和 <code>_Py_InitializeMain</code>。<a href="https://github.com/PyO3/pyo3/pull/5317">#5317</a></li>
</ul>
<h3 id="修复-3"><a class="header" href="#修复-3">修复</a></h3>
<ul>
<li>在自由线程构建中，<code>PyByteArray::to_vec</code> 使用临界区以模拟 GIL 启用时的“安全性”。<a href="https://github.com/PyO3/pyo3/pull/4742">#4742</a></li>
<li>修复将 <code>bigdecimal</code> 转换为 Python 时的精度丢失问题。<a href="https://github.com/PyO3/pyo3/pull/5198">#5198</a></li>
<li>不再将 win7 目标视为交叉编译。<a href="https://github.com/PyO3/pyo3/pull/5210">#5210</a></li>
<li>对于 Python &lt; 3.14 的 WASM 目标不再需要异常处理支持。<a href="https://github.com/PyO3/pyo3/pull/5239">#5239</a></li>
<li>修复 Python 解释器最终化后，<code>PyBuffer&lt;T&gt;</code> 被 drop 时的段错误。<a href="https://github.com/PyO3/pyo3/pull/5242">#5242</a></li>
<li><code>experimental-inspect</code>：改进自动生成导入的功能。<a href="https://github.com/PyO3/pyo3/pull/5251">#5251</a></li>
<li><code>experimental-inspect</code>：修复 <code>__richcmp__</code>、<code>__concat__</code>、<code>__repeat__</code>、<code>__inplace_concat__</code> 和 <code>__inplace_repeat__</code> 的内省功能。<a href="https://github.com/PyO3/pyo3/pull/5273">#5273</a></li>
<li>修复使用 <code>PyRef::into_super</code> 将可变子类转换为冻结基类时发生的借用泄露问题。<a href="https://github.com/PyO3/pyo3/pull/5281">#5281</a></li>
<li>修复 FFI 定义 <code>Py_Exit</code>（该函数永不返回，原返回值为 <code>()</code>，现改为 <code>!</code>）。<a href="https://github.com/PyO3/pyo3/pull/5317">#5317</a></li>
<li><code>experimental-inspect</code>：修复处理被 <code>#[cfg(...)]</code> 属性屏蔽的模块成员的问题。<a href="https://github.com/PyO3/pyo3/pull/5318">#5318</a></li>
</ul>
<h2 id="0251---2025-06-12"><a class="header" href="#0251---2025-06-12">[0.25.1] - 2025-06-12</a></h2>
<h3 id="打包-2"><a class="header" href="#打包-2">打包</a></h3>
<ul>
<li>添加对 Windows on ARM64 的支持。<a href="https://github.com/PyO3/pyo3/pull/5145">#5145</a></li>
<li>添加 <code>chrono-local</code> 特性，用于可选地转换 chrono 的 <code>Local</code> 时区和 <code>DateTime&lt;Local&gt;</code> 实例。<a href="https://github.com/PyO3/pyo3/pull/5174">#5174</a></li>
</ul>
<h3 id="新增-2"><a class="header" href="#新增-2">新增</a></h3>
<ul>
<li>添加 FFI 定义 <code>PyBytes_AS_STRING</code>。<a href="https://github.com/PyO3/pyo3/pull/5121">#5121</a></li>
<li>添加对模块关联常量内省的支持。<a href="https://github.com/PyO3/pyo3/pull/5150">#5150</a></li>
</ul>
<h3 id="变更-1"><a class="header" href="#变更-1">变更</a></h3>
<ul>
<li>在 GraalPy 上启用 “vectorcall” FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/5121">#5121</a></li>
<li>在 GraalPy 上使用 <code>Py_Is</code> 函数。<a href="https://github.com/PyO3/pyo3/pull/5121">#5121</a></li>
</ul>
<h3 id="修复-4"><a class="header" href="#修复-4">修复</a></h3>
<ul>
<li>当未使用 <code>experimental-async</code> 特性时，为 <code>async</code> 声明提供更清晰的编译错误提示。<a href="https://github.com/PyO3/pyo3/pull/5156">#5156</a></li>
<li>修复在大端架构上 <code>uuid::Uuid</code> 的 <code>FromPyObject</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/5161">#5161</a></li>
<li>修复 Python 3.14 与 32 位 x86 架构上的段错误。<a href="https://github.com/PyO3/pyo3/pull/5180">#5180</a></li>
</ul>
<h2 id="0250---2025-05-14"><a class="header" href="#0250---2025-05-14">[0.25.0] - 2025-05-14</a></h2>
<h3 id="打包-3"><a class="header" href="#打包-3">打包</a></h3>
<ul>
<li>支持 Python 3.14.0b1。<a href="https://github.com/PyO3/pyo3/pull/4811">#4811</a></li>
<li>升级支持的 GraalPy 版本至 24.2。<a href="https://github.com/PyO3/pyo3/pull/5116">#5116</a></li>
<li>添加可选依赖 <code>bigdecimal</code>，以支持 <code>bigdecimal::BigDecimal</code> 的类型转换。<a href="https://github.com/PyO3/pyo3/pull/5011">#5011</a></li>
<li>添加可选依赖 <code>time</code>，以支持 <code>time</code> 类型的转换。<a href="https://github.com/PyO3/pyo3/pull/5057">#5057</a></li>
<li>移除 <code>cfg-if</code> 依赖。<a href="https://github.com/PyO3/pyo3/pull/5110">#5110</a></li>
<li>添加可选依赖 <code>ordered_float</code>，以支持 <code>ordered_float::NotNan</code> 和 <code>ordered_float::OrderedFloat</code> 的转换。<a href="https://github.com/PyO3/pyo3/pull/5114">#5114</a></li>
</ul>
<h3 id="新增-3"><a class="header" href="#新增-3">新增</a></h3>
<ul>
<li>为 <code>experimental-inspect</code> 特性添加初步的类型存根生成功能。<a href="https://github.com/PyO3/pyo3/pull/3977">#3977</a></li>
<li>添加 <code>#[pyclass(generic)]</code> 选项以支持运行时泛型类型。<a href="https://github.com/PyO3/pyo3/pull/4926">#4926</a></li>
<li>为 <code>parking_lot</code> 和 <code>lock_api</code> 实现 <code>OnceExt</code> 和 <code>MutexExt</code>。通过启用 <code>arc_lock</code>、<code>lock_api</code> 或 <code>parking_lot</code> cargo 特性来使用这些扩展 trait。<a href="https://github.com/PyO3/pyo3/pull/5044">#5044</a></li>
<li>实现 <code>Borrowed&lt;T&gt;</code> → <code>Py&lt;T&gt;</code> 的 <code>From</code>/<code>Into</code> 转换。<a href="https://github.com/PyO3/pyo3/pull/5054">#5054</a></li>
<li>添加 <code>PyTzInfo</code> 构造函数。<a href="https://github.com/PyO3/pyo3/pull/5055">#5055</a></li>
<li>添加 FFI 定义 <code>PY_INVALID_STACK_EFFECT</code>。<a href="https://github.com/PyO3/pyo3/pull/5064">#5064</a></li>
<li>为 <code>Py&lt;T&gt;</code>、<code>Bound&lt;T&gt;</code> 和 <code>Borrowed&lt;T&gt;</code> 实现 <code>AsRef&lt;Py&lt;PyAny&gt;&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/5071">#5071</a></li>
<li>添加 FFI 定义 <code>PyModule_Add</code> 和 <code>compat::PyModule_Add</code>。<a href="https://github.com/PyO3/pyo3/pull/5085">#5085</a></li>
<li>添加 FFI 定义 <code>Py_HashBuffer</code>、<code>Py_HashPointer</code> 和 <code>PyObject_GenericHash</code>。<a href="https://github.com/PyO3/pyo3/pull/5086">#5086</a></li>
<li>在声明式模块中支持 <code>#[pymodule_export]</code> 应用于 <code>const</code> 项。<a href="https://github.com/PyO3/pyo3/pull/5096">#5096</a></li>
<li>添加 <code>#[pyclass(immutable_type)]</code> 选项（Python 3.14+ 启用 <code>abi3</code> 时，或 3.10+ 其他情况）以创建不可变类型对象。<a href="https://github.com/PyO3/pyo3/pull/5101">#5101</a></li>
<li>支持在 <code>#[derive(IntoPyObject)]</code> 上使用 <code>#[pyo3(rename_all)]</code>。<a href="https://github.com/PyO3/pyo3/pull/5112">#5112</a></li>
<li>添加 <code>PyRange</code> 包装器。<a href="https://github.com/PyO3/pyo3/pull/5117">#5117</a></li>
</ul>
<h3 id="变更-2"><a class="header" href="#变更-2">变更</a></h3>
<ul>
<li>允许在启用 <code>abi3</code> 特性时使用 <code>datetime</code> 类型。<a href="https://github.com/PyO3/pyo3/pull/4970">#4970</a></li>
<li>弃用 <code>timezone_utc</code>，推荐使用 <code>PyTzInfo::utc</code>。<a href="https://github.com/PyO3/pyo3/pull/5055">#5055</a></li>
<li>降低部分 CPython 实现细节的可见性：<a href="https://github.com/PyO3/pyo3/pull/5064">#5064</a>
<ul>
<li>FFI 定义 <code>PyCodeObject</code> 现在在所有 Python 版本上均为不透明结构体。  - FFI 定义 <code>PyFutureFeatures</code> 现在仅定义到 Python 3.10 为止（它在 CPython 头文件中存在，但在 3.11 和 3.12 中未使用）。</li>
</ul>
</li>
<li>将 <code>PyAnyMethods::is</code> 更改为接受 <code>other: &amp;Bound&lt;T&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/5071">#5071</a></li>
<li>将 <code>Py::is</code> 更改为接受 <code>other: &amp;Py&lt;T&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/5071">#5071</a></li>
<li>将 <code>PyVisit::call</code> 更改为接受 <code>T: Into&lt;Option&lt;&amp;Py&lt;T&gt;&gt;&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/5071">#5071</a></li>
<li>在 PyPy 3.10 及更高版本上暴露 <code>PyDateTime_DATE_GET_TZINFO</code> 和 <code>PyDateTime_TIME_GET_TZINFO</code>。<a href="https://github.com/PyO3/pyo3/pull/5079">#5079</a></li>
<li>为 <code>with_gil</code> 和 <code>with_gil_unchecked</code> 添加 <code>#[track_caller]</code>。<a href="https://github.com/PyO3/pyo3/pull/5109">#5109</a></li>
<li>使用 <code>std::thread::park()</code> 代替 <code>libc::pause()</code> 或 <code>sleep(9999999)</code>。<a href="https://github.com/PyO3/pyo3/pull/5115">#5115</a></li>
</ul>
<h3 id="已移除"><a class="header" href="#已移除">已移除</a></h3>
<ul>
<li>移除 PyO3 0.23 中已弃用的所有功能。<a href="https://github.com/PyO3/pyo3/pull/4982">#4982</a></li>
<li>移除已弃用的 <code>IntoPy</code> 和 <code>ToPyObject</code> trait。<a href="https://github.com/PyO3/pyo3/pull/5010">#5010</a></li>
<li>从 <code>pyo3-ffi</code> 中移除未被公共 API 引用的私有类型（即以 <code>_Py</code> 开头的类型）：<code>_PyLocalMonitors</code>、<code>_Py_GlobalMonitors</code>、<code>_PyCoCached</code>、<code>_PyCoLineInstrumentationData</code>、<code>_PyCoMonitoringData</code>、<code>_PyCompilerSrcLocation</code>、<code>_PyErr_StackItem</code>。<a href="https://github.com/PyO3/pyo3/pull/5064">#5064</a></li>
<li>移除 FFI 定义 <code>PyCode_GetNumFree</code>（由于对代码对象的了解，PyO3 无法支持）。<a href="https://github.com/PyO3/pyo3/pull/5064">#5064</a></li>
<li>移除 <code>AsPyPointer</code> trait。<a href="https://github.com/PyO3/pyo3/pull/5071">#5071</a></li>
<li>移除对已弃用的字符串形式 <code>from_py_with</code> 的支持。<a href="https://github.com/PyO3/pyo3/pull/5097">#5097</a></li>
<li>移除私有静态变量的 FFI 定义：<code>_PyMethodWrapper_Type</code>、<code>_PyCoroWrapper_Type</code>、<code>_PyImport_FrozenBootstrap</code>、<code>_PyImport_FrozenStdlib</code>、<code>_PyImport_FrozenTest</code>、<code>_PyManagedBuffer_Type</code>、<code>_PySet_Dummy</code>、<code>_PyWeakref_ProxyType</code> 和 <code>_PyWeakref_CallableProxyType</code>。<a href="https://github.com/PyO3/pyo3/pull/5105">#5105</a></li>
<li>在 Python 3.14 及更高版本上移除 FFI 定义 <code>PyASCIIObjectState</code>、<code>PyUnicode_IS_ASCII</code>、<code>PyUnicode_IS_COMPACT</code> 和 <code>PyUnicode_IS_COMPACT_ASCII</code>。<a href="https://github.com/PyO3/pyo3/pull/5133">#5133</a></li>
</ul>
<h3 id="已修复"><a class="header" href="#已修复">已修复</a></h3>
<ul>
<li>在从 sysconfigdata 读取信息时，正确获取基于 conda 的 Python 安装的共享状态。<a href="https://github.com/PyO3/pyo3/pull/5037">#5037</a></li>
<li>修复当使用仅被两个 derive 之一识别的 <code>#[pyo3()]</code> 选项时，<code>#[derive(IntoPyObject, FromPyObject)]</code> 导致的编译失败。<a href="https://github.com/PyO3/pyo3/pull/5070">#5070</a></li>
<li>修复在 PyPy 和 GraalPy 上使用某些功能组合时因缺少 FFI 定义导致的各种编译错误。<a href="https://github.com/PyO3/pyo3/pull/5091">#5091</a></li>
<li>在将时区转换为 Python 时，对 Python &lt;3.9 回退使用 <code>backports.zoneinfo</code>。<a href="https://github.com/PyO3/pyo3/pull/5120">#5120</a></li>
</ul>
<h2 id="0242---2025-04-21"><a class="header" href="#0242---2025-04-21">[0.24.2] - 2025-04-21</a></h2>
<h3 id="已修复-1"><a class="header" href="#已修复-1">已修复</a></h3>
<ul>
<li>修复在 <code>macro_rules</code> 上下文中展开 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 时导致的 <code>unused_imports</code> lint 提示。<a href="https://github.com/PyO3/pyo3/pull/5030">#5030</a></li>
<li>修复在 Python 3.13 上，<code>PyCodeObject::_co_instrumentation_version</code> FFI 结构成员在 <code>uintptr_t</code> 不是 64 位的系统上的大小问题。<a href="https://github.com/PyO3/pyo3/pull/5048">#5048</a></li>
<li>修复结构体类型枚举变体字段在 Python 绑定中错误地将原始标识符暴露为 <code>r#ident</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/5050">#5050</a></li>
</ul>
<h2 id="0241---2025-03-31"><a class="header" href="#0241---2025-03-31">[0.24.1] - 2025-03-31</a></h2>
<h3 id="新增-4"><a class="header" href="#新增-4">新增</a></h3>
<ul>
<li>添加 <code>abi3-py313</code> 功能。<a href="https://github.com/PyO3/pyo3/pull/4969">#4969</a></li>
<li>添加 <code>PyAnyMethods::getattr_opt</code>。<a href="https://github.com/PyO3/pyo3/pull/4978">#4978</a></li>
<li>为所有支持的数字类型（i32、u32、i64、u64、isize、usize）添加 <code>PyInt::new</code> 构造函数。<a href="https://github.com/PyO3/pyo3/pull/4984">#4984</a></li>
<li>添加 <code>pyo3::sync::with_critical_section2</code>。<a href="https://github.com/PyO3/pyo3/pull/4992">#4992</a></li>
<li>为 <code>Borrowed&lt;'_, 'py, PyTuple&gt;</code>、<code>&amp;Bound&lt;'py, PyTuple&gt;</code> 和 <code>&amp;Py&lt;PyTuple&gt;</code> 实现 <code>PyCallArgs</code>。<a href="https://github.com/PyO3/pyo3/pull/5013">#5013</a></li>
</ul>
<h3 id="已修复-2"><a class="header" href="#已修复-2">已修复</a></h3>
<ul>
<li>修复原生类型的 <code>is_type_of</code> 未使用与 <code>is_type_of_bound</code> 相同的特殊化检查的问题。<a href="https://github.com/PyO3/pyo3/pull/4981">#4981</a></li>
<li>修复 <code>#[pymethods]</code> 中 <code>Probe</code> 类的命名问题。<a href="https://github.com/PyO3/pyo3/pull/4988">#4988</a></li>
<li>修复当必填的 <code>#[pyfunction]</code> 参数为 <code>Option&lt;&amp;str&gt;</code> 和 <code>Option&lt;&amp;T&gt;</code>（针对 <code>#[pyclass]</code> 类型）时的编译失败。<a href="https://github.com/PyO3/pyo3/pull/5002">#5002</a></li>
<li>修复 <code>PyString::from_object</code> 在 <code>encoding</code> 和 <code>errors</code> 参数未以 null 结尾时导致的越界读取。<a href="https://github.com/PyO3/pyo3/pull/5008">#5008</a></li>
<li>修复当 <code>#[pyfunction]</code> 的 <code>crate</code> 之后还有其他选项时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/5015">#5015</a></li>
</ul>
<h2 id="0240---2025-03-09"><a class="header" href="#0240---2025-03-09">[0.24.0] - 2025-03-09</a></h2>
<h3 id="打包-4"><a class="header" href="#打包-4">打包</a></h3>
<ul>
<li>向 Cargo 包元数据中添加支持的 CPython/PyPy 版本。<a href="https://github.com/PyO3/pyo3/pull/4756">#4756</a></li>
<li>将 <code>target-lexicon</code> 依赖升级至 0.13。<a href="https://github.com/PyO3/pyo3/pull/4822">#4822</a></li>
<li>添加可选的 <code>jiff</code> 依赖以支持 <code>jiff</code> 日期时间类型的转换。<a href="https://github.com/PyO3/pyo3/pull/4823">#4823</a></li>
<li>添加可选的 <code>uuid</code> 依赖以支持 <code>uuid::Uuid</code> 的转换。<a href="https://github.com/PyO3/pyo3/pull/4864">#4864</a></li>
<li>将最低支持的 <code>inventory</code> 版本提升至 0.3.5。<a href="https://github.com/PyO3/pyo3/pull/4954">#4954</a></li>
</ul>
<h3 id="新增-5"><a class="header" href="#新增-5">新增</a></h3>
<ul>
<li>添加 <code>PyIterator::send</code> 方法，允许向 Python 生成器发送值。<a href="https://github.com/PyO3/pyo3/pull/4746">#4746</a></li>
<li>添加 <code>PyCallArgs</code> trait 以向 Python 调用协议传参。这使得对某些类型使用更快的调用约定，从而提升性能。<a href="https://github.com/PyO3/pyo3/pull/4768">#4768</a></li>
<li>为 <code>#[derive(FromPyObject)]</code> 添加 <code>#[pyo3(default = ...')]</code> 选项，用于为命名结构体字段设置默认值。<a href="https://github.com/PyO3/pyo3/pull/4829">#4829</a></li>
<li>添加 <code>#[pyo3(into_py_with = ...)]</code> 选项用于 <code>#[derive(IntoPyObject, IntoPyObjectRef)]</code>。<a href="https://github.com/PyO3/pyo3/pull/4850">#4850</a></li>
<li>添加 FFI 定义 <code>PyThreadState_GetFrame</code> 和 <code>PyFrame_GetBack</code>。<a href="https://github.com/PyO3/pyo3/pull/4866">#4866</a></li>
<li>优化 <code>BoundListIterator</code>、<code>BoundTupleIterator</code> 和 <code>BorrowedTupleIterator</code> 的 <code>last</code>。<a href="https://github.com/PyO3/pyo3/pull/4878">#4878</a></li>
<li>优化 <code>PyDict</code>、<code>PyList</code>、<code>PyTuple</code> 和 <code>PySet</code> 的 <code>Iterator::count()</code>。<a href="https://github.com/PyO3/pyo3/pull/4878">#4878</a></li>
<li>优化 <code>BoundTupleIterator</code> 的 <code>nth</code>、<code>nth_back</code>、<code>advance_by</code> 和 <code>advance_back_by</code>。<a href="https://github.com/PyO3/pyo3/pull/4897">#4897</a></li>
<li>添加对 <code>types.GenericAlias</code> 作为 <code>pyo3::types::PyGenericAlias</code> 的支持。<a href="https://github.com/PyO3/pyo3/pull/4917">#4917</a></li>
<li>添加 <code>MutextExt</code> trait 以帮助在锁定 <code>std::sync::Mutex</code> 时避免 GIL 死锁。<a href="https://github.com/PyO3/pyo3/pull/4934">#4934</a></li>
<li>为 <code>#[derive(FromPyObject)]</code> 添加 <code>#[pyo3(rename_all = "...")]</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/4941">#4941</a></li>
</ul>
<h3 id="更改-2"><a class="header" href="#更改-2">更改</a></h3>
<ul>
<li>优化 <code>BoundListIterator</code> 的 <code>nth</code>、<code>nth_back</code>、<code>advance_by</code> 和 <code>advance_back_by</code>。<a href="https://github.com/PyO3/pyo3/pull/4810">#4810</a></li>
<li>在 <code>PyObject</code> 的 <code>From&lt;Py&lt;T&gt;&gt;</code> 和 <code>From&lt;Bound&lt;'py, T&gt;&gt;</code> 的泛型实现中使用 <code>DerefToPyAny</code>。<a href="https://github.com/PyO3/pyo3/pull/4593">#4593</a></li>
<li>在 Rust 1.83+ 上将 <code>io::ErrorKind::IsADirectory</code>/<code>NotADirectory</code> 映射到相应的 Python 异常。<a href="https://github.com/PyO3/pyo3/pull/4747">#4747</a></li>
<li><code>PyAnyMethods::call</code> 及其相关方法现在对其位置参数要求 <code>PyCallArgs</code>。<a href="https://github.com/PyO3/pyo3/pull/4768">#4768</a></li>
<li>在 3.12+ 的稳定 ABI 上暴露 <code>PyObject_Vectorcall(Method)</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/4853">#4853</a></li>
<li><code>#[pyo3(from_py_with = ...)]</code> 现在接受路径而非字符串字面量。<a href="https://github.com/PyO3/pyo3/pull/4860">#4860</a></li>
<li>在 <code>PyErr</code> 的 Debug 实现中格式化 Python traceback。<a href="https://github.com/PyO3/pyo3/pull/4900">#4900</a></li>
<li>将 <code>PathBuf</code> 和 <code>Path</code> 转换为 Python 的 <code>pathlib.Path</code> 而不是 <code>PyString</code>。<a href="https://github.com/PyO3/pyo3/pull/4925">#4925</a></li>
<li>放宽对非标准 Python 版本的解析。<a href="https://github.com/PyO3/pyo3/pull/4949">#4949</a></li>
<li>当解释器关闭时，PyO3 线程现在会挂起而不是调用 <code>pthread_exit</code> 尝试获取 GIL。这模拟了 <a href="https://github.com/python/cpython/issues/87135">Python 3.14</a> 的行为，避免了未定义行为和崩溃。<a href="https://github.com/PyO3/pyo3/pull/4874">#4874</a></li>
</ul>
<h3 id="已移除-1"><a class="header" href="#已移除-1">已移除</a></h3>
<ul>
<li>移除 <code>PyAny</code> 和其他“原生”类型的 <code>Deref</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/4593">#4593</a></li>
<li>移除隐式可选参数的默认行为（见 #2935）。<a href="https://github.com/PyO3/pyo3/pull/4729">#4729</a></li>
<li>移除对简单枚举的已弃用的隐式 eq 回退。<a href="https://github.com/PyO3/pyo3/pull/4730">#4730</a></li>
</ul>
<h3 id="已修复-3"><a class="header" href="#已修复-3">已修复</a></h3>
<ul>
<li>修正 <code>PyIter_Send</code> 的 FFI 定义，使其返回 <code>PySendResult</code>。<a href="https://github.com/PyO3/pyo3/pull/4746">#4746</a></li>
<li>修复在自由线程构建中用于可变 pyclass 实例的运行时借用检查器的线程安全问题。<a href="https://github.com/PyO3/pyo3/pull/4948">#4948</a></li>
</ul>
<h2 id="0235---2025-02-22"><a class="header" href="#0235---2025-02-22">[0.23.5] - 2025-02-22</a></h2>
<h3 id="打包-5"><a class="header" href="#打包-5">打包</a></h3>
<ul>
<li>添加对 PyPy3.11 的支持。<a href="https://github.com/PyO3/pyo3/pull/4760">#4760</a></li>
</ul>
<h3 id="已修复-4"><a class="header" href="#已修复-4">已修复</a></h3>
<ul>
<li>修复自由线程构建中 freelist pyclass 的线程不安全实现。<a href="https://github.com/PyO3/pyo3/pull/4902">#4902</a></li>
<li>重新启用一项变通方法，用于解决 CPython 在通过 <code>Python::py_run</code> 执行的代码中未将 <code>__builtins__</code> 添加到 <code>__globals__</code> 的问题（该方法在 PyO3 0.23.0 中被移除）。<a href="https://github.com/PyO3/pyo3/pull/4921">#4921</a></li>
</ul>
<h2 id="0234---2025-01-10"><a class="header" href="#0234---2025-01-10">[0.23.4] - 2025-01-10</a></h2>
<h3 id="新增-6"><a class="header" href="#新增-6">新增</a></h3>
<ul>
<li>添加 <code>PyList::locked_for_each</code>，在自由线程构建中使用临界区锁定列表。<a href="https://github.com/PyO3/pyo3/pull/4789">#4789</a></li>
<li>添加 <code>pyo3_build_config::add_python_framework_link_args</code> 构建脚本 API，用于在使用 macOS 系统 Python 时设置 rpath。<a href="https://github.com/PyO3/pyo3/pull/4833">#4833</a></li>
</ul>
<h3 id="更改--使用-datetimefold-来区分在转换为和从-chronodatetimetz-时的歧义时间而不是报错4791"><a class="header" href="#更改--使用-datetimefold-来区分在转换为和从-chronodatetimetz-时的歧义时间而不是报错4791">更改- 使用 <code>datetime.fold</code> 来区分在转换为和从 <code>chrono::DateTime&lt;Tz&gt;</code> 时的歧义时间（而不是报错）。<a href="https://github.com/PyO3/pyo3/pull/4791">#4791</a></a></h3>
<ul>
<li>优化自由线程构建下的 PyList 迭代性能。<a href="https://github.com/PyO3/pyo3/pull/4789">#4789</a></li>
</ul>
<h3 id="已修复-5"><a class="header" href="#已修复-5">已修复</a></h3>
<ul>
<li>修复尝试访问来自 Python 的 <code>PyErr</code> 内容时不必要的内部 <code>py.allow_threads</code> GIL 切换问题（可能导致意外死锁）。<a href="https://github.com/PyO3/pyo3/pull/4766">#4766</a></li>
<li>修复在自由线程构建下 <code>BoundDictIterator</code> 中对字典内部数据的线程不安全访问。<a href="https://github.com/PyO3/pyo3/pull/4788">#4788</a></li>
<li>修复在自由线程构建下 <code>BoundDictIterator</code> 中不必要的临界区。<a href="https://github.com/PyO3/pyo3/pull/4788">#4788</a></li>
<li>修复自由线程构建下列表迭代中存在的“检查-使用”时间差问题。<a href="https://github.com/PyO3/pyo3/pull/4789">#4789</a></li>
<li>修复当 <code>Tz</code> 为 <code>chrono_tz::Tz</code> 时 <code>chrono::DateTime&lt;Tz&gt;</code> 转换为 Python 对象的问题。<a href="https://github.com/PyO3/pyo3/pull/4790">#4790</a></li>
<li>修复 <code>#[pyclass]</code> 无法命名为 <code>Probe</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/4794">#4794</a></li>
<li>修复未将 Windows 上从 x64 到 aarch64 的交叉编译识别为交叉编译的问题。<a href="https://github.com/PyO3/pyo3/pull/4800">#4800</a></li>
<li>修复在 GraalPy 中继承内置类时缺少结构体字段的问题。<a href="https://github.com/PyO3/pyo3/pull/4802">#4802</a></li>
<li>修复启用 <code>abi3</code> 功能时为 PyPy 生成导入库的问题。<a href="https://github.com/PyO3/pyo3/pull/4806">#4806</a></li>
<li>修复启用 <code>abi3</code> 功能时为 python3.13t 生成导入库的问题。<a href="https://github.com/PyO3/pyo3/pull/4808">#4808</a></li>
<li>修复在 <code>derive(FromPyObject)</code> 中对 <code>r#box</code> 等原始标识符的编译失败问题。<a href="https://github.com/PyO3/pyo3/pull/4814">#4814</a></li>
<li>修复 <code>#[pyclass]</code> 枚举变体超过 12 个字段时的编译失败问题。<a href="https://github.com/PyO3/pyo3/pull/4832">#4832</a></li>
</ul>
<h2 id="0233---2024-12-03"><a class="header" href="#0233---2024-12-03">[0.23.3] - 2024-12-03</a></h2>
<h3 id="打包-6"><a class="header" href="#打包-6">打包</a></h3>
<ul>
<li>将可选依赖 <code>python3-dll-a</code> 升级至 0.2.11 版本。<a href="https://github.com/PyO3/pyo3/pull/4749">#4749</a></li>
</ul>
<h3 id="已修复-6"><a class="header" href="#已修复-6">已修复</a></h3>
<ul>
<li>修复在启用 <code>abi3</code> 功能时为 Python 3.13t 编译时 Windows 上的未解析符号链接错误。<a href="https://github.com/PyO3/pyo3/pull/4733">#4733</a></li>
<li>修复在使用 <code>generate-import-lib</code> 功能为 Python 3.13t 编译时 Windows 上的未解析符号链接错误。<a href="https://github.com/PyO3/pyo3/pull/4749">#4749</a></li>
<li>修复 PyO3 0.23.0 中的编译时回归问题：更改 <code>PYO3_CONFIG_FILE</code> 时不会为新解释器重新配置 PyO3。<a href="https://github.com/PyO3/pyo3/pull/4758">#4758</a></li>
</ul>
<h2 id="0232---2024-11-25"><a class="header" href="#0232---2024-11-25">[0.23.2] - 2024-11-25</a></h2>
<h3 id="新增-7"><a class="header" href="#新增-7">新增</a></h3>
<ul>
<li>添加 <code>IntoPyObjectExt</code> trait。<a href="https://github.com/PyO3/pyo3/pull/4708">#4708</a></li>
</ul>
<h3 id="已修复-7"><a class="header" href="#已修复-7">已修复</a></h3>
<ul>
<li>修复在启用 <code>abi3</code> 或 <code>abi3-pyxx</code> 功能时为自由线程 Python 构建时的编译失败问题。<a href="https://github.com/PyO3/pyo3/pull/4719">#4719</a></li>
<li>修复 <code>#[pyclass]</code> 和 <code>#[derive(IntoPyObject)]</code> 宏中的 <code>ambiguous_associated_items</code> 检查警告错误。<a href="https://github.com/PyO3/pyo3/pull/4725">#4725</a></li>
</ul>
<h2 id="0231---2024-11-16"><a class="header" href="#0231---2024-11-16">[0.23.1] - 2024-11-16</a></h2>
<p>重新发布 0.23.0，修复了 docs.rs 构建问题。</p>
<h2 id="0230---2024-11-15"><a class="header" href="#0230---2024-11-15">[0.23.0] - 2024-11-15</a></h2>
<h3 id="打包-7"><a class="header" href="#打包-7">打包</a></h3>
<ul>
<li>移除对 PyPy 3.7 和 3.8 的支持。<a href="https://github.com/PyO3/pyo3/pull/4582">#4582</a></li>
<li>扩展可选依赖 <code>hashbrown</code> 的支持版本范围以包含 0.15 版本。<a href="https://github.com/PyO3/pyo3/pull/4604">#4604</a></li>
<li>将可选依赖 <code>eyre</code> 的最低版本提升至 0.6.8。<a href="https://github.com/PyO3/pyo3/pull/4617">#4617</a></li>
<li>将可选依赖 <code>hashbrown</code> 的最低版本提升至 0.14.5。<a href="https://github.com/PyO3/pyo3/pull/4617">#4617</a></li>
<li>将可选依赖 <code>indexmap</code> 的最低版本提升至 2.5.0。<a href="https://github.com/PyO3/pyo3/pull/4617">#4617</a></li>
<li>将可选依赖 <code>num-complex</code> 的最低版本提升至 0.4.6。<a href="https://github.com/PyO3/pyo3/pull/4617">#4617</a></li>
<li>将可选依赖 <code>chrono-tz</code> 的最低版本提升至 0.10。<a href="https://github.com/PyO3/pyo3/pull/4617">#4617</a></li>
<li>支持自由线程的 Python 3.13t。<a href="https://github.com/PyO3/pyo3/pull/4588">#4588</a></li>
</ul>
<h3 id="新增-8"><a class="header" href="#新增-8">新增</a></h3>
<ul>
<li>添加 <code>IntoPyObject</code>（可失败）转换 trait，用于从 Rust 值转换为 Python 值。<a href="https://github.com/PyO3/pyo3/pull/4060">#4060</a></li>
<li>添加 <code>#[pyclass(str="&lt;format string&gt;")]</code> 选项，基于 <code>Display</code> 实现或格式字符串生成 <code>__str__</code>。<a href="https://github.com/PyO3/pyo3/pull/4233">#4233</a></li>
<li>为 <code>Bound&lt;'py, PyInt&gt;</code> 实现 <code>PartialEq</code>，支持 <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code>, <code>usize</code>, <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code> 和 <code>isize</code>。<a href="https://github.com/PyO3/pyo3/pull/4317">#4317</a></li>
<li>为 <code>Bound&lt;'py, PyFloat&gt;</code> 实现 <code>PartialEq&lt;f64&gt;</code> 和 <code>PartialEq&lt;f32&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4348">#4348</a></li>
<li>为 <code>Bound&lt;T: PyClass&gt;</code> 添加 <code>as_super</code> 和 <code>into_super</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/4351">#4351</a></li>
<li>添加 FFI 定义 <code>PyCFunctionFast</code> 和 <code>PyCFunctionFastWithKeywords</code>。<a href="https://github.com/PyO3/pyo3/pull/4415">#4415</a></li>
<li>为 Python 3.13 及更高版本添加 <code>PyMutex</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/4421">#4421</a></li>
<li>添加 <code>PyDict::locked_for_each</code> 以在自由线程 Python 中高效迭代。<a href="https://github.com/PyO3/pyo3/pull/4439">#4439</a></li>
<li>为 Python 3.13 及更新版本添加 FFI 定义：<code>PyObject_GetOptionalAttr</code>, <code>PyObject_GetOptionalAttrString</code>, <code>PyObject_HasAttrWithError</code>, <code>PyObject_HasAttrStringWithError</code>, <code>Py_CONSTANT_*</code> 常量, <code>Py_GetConstant</code>, <code>Py_GetConstantBorrowed</code>, 和 <code>PyType_GetModuleByDef</code>。<a href="https://github.com/PyO3/pyo3/pull/4447">#4447</a></li>
<li>为 Python 3.13 及更新版本中可用的 Python 临界区 API 添加 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/4477">#4477</a></li>
<li>添加 <code>IntoPyObject</code> 的派生宏。<a href="https://github.com/PyO3/pyo3/pull/4495">#4495</a></li>
<li>添加 <code>Borrowed::as_ptr</code>。<a href="https://github.com/PyO3/pyo3/pull/4520">#4520</a></li>
<li>添加 <code>PyImport_AddModuleRef</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/4529">#4529</a></li>
<li>添加 <code>PyAnyMethods::try_iter</code>。<a href="https://github.com/PyO3/pyo3/pull/4553">#4553</a></li>
<li>添加 <code>pyo3::sync::with_critical_section</code>，封装 Python 3.13 引入的临界区 API。<a href="https://github.com/PyO3/pyo3/pull/4587">#4587</a></li>
<li>添加 <code>#[pymodule(gil_used = false)]</code> 选项，声明模块支持自由线程构建。<a href="https://github.com/PyO3/pyo3/pull/4588">#4588</a></li>
<li>添加 <code>PyModule::gil_used</code> 方法，用于声明模块支持自由线程构建。<a href="https://github.com/PyO3/pyo3/pull/4588">#4588</a></li>
<li>添加 FFI 定义 <code>PyDateTime_CAPSULE_NAME</code>。<a href="https://github.com/PyO3/pyo3/pull/4634">#4634</a></li>
<li>添加 <code>PyMappingProxy</code> 类型以表示 Python 的 <code>mappingproxy</code> 类。<a href="https://github.com/PyO3/pyo3/pull/4644">#4644</a></li>
<li>添加 FFI 定义 <code>PyList_Extend</code> 和 <code>PyList_Clear</code>。<a href="https://github.com/PyO3/pyo3/pull/4667">#4667</a></li>
<li>添加 <code>IntoPyObjectRef</code> 的派生宏。<a href="https://github.com/PyO3/pyo3/pull/4674">#4674</a></li>
<li>添加 <code>pyo3::sync::OnceExt</code> 和 <code>pyo3::sync::OnceLockExt</code> trait。<a href="https://github.com/PyO3/pyo3/pull/4676">#4676</a></li>
</ul>
<h3 id="变更-3"><a class="header" href="#变更-3">变更</a></h3>
<ul>
<li>对 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 的返回类型优先使用 <code>IntoPyObject</code> 而非 <code>IntoPy&lt;Py&lt;PyAny&gt;&gt;&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4060">#4060</a></li>
<li>报告 <code>#[pyclass]</code> 和 <code>#[pyo3(..)]</code> 属性中的多个错误。<a href="https://github.com/PyO3/pyo3/pull/4243">#4243</a></li>
<li>嵌套的声明式 <code>#[pymodule]</code> 将自动被视为子模块（不再生成 <code>PyInit_</code> 入口点）。<a href="https://github.com/PyO3/pyo3/pull/4308">#4308</a></li>
<li>弃用 <code>PyAnyMethods::is_ellipsis</code>（<code>Py::is_ellipsis</code> 已在 PyO3 0.20 中弃用）。<a href="https://github.com/PyO3/pyo3/pull/4322">#4322</a></li>
<li>弃用 <code>PyLong</code>，建议使用 <code>PyInt</code>。<a href="https://github.com/PyO3/pyo3/pull/4347">#4347</a></li>
<li>将 <code>IntoPyDict::into_py_dict_bound</code> 重命名为 <code>IntoPyDict::into_py_dict</code>。<a href="https://github.com/PyO3/pyo3/pull/4388">#4388</a></li>
<li><code>PyModule::from_code</code> 现在接受 <code>&amp;CStr</code> 参数而非 <code>&amp;str</code>。<a href="https://github.com/PyO3/pyo3/pull/4404">#4404</a></li>
<li>在为 Python 3.10 及以上版本的 abi3 编译时，<code>#[pyfunction]</code> 使用 Python 的 “fastcall” 调用约定。<a href="https://github.com/PyO3/pyo3/pull/4415">#4415</a></li>
<li>从 FFI 定义的 <code>PyObject</code> 结构体中移除 <code>Copy</code> 和 <code>Clone</code>。<a href="https://github.com/PyO3/pyo3/pull/4434">#4434</a></li>
<li><code>Python::eval</code> 和 <code>Python::run</code> 现在接受 <code>&amp;CStr</code> 而非 <code>&amp;str</code>。<a href="https://github.com/PyO3/pyo3/pull/4435">#4435</a></li>
<li>从 PyO3 公共 API 中弃用 <code>IPowModulo</code>, <code>PyClassAttributeDef</code>, <code>PyGetterDef</code>, <code>PyMethodDef</code>, <code>PyMethodDefType</code>, 和 <code>PySetterDef</code>。<a href="https://github.com/PyO3/pyo3/pull/4441">#4441</a></li>
<li><code>Vec&lt;u8&gt;</code>, <code>&amp;[u8]</code>, <code>[u8; N]</code>, <code>Cow&lt;[u8]&gt;</code> 和 <code>SmallVec&lt;[u8; N]&gt;</code> 的 <code>IntoPyObject</code> 实现现在转换为 Python <code>bytes</code>，而非整数列表。<a href="https://github.com/PyO3/pyo3/pull/4442">#4442</a></li>
<li>尝试继承不支持继承的类时发出编译时错误。<a href="https://github.com/PyO3/pyo3/pull/4453">#4453</a></li>
<li>由于 <code>IntoPyObject</code> 迁移，<code>IntoPyDict::into_py_dict</code> 现在是可失败的。<a href="https://github.com/PyO3/pyo3/pull/4493">#4493</a></li>
<li><code>abi3</code> 功能现在会覆盖通过 <code>PYO3_BUILD_CONFIG</code> 提供的配置文件。<a href="https://github.com/PyO3/pyo3/pull/4497">#4497</a></li>
<li>在自由线程 Python 中禁用 <code>GILProtected</code> 结构体。<a href="https://github.com/PyO3/pyo3/pull/4504">#4504</a></li>
<li>更新因 CPython 中已弃用或移除而更新的函数和结构体字段的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/4534">#4534</a></li>
<li>在自由线程 Python 中禁用 <code>PyListMethods::get_item_unchecked</code>。<a href="https://github.com/PyO3/pyo3/pull/4539">#4539</a></li>
<li>添加 <code>GILOnceCell::import</code>。<a href="https://github.com/PyO3/pyo3/pull/4542">#4542</a></li>
<li>弃用 <code>PyAnyMethods::iter</code>，建议使用 <code>PyAnyMethods::try_iter</code>。<a href="https://github.com/PyO3/pyo3/pull/4553">#4553</a></li>
<li><code>#[pyclass]</code> 宏现在要求类型为 <code>Sync</code>（<code>#[pyclass(unsendable)]</code> 类型除外）。<a href="https://github.com/PyO3/pyo3/pull/4566">#4566</a></li>
<li><code>PyList::new</code> 和 <code>PyTuple::new</code> 现在是可失败的，归因于 <code>IntoPyObject</code> 迁移。<a href="https://github.com/PyO3/pyo3/pull/4580">#4580</a>- <code>PyErr::matches</code> 由于 <code>IntoPyObject</code> 的迁移现在可能失败。<a href="https://github.com/PyO3/pyo3/pull/4595">#4595</a></li>
<li>弃用 <code>ToPyObject</code>，推荐使用 <code>IntoPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/4595">#4595</a></li>
<li>弃用 <code>PyWeakrefMethods::get_option</code>。<a href="https://github.com/PyO3/pyo3/pull/4597">#4597</a></li>
<li>封装 <code>PyWeakrefMethods</code> trait。<a href="https://github.com/PyO3/pyo3/pull/4598">#4598</a></li>
<li>从 PyO3 的公共 API 中移除 <code>PyNativeTypeInitializer</code> 和 <code>PyObjectInit</code>。<a href="https://github.com/PyO3/pyo3/pull/4611">#4611</a></li>
<li>弃用 <code>IntoPy</code>，推荐使用 <code>IntoPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/4618">#4618</a></li>
<li>在 Python 3.11 及更早版本中，<code>PyErr::take()</code> 和 <code>PyErr::fetch()</code> 会立即规范化异常。<a href="https://github.com/PyO3/pyo3/pull/4655">#4655</a></li>
<li>将 <code>IntoPy::type_output</code> 移动到 <code>IntoPyObject::type_output</code>。<a href="https://github.com/PyO3/pyo3/pull/4657">#4657</a></li>
<li>将 <code>PyMapping::keys</code>、<code>PyMapping::values</code> 和 <code>PyMapping::items</code> 的返回类型从 <code>Bound&lt;'py, PySequence&gt;</code> 改为 <code>Bound&lt;'py, PyList&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4661">#4661</a></li>
<li>复杂枚举现在允许字段类型通过引用或值实现 <code>IntoPyObject</code>，同时与 <code>Clone</code> 一起使用。这使得 <code>Py&lt;T&gt;</code> 可作为字段类型使用。<a href="https://github.com/PyO3/pyo3/pull/4694">#4694</a></li>
</ul>
<h3 id="已移除-2"><a class="header" href="#已移除-2">已移除</a></h3>
<ul>
<li>移除 PyO3 0.20 中已弃用的所有功能。<a href="https://github.com/PyO3/pyo3/pull/4322">#4322</a></li>
<li>移除 PyO3 0.21 中已弃用的所有功能。<a href="https://github.com/PyO3/pyo3/pull/4323">#4323</a></li>
<li>弃用 <code>PyUnicode</code>，推荐使用 <code>PyString</code>。<a href="https://github.com/PyO3/pyo3/pull/4370">#4370</a></li>
<li>移除已弃用的 <code>gil-refs</code> 功能。<a href="https://github.com/PyO3/pyo3/pull/4378">#4378</a></li>
<li>移除私有 FFI 定义 <code>_Py_IMMORTAL_REFCNT</code>、<code>_Py_IsImmortal</code>、<code>_Py_TPFLAGS_STATIC_BUILTIN</code>、<code>_Py_Dealloc</code>、<code>_Py_IncRef</code>、<code>_Py_DecRef</code>。<a href="https://github.com/PyO3/pyo3/pull/4447">#4447</a></li>
<li>移除私有 FFI 定义 <code>_Py_c_sum</code>、<code>_Py_c_diff</code>、<code>_Py_c_neg</code>、<code>_Py_c_prod</code>、<code>_Py_c_quot</code>、<code>_Py_c_pow</code>、<code>_Py_c_abs</code>。<a href="https://github.com/PyO3/pyo3/pull/4521">#4521</a></li>
<li>移除 <code>PyWeakRef</code> 和 <code>PyWeakRefProxy</code> 的 <code>_borrowed</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/4528">#4528</a></li>
<li>移除私有 FFI 定义 <code>_PyErr_ChainExceptions</code>。<a href="https://github.com/PyO3/pyo3/pull/4534">#4534</a></li>
</ul>
<h3 id="已修复-8"><a class="header" href="#已修复-8">已修复</a></h3>
<ul>
<li>修复交叉编译时无效的库搜索路径 <code>lib_dir</code>。<a href="https://github.com/PyO3/pyo3/pull/4389">#4389</a></li>
<li>修复 PyPy 在 3.10 上的 FFI 定义 <code>Py_Is</code>，以调用 PyPy 定义的函数。<a href="https://github.com/PyO3/pyo3/pull/4447">#4447</a></li>
<li>修复在简单枚举变体上使用 <code>#[cfg]</code> 属性时的编译失败。<a href="https://github.com/PyO3/pyo3/pull/4509">#4509</a></li>
<li>修复 <code>#[pymethods]</code> 生成代码中的 <code>non_snake_case</code> 方法名引起的编译器警告。<a href="https://github.com/PyO3/pyo3/pull/4567">#4567</a></li>
<li>修复 <code>#[derive(FromPyObject)]</code> 在带有 trait 约束的泛型结构体上的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4645">#4645</a></li>
<li>修复 <code>#[classmethod]</code> 和 <code>#[staticmethod]</code> 在魔法方法上的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4654">#4654</a></li>
<li>修复生成的宏代码中 <code>unsafe_op_in_unsafe_fn</code> 的编译警告。<a href="https://github.com/PyO3/pyo3/pull/4674">#4674</a></li>
<li>修复在自定义 <code>__eq__</code> 实现的 <code>#[pyclass] enum</code> 上错误的弃用警告。<a href="https://github.com/PyO3/pyo3/pull/4692">#4692</a></li>
<li>修复在复杂枚举上生成的 <code>__match_args__</code> 触发 <code>non_upper_case_globals</code> lint 的问题。<a href="https://github.com/PyO3/pyo3/pull/4705">#4705</a></li>
</ul>
<h2 id="0225---2024-10-15"><a class="header" href="#0225---2024-10-15">[0.22.5] - 2024-10-15</a></h2>
<h3 id="已修复-9"><a class="header" href="#已修复-9">已修复</a></h3>
<ul>
<li>修复 0.22.4 中 <code>__clear__</code> 插槽和 <code>clear</code> 方法生成代码的命名冲突问题。<a href="https://github.com/PyO3/pyo3/pull/4619">#4619</a></li>
</ul>
<h2 id="0224---2024-10-12"><a class="header" href="#0224---2024-10-12">[0.22.4] - 2024-10-12</a></h2>
<h3 id="新增-9"><a class="header" href="#新增-9">新增</a></h3>
<ul>
<li>添加 FFI 定义 <code>PyWeakref_GetRef</code> 和 <code>compat::PyWeakref_GetRef</code>。<a href="https://github.com/PyO3/pyo3/pull/4528">#4528</a></li>
</ul>
<h3 id="更改-3"><a class="header" href="#更改-3">更改</a></h3>
<ul>
<li>弃用 <code>PyWeakRef</code> 和 <code>PyWeakrefProxy</code> 上的 <code>_borrowed</code> 方法（建议直接使用拥有形式）。<a href="https://github.com/PyO3/pyo3/pull/4590">#4590</a></li>
</ul>
<h3 id="已修复-10"><a class="header" href="#已修复-10">已修复</a></h3>
<ul>
<li>恢复在 Python 3.13 及更高版本上被移除的私有 FFI 函数 <code>_PyLong_NumBits</code>。<a href="https://github.com/PyO3/pyo3/pull/4450">#4450</a></li>
<li>修复使用 <code>#[pyclass(extends = ...)]</code> 创建的子类未调用基类 <code>__traverse__</code> 函数的问题。<a href="https://github.com/PyO3/pyo3/pull/4563">#4563</a></li>
<li>修复 0.22.3 中在 <code>#![forbid(unsafe_code)]</code> 下无法编译的问题。<a href="https://github.com/PyO3/pyo3/pull/4574">#4574</a></li>
<li>修复 <code>create_exception</code> 宏因与 <code>gil-refs</code> 功能交互而触发的 lint 和编译错误。<a href="https://github.com/PyO3/pyo3/pull/4589">#4589</a></li>
<li>通过泄露其内容来规避 <code>PyWeakRef</code> 和 <code>PyWeakrefProxy</code> 上 <code>_borrowed</code> 方法可能的使用后释放问题。<a href="https://github.com/PyO3/pyo3/pull/4590">#4590</a></li>
<li>修复在 Python 3.10 之前对静态类型调用 <code>PyType_GetSlot</code> 时的崩溃问题。<a href="https://github.com/PyO3/pyo3/pull/4599">#4599</a></li>
</ul>
<h2 id="0223---2024-09-15"><a class="header" href="#0223---2024-09-15">[0.22.3] - 2024-09-15</a></h2>
<h3 id="新增-10"><a class="header" href="#新增-10">新增</a></h3>
<ul>
<li>添加 <code>pyo3::ffi::compat</code> 命名空间，包含对 Python 近期版本新增 C API 函数的兼容层。</li>
<li>在 Python 3.13 及更新版本上添加 FFI 定义 <code>PyDict_GetItemRef</code>，并为所有版本提供 <code>compat::PyDict_GetItemRef</code>。<a href="https://github.com/PyO3/pyo3/pull/4355">#4355</a></li>
<li>在 Python 3.13 及更新版本上添加 FFI 定义 <code>PyList_GetItemRef</code>，并为所有版本提供 <code>pyo3_ffi::compat::PyList_GetItemRef</code>。<a href="https://github.com/PyO3/pyo3/pull/4410">#4410</a></li>
<li>添加 FFI 定义 <code>compat::Py_NewRef</code> 和 <code>compat::Py_XNewRef</code>。<a href="https://github.com/PyO3/pyo3/pull/4445">#4445</a></li>
<li>添加 FFI 定义 <code>compat::PyObject_CallNoArgs</code> 和 <code>compat::PyObject_CallMethodNoArgs</code>。<a href="https://github.com/PyO3/pyo3/pull/4461">#4461</a></li>
<li>为 <code>GilOnceCell&lt;Py&lt;T&gt;&gt;</code> 添加 <code>clone_ref</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/4511">#4511</a></li>
</ul>
<h3 id="更改-4"><a class="header" href="#更改-4">更改</a></h3>
<ul>
<li>改进在 <code>#[pymethods]</code> 内定义的 <code>#[pyfunction]</code> 的错误提示信息。<a href="https://github.com/PyO3/pyo3/pull/4349">#4349</a></li>
<li>在可能的情况下使用 vectorcall 调用约定以提升调用 Python 的性能。<a href="https://github.com/PyO3/pyo3/pull/4456">#4456</a></li>
<li>当尝试实例化没有定义构造函数的类时，在异常消息中包含类型名称。<a href="https://github.com/PyO3/pyo3/pull/4481">#4481</a></li>
</ul>
<h3 id="已移除-3"><a class="header" href="#已移除-3">已移除</a></h3>
<ul>
<li>移除私有 FFI 定义 <code>_Py_PackageContext</code>。<a href="https://github.com/PyO3/pyo3/pull/4420">#4420</a></li>
</ul>
<h3 id="已修复-11"><a class="header" href="#已修复-11">已修复</a></h3>
<ul>
<li>修复在 <code>#![no_implicit_prelude]</code> 环境下声明式 <code>#[pymodule]</code> 的编译失败。<a href="https://github.com/PyO3/pyo3/pull/4328">#4328</a></li>
<li>修复 <code>PyDict::get_item</code> 中使用借用引用的问题（在自由线程 Python 中不安全）。<a href="https://github.com/PyO3/pyo3/pull/4355">#4355</a></li>
<li>修复 <code>#[pyclass(eq)]</code> 宏在结构体和枚举上的卫生问题。<a href="https://github.com/PyO3/pyo3/pull/4359">#4359</a></li>
<li>修复 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 生成代码的卫生/范围问题，该问题影响了在 <code>macro_rules</code> 上下文中的展开。<a href="https://github.com/PyO3/pyo3/pull/4382">#4382</a></li>
<li>修复 <code>#[pyclass]</code> 生成代码中的 <code>unsafe_code</code> lint 错误。<a href="https://github.com/PyO3/pyo3/pull/4396">#4396</a></li>
<li>修复异步函数返回元组时仅返回第一个元素给 Python 的问题。<a href="https://github.com/PyO3/pyo3/pull/4407">#4407</a></li>
<li>修复 <code>PyList::get_item</code> 中使用借用引用的问题（在自由线程 Python 中不安全）。<a href="https://github.com/PyO3/pyo3/pull/4410">#4410</a></li>
<li>修正 FFI 定义 <code>PyArg_ParseTupleAndKeywords</code>，在 Python 3.13 及更高版本中使用 <code>*const *const c_char</code> 而非 <code>*mut *mut c_char</code>。<a href="https://github.com/PyO3/pyo3/pull/4420">#4420</a></li>
<li>修复 <code>PyClassInitializer</code> 的安全漏洞：如果通过 <code>PyClassInitializer::from(Py&lt;BaseClass&gt;).add_subclass(SubClass)</code> 向已有实例添加子类，则触发 panic。<a href="https://github.com/PyO3/pyo3/pull/4454">#4454</a></li>
<li>修复 <code>__traverse__</code> 处理程序实现中非法的引用计数操作。<a href="https://github.com/PyO3/pyo3/pull/4479">#4479</a></li>
</ul>
<h2 id="0222---2024-07-17"><a class="header" href="#0222---2024-07-17">[0.22.2] - 2024-07-17</a></h2>
<h3 id="打包-8"><a class="header" href="#打包-8">打包</a></h3>
<ul>
<li>要求通过设置环境变量 <code>UNSAFE_PYO3_BUILD_FREE_THREADED=1</code> 显式启用自由线程 Python（PyO3 尚未支持）。<a href="https://github.com/PyO3/pyo3/pull/4327">#4327</a></li>
</ul>
<h3 id="更改-5"><a class="header" href="#更改-5">更改</a></h3>
<ul>
<li>对所有 abi3 版本使用 FFI 函数调用进行引用计数。<a href="https://github.com/PyO3/pyo3/pull/4324">#4324</a></li>
<li><code>#[pymodule(...)]</code> 现在可直接接受所有相关的 <code>#[pyo3(...)]</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/4330">#4330</a></li>
</ul>
<h3 id="已修复-12"><a class="header" href="#已修复-12">已修复</a></h3>
<ul>
<li>修复在 <code>#![no_implicit_prelude]</code> 环境下声明式 <code>#[pymodule]</code> 的编译失败。<a href="https://github.com/PyO3/pyo3/pull/4328">#4328</a></li>
<li>修复在 Rust &lt; 1.79 上因 c-string 字面量导致的编译失败。<a href="https://github.com/PyO3/pyo3/pull/4353">#4353</a></li>
</ul>
<h2 id="0221---2024-07-06"><a class="header" href="#0221---2024-07-06">[0.22.1] - 2024-07-06</a></h2>
<h3 id="新增-11"><a class="header" href="#新增-11">新增</a></h3>
<ul>
<li>为声明式 <code>#[pymodule]</code> 添加 <code>#[pyo3(submodule)]</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/4301">#4301</a></li>
<li>为 <code>Bound&lt;'py, PyBool&gt;</code> 实现 <code>PartialEq&lt;bool&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4305">#4305</a></li>
</ul>
<h3 id="已修复-13"><a class="header" href="#已修复-13">已修复</a></h3>
<ul>
<li>在生成的相等性方法中，比较不同类型时返回 <code>NotImplemented</code> 而非抛出 <code>TypeError</code>。<a href="https://github.com/PyO3/pyo3/pull/4287">#4287</a></li>
<li>支持全路径形式 <code>#[pyo3::prelude::pymodule]</code> 及类似形式在声明式模块中用于 <code>#[pyclass]</code> 和 <code>#[pyfunction]</code>。<a href="https://github.com/PyO3/pyo3/pull/4288">#4288</a></li>
<li>修复在 Python &lt;3.13 且大端平台上 128 位整数的回归问题。<a href="https://github.com/PyO3/pyo3/pull/4291">#4291</a></li>
<li>停止为声明式模块生成永远无法覆盖的代码。<a href="https://github.com/PyO3/pyo3/pull/4297">#4297</a></li>
<li>修复 <code>#[setter]</code> 函数上可选参数尾随产生的无效弃用警告。<a href="https://github.com/PyO3/pyo3/pull/4304">#4304</a></li>
</ul>
<h2 id="0220---2024-06-24"><a class="header" href="#0220---2024-06-24">[0.22.0] - 2024-06-24</a></h2>
<h3 id="打包-9"><a class="header" href="#打包-9">打包</a></h3>
<ul>
<li>将 <code>heck</code> 依赖项更新至 0.5 版本。<a href="https://github.com/PyO3/pyo3/pull/3966">#3966</a></li>
<li>扩展可选依赖 <code>chrono-tz</code> 支持的版本范围，包括 0.10 版本。<a href="https://github.com/PyO3/pyo3/pull/4061">#4061</a></li>
<li>更新最低支持 Rust 版本（MSRV）至 1.63。<a href="https://github.com/PyO3/pyo3/pull/4129">#4129</a>- 添加可选的 <code>num-rational</code> 功能，以支持与 Python 的 <code>fractions.Fraction</code> 类型之间的转换。<a href="https://github.com/PyO3/pyo3/pull/4148">#4148</a></li>
<li>支持 Python 3.13。<a href="https://github.com/PyO3/pyo3/pull/4184">#4184</a></li>
</ul>
<h3 id="新增-12"><a class="header" href="#新增-12">新增</a></h3>
<ul>
<li>添加 <code>PyWeakref</code>、<code>PyWeakrefReference</code> 和 <code>PyWeakrefProxy</code>。<a href="https://github.com/PyO3/pyo3/pull/3835">#3835</a></li>
<li>支持在具有元组变体的枚举上使用 <code>#[pyclass]</code>。<a href="https://github.com/PyO3/pyo3/pull/4072">#4072</a></li>
<li>在 <code>Decimal</code> 转换中添加对科学计数法的支持。<a href="https://github.com/PyO3/pyo3/pull/4079">#4079</a></li>
<li>添加条件编译标志 <code>pyo3_disable_reference_pool</code>，以避免全局引用池的开销（代价是存在已知限制，详见指南中的性能章节）。<a href="https://github.com/PyO3/pyo3/pull/4095">#4095</a></li>
<li>添加 <code>#[pyo3(constructor = (...))]</code>，用于为复杂枚举变体自定义生成的构造函数。<a href="https://github.com/PyO3/pyo3/pull/4158">#4158</a></li>
<li>添加 <code>PyType::module</code>，其始终与 Python 的 <code>__module__</code> 保持一致。<a href="https://github.com/PyO3/pyo3/pull/4196">#4196</a></li>
<li>添加 <code>PyType::fully_qualified_name</code>，其与 <a href="https://peps.python.org/pep-0737">PEP 737</a> 中定义的“完全限定名称”相匹配。<a href="https://github.com/PyO3/pyo3/pull/4196">#4196</a></li>
<li>添加 <code>PyTypeMethods::mro</code> 和 <code>PyTypeMethods::bases</code>。<a href="https://github.com/PyO3/pyo3/pull/4197">#4197</a></li>
<li>添加 <code>#[pyclass(ord)]</code>，以基于 <code>PartialOrd</code> 实现排序。<a href="https://github.com/PyO3/pyo3/pull/4202">#4202</a></li>
<li>为 <code>PyBackedStr</code> 和 <code>PyBackedBytes</code> 实现 <code>ToPyObject</code> 和 <code>IntoPy&lt;PyObject&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4205">#4205</a></li>
<li>添加 <code>#[pyclass(hash)]</code> 选项，以基于 <code>Hash</code> 实现生成 <code>__hash__</code>。<a href="https://github.com/PyO3/pyo3/pull/4206">#4206</a></li>
<li>添加 <code>#[pyclass(eq)]</code> 选项，以基于 <code>PartialEq</code> 生成 <code>__eq__</code>，以及 <code>#[pyclass(eq_int)]</code> 选项，用于为简单枚举基于其判别值实现相等性。<a href="https://github.com/PyO3/pyo3/pull/4210">#4210</a></li>
<li>为 <code>PyClassInitializer&lt;T&gt;</code> 实现 <code>From&lt;Bound&lt;'py, T&gt;&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4214">#4214</a></li>
<li>为 <code>PyRef</code> 和 <code>PyRefMut</code> 添加 <code>as_super</code> 方法，用于通过引用来访问基类。<a href="https://github.com/PyO3/pyo3/pull/4219">#4219</a></li>
<li>为 <code>Bound&lt;'py, PyString&gt;</code> 实现 <code>PartialEq&lt;str&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4245">#4245</a></li>
<li>在 PyPy 上实现 <code>PyModuleMethods::filename</code>。<a href="https://github.com/PyO3/pyo3/pull/4249">#4249</a></li>
<li>为 <code>Bound&lt;'py, PyBytes&gt;</code> 实现 <code>PartialEq&lt;[u8]&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/4250">#4250</a></li>
<li>添加 <code>pyo3_ffi::c_str</code> 宏，用于在不支持 Rust 1.77 的 <code>c""</code> 字面量的版本上创建 <code>'static CStr</code>。<a href="https://github.com/PyO3/pyo3/pull/4255">#4255</a></li>
<li>支持与 <code>numpy</code> 2.0 的 <code>numpy.bool</code> 类型进行 <code>bool</code> 转换。<a href="https://github.com/PyO3/pyo3/pull/4258">#4258</a></li>
<li>添加 <code>PyAnyMethods::{bitnot, matmul, floor_div, rem, divmod}</code>。<a href="https://github.com/PyO3/pyo3/pull/4264">#4264</a></li>
</ul>
<h3 id="更改-6"><a class="header" href="#更改-6">更改</a></h3>
<ul>
<li>更改 <code>PySliceIndices::slicelength</code> 的类型以及 <code>PySlice::indices()</code> 的 <code>length</code> 参数的类型。<a href="https://github.com/PyO3/pyo3/pull/3761">#3761</a></li>
<li>弃用对尾随可选参数的隐式默认值。<a href="https://github.com/PyO3/pyo3/pull/4078">#4078</a></li>
<li>将 Python 堆内指针的 <code>Clone</code> 操作移至 <code>py-clone</code> 特性后方，因为它在未持有 GIL 时必须 panic，此为一项健全性修复。<a href="https://github.com/PyO3/pyo3/pull/4095">#4095</a></li>
<li>为所有可能 panic 的 <code>Py&lt;T&gt;</code>、<code>Bound&lt;'py, T&gt;</code> 和 <code>Borrowed&lt;'a, 'py, T&gt;</code> 方法添加 <code>#[track_caller]</code>。<a href="https://github.com/PyO3/pyo3/pull/4098">#4098</a></li>
<li>更改 <code>PyAnyMethods::dir</code> 为可失败的，返回 <code>PyResult&lt;Bound&lt;'py, PyList&gt;&gt;</code>（<code>PyAny::dir</code> 同理）。<a href="https://github.com/PyO3/pyo3/pull/4100">#4100</a></li>
<li>全局引用池（用于跟踪待处理的引用计数递减）现在改为懒初始化，以避免在未实际使用该功能时于函数入口处获取互斥锁的开销。<a href="https://github.com/PyO3/pyo3/pull/4178">#4178</a></li>
<li>当为旧于 Python 3.9 版本的 <code>abi3</code> 编译时，若使用 <code>weakref</code> 或 <code>dict</code>，将发出错误信息。<a href="https://github.com/PyO3/pyo3/pull/4194">#4194</a></li>
<li>更改 <code>PyType::name</code> 以始终与 Python 的 <code>__name__</code> 保持一致。<a href="https://github.com/PyO3/pyo3/pull/4196">#4196</a></li>
<li>移除用于复数的 CPython 内部 FFI 调用，包括：add、sub、mul、div、neg、abs、pow。新增 PyAnyMethods::{abs, pos, neg} <a href="https://github.com/PyO3/pyo3/pull/4201">#4201</a></li>
<li>弃用简单枚举的隐式整数比较，推荐使用 <code>#[pyclass(eq_int)]</code>。<a href="https://github.com/PyO3/pyo3/pull/4210">#4210</a></li>
<li>设置声明式模块的子模块 <code>#[pymodule]</code> 和 <code>#[pyclass]</code> 的 <code>module=</code> 属性。<a href="https://github.com/PyO3/pyo3/pull/4213">#4213</a></li>
<li>为复杂枚举变体的 <code>module</code> 选项设置与其所属复杂枚举相同的值。<a href="https://github.com/PyO3/pyo3/pull/4228">#4228</a></li>
<li>在 PyPy 或 GraalPy 上构建 <code>abi3</code> 特性时，遵循 Python “有限 API” 规范。<a href="https://github.com/PyO3/pyo3/pull/4237">#4237</a></li>
<li>优化 <code>#[pyclass]</code> 字段上 <code>#[pyo3(get)]</code> 生成的代码。<a href="https://github.com/PyO3/pyo3/pull/4254">#4254</a></li>
<li><code>PyCFunction::new</code>、<code>PyCFunction::new_with_keywords</code> 和 <code>PyCFunction::new_closure</code> 现在接受 <code>'static CStr</code> 类型的 name 和 doc 参数（之前为 <code>'static str</code>）。<a href="https://github.com/PyO3/pyo3/pull/4255">#4255</a></li>
<li><code>experimental-declarative-modules</code> 特性现已稳定并默认启用。<a href="https://github.com/PyO3/pyo3/pull/4257">#4257</a></li>
</ul>
<h3 id="修复-5"><a class="header" href="#修复-5">修复</a></h3>
<ul>
<li>修复当 <code>PYO3_CROSS_LIB_DIR</code> 设置为不存在路径时的 panic。<a href="https://github.com/PyO3/pyo3/pull/4043">#4043</a></li>
<li>修复使用 <code>declarative-module</code> 特性导出位于不同 Rust 模块中、通过 <code>create_exception!</code> 创建的异常时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4086">#4086</a></li>
<li>修正 <code>PY_VECTORCALL_ARGUMENTS_OFFSET</code> 和 <code>PyVectorcall_NARGS</code> 的 FFI 定义，以修复一个误报的断言。<a href="https://github.com/PyO3/pyo3/pull/4104">#4104</a></li>
<li>在 PyPy 上禁用 <code>PyUnicode_DATA</code>：PyPy 未暴露此符号。<a href="https://github.com/PyO3/pyo3/pull/4116">#4116</a></li>
<li>正确处理 <code>#[pyo3(from_py_with = ...)]</code> 属性，不再对双下划线（<code>__magic__</code>）方法参数静默忽略。<a href="https://github.com/PyO3/pyo3/pull/4117">#4117</a></li>
<li>修复在声明以 Python 名为 Rust 关键字的独立函数或类方法时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4226">#4226</a></li>
<li>修复声明式模块忽略 <code>mod</code> 节点上文档注释的问题。<a href="https://github.com/PyO3/pyo3/pull/4236">#4236</a></li>
<li>修复在 Python 3.9 上为 <code>abi3</code> 构建时，<code>#[pyclass(dict)]</code> 实例缺少 <code>__dict__</code> 属性的问题。<a href="https://github.com/PyO3/pyo3/pull/4251">#4251</a></li>
</ul>
<h2 id="0212---2024-04-16"><a class="header" href="#0212---2024-04-16">[0.21.2] - 2024-04-16</a></h2>
<h3 id="更改-7"><a class="header" href="#更改-7">更改</a></h3>
<ul>
<li>弃用 <code>PySet::empty()</code> 的持有 GIL 的构造函数。<a href="https://github.com/PyO3/pyo3/pull/4082">#4082</a></li>
</ul>
<h3 id="修复-6"><a class="header" href="#修复-6">修复</a></h3>
<ul>
<li>修复在 <code>#[pymethods]</code> 中使用 <code>async fn</code> 且接收者为 <code>&amp;self</code> 且有多个额外参数时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4035">#4035</a></li>
<li>改进 <code>__traverse__</code> 中错误接收器类型的错误提示信息。<a href="https://github.com/PyO3/pyo3/pull/4045">#4045</a></li>
<li>修复使用 <code>experimental-declarative-modules</code> 特性导出位于不同 Rust 模块中的 <code>#[pyclass]</code> 时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4054">#4054</a></li>
<li>修复在有文档的 <code>#[pymodule]</code> 函数上触发 <code>missing_docs</code> lint 的问题。<a href="https://github.com/PyO3/pyo3/pull/4067">#4067</a></li>
<li>修复在 AIX 上扩展模块的未定义符号错误（通过链接 <code>libpython</code> 解决）。<a href="https://github.com/PyO3/pyo3/pull/4073">#4073</a></li>
</ul>
<h2 id="0211---2024-04-01"><a class="header" href="#0211---2024-04-01">[0.21.1] - 2024-04-01</a></h2>
<h3 id="新增-13"><a class="header" href="#新增-13">新增</a></h3>
<ul>
<li>为 <code>PyBackedStr</code> 和 <code>PyBackedBytes</code> 实现 <code>Send</code> 和 <code>Sync</code>。<a href="https://github.com/PyO3/pyo3/pull/4007">#4007</a></li>
<li>为 <code>PyBackedBytes</code> 和 <code>PyBackedStr</code> 实现 <code>Clone</code>、<code>Debug</code>、<code>PartialEq</code>、<code>Eq</code>、<code>PartialOrd</code>、<code>Ord</code> 和 <code>Hash</code>，并为 <code>PyBackedStr</code> 实现 <code>Display</code>。<a href="https://github.com/PyO3/pyo3/pull/4020">#4020</a></li>
<li>添加 <code>import_exception_bound!</code> 宏，用于导入异常类型而不为它们生成 GIL Ref 功能。<a href="https://github.com/PyO3/pyo3/pull/4027">#4027</a></li>
</ul>
<h3 id="更改-8"><a class="header" href="#更改-8">更改</a></h3>
<ul>
<li>对在 <code>#[setter]</code> 函数参数中使用 GIL Refs 的情况发出弃用警告。<a href="https://github.com/PyO3/pyo3/pull/3998">#3998</a></li>
<li>为许多 <code>Bound</code> 和 <code>Borrowed</code> 方法添加 <code>#[inline]</code> 提示。<a href="https://github.com/PyO3/pyo3/pull/4024">#4024</a></li>
</ul>
<h3 id="修复-7"><a class="header" href="#修复-7">修复</a></h3>
<ul>
<li>处理 <code>#[pyo3(from_py_with = "")]</code> 在 <code>#[setter]</code> 方法中的使用。<a href="https://github.com/PyO3/pyo3/pull/3995">#3995</a></li>
<li>允许在 <code>#[setter]</code> 方法中提取 <code>&amp;Bound</code>。<a href="https://github.com/PyO3/pyo3/pull/3998">#3998</a></li>
<li>修复 <code>#[pymodule]</code>、<code>#[pyfunction]</code> 和 <code>#[pyclass]</code> 宏产生的一些未覆盖的代码块。<a href="https://github.com/PyO3/pyo3/pull/4009">#4009</a></li>
<li>修复当 <code>pyo3::import_exception!</code> 中引用的类不存在时，panic 消息中的拼写错误。<a href="https://github.com/PyO3/pyo3/pull/4012">#4012</a></li>
<li>修复在使用带有接收者和额外参数的异步 <code>#[pymethod]</code> 时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/4015">#4015</a></li>
</ul>
<h2 id="0210---2024-03-25"><a class="header" href="#0210---2024-03-25">[0.21.0] - 2024-03-25</a></h2>
<h3 id="新增-14"><a class="header" href="#新增-14">新增</a></h3>
<ul>
<li>添加对 GraalPy（24.0 及以上版本）的支持。<a href="https://github.com/PyO3/pyo3/pull/3247">#3247</a></li>
<li>添加 <code>PyMemoryView</code> 类型。<a href="https://github.com/PyO3/pyo3/pull/3514">#3514</a></li>
<li>在启用 <code>experimental-async</code> 特性时，允许 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 中使用 <code>async fn</code>。<a href="https://github.com/PyO3/pyo3/pull/3540">#3540</a> <a href="https://github.com/PyO3/pyo3/pull/3588">#3588</a> <a href="https://github.com/PyO3/pyo3/pull/3599">#3599</a> <a href="https://github.com/PyO3/pyo3/pull/3931">#3931</a></li>
<li>为 <code>PyEllipsis</code>、<code>PyNone</code> 和 <code>PyNotImplemented</code> 实现 <code>PyTypeInfo</code>。<a href="https://github.com/PyO3/pyo3/pull/3577">#3577</a></li>
<li>支持在具有非单元变体的枚举上使用 <code>#[pyclass]</code>。<a href="https://github.com/PyO3/pyo3/pull/3582">#3582</a></li>
<li>支持 <code>chrono</code> 特性与 <code>abi3</code> 特性共用。<a href="https://github.com/PyO3/pyo3/pull/3664">#3664</a></li>
<li>为 <code>std::duration::Duration</code> 实现 <code>FromPyObject</code>、<code>IntoPy&lt;PyObject&gt;</code> 和 <code>ToPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/3670">#3670</a>- 添加 <code>PyString::to_cow</code>。添加 <code>Py&lt;PyString&gt;::to_str</code>、<code>Py&lt;PyString&gt;::to_cow</code> 和 <code>Py&lt;PyString&gt;::to_string_lossy</code>，作为在 GIL 生命周期之外安全访问 Python 字符串数据的方法。<a href="https://github.com/PyO3/pyo3/pull/3677">#3677</a></li>
<li>添加 <code>Bound&lt;T&gt;</code> 和 <code>Borrowed&lt;T&gt;</code> 智能指针，作为访问 Python 对象的新 API。<a href="https://github.com/PyO3/pyo3/pull/3686">#3686</a></li>
<li>添加 <code>PyNativeType::as_borrowed</code>，用于将“GIL 引用”转换为新的 <code>Bound</code> 智能指针。<a href="https://github.com/PyO3/pyo3/pull/3692">#3692</a></li>
<li>添加 <code>FromPyObject::extract_bound</code> 方法，用于将 <code>FromPyObject</code> 的实现迁移到 Bound API。<a href="https://github.com/PyO3/pyo3/pull/3706">#3706</a></li>
<li>添加 <code>gil-refs</code> 特性，允许继续使用已弃用的 GIL 引用 API。<a href="https://github.com/PyO3/pyo3/pull/3707">#3707</a></li>
<li>为 <code>PyAnyMethods</code> 添加二元运算符方法（<code>add</code>、<code>sub</code> 等）。<a href="https://github.com/PyO3/pyo3/pull/3712">#3712</a></li>
<li>添加 <code>chrono-tz</code> 特性，允许在 <code>chrono_tz::Tz</code> 和 <code>zoneinfo.ZoneInfo</code> 之间进行转换。<a href="https://github.com/PyO3/pyo3/pull/3730">#3730</a></li>
<li>添加 FFI 定义 <code>PyType_GetModuleByDef</code>。<a href="https://github.com/PyO3/pyo3/pull/3734">#3734</a></li>
<li>添加 <code>std::time::SystemTime</code> 与 <code>datetime.datetime</code> 之间的转换。<a href="https://github.com/PyO3/pyo3/pull/3736">#3736</a></li>
<li>添加 <code>Py::as_any</code> 和 <code>Py::into_any</code>。<a href="https://github.com/PyO3/pyo3/pull/3785">#3785</a></li>
<li>添加 <code>PyStringMethods::encode_utf8</code>。<a href="https://github.com/PyO3/pyo3/pull/3801">#3801</a></li>
<li>添加 <code>PyBackedStr</code> 和 <code>PyBackedBytes</code>，在 Python 对象拥有数据时作为 <code>&amp;str</code> 和 <code>&amp;[u8]</code> 的替代方案。<a href="https://github.com/PyO3/pyo3/pull/3802">#3802</a> <a href="https://github.com/PyO3/pyo3/pull/3991">#3991</a></li>
<li>允许在 Rust <code>mod</code> 块上使用 <code>#[pymodule]</code> 宏，配合 <code>experimental-declarative-modules</code> 特性。<a href="https://github.com/PyO3/pyo3/pull/3815">#3815</a></li>
<li>在启用 <code>abi3</code> 特性时，为 <code>set</code> 和 <code>frozenset</code> 迭代器实现 <code>ExactSizeIterator</code>。<a href="https://github.com/PyO3/pyo3/pull/3849">#3849</a></li>
<li>添加 <code>Py::drop_ref</code>，可在已持有 GIL 时显式释放 <code>Py</code> 并立即减少 Python 引用计数。<a href="https://github.com/PyO3/pyo3/pull/3871">#3871</a></li>
<li>允许在接收单个 <code>&amp;Bound&lt;'_, PyModule&gt;</code> 参数的函数上使用 <code>#[pymodule]</code> 宏。<a href="https://github.com/PyO3/pyo3/pull/3905">#3905</a></li>
<li>为 <code>Cow&lt;str&gt;</code> 实现 <code>FromPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/3928">#3928</a></li>
<li>为 <code>GILOnceCell</code> 实现 <code>Default</code>。<a href="https://github.com/PyO3/pyo3/pull/3971">#3971</a></li>
<li>添加 <code>PyDictMethods::into_mapping</code>、<code>PyListMethods::into_sequence</code> 和 <code>PyTupleMethods::into_sequence</code>。<a href="https://github.com/PyO3/pyo3/pull/3982">#3982</a></li>
</ul>
<h3 id="变更-4"><a class="header" href="#变更-4">变更</a></h3>
<ul>
<li><code>PyDict::from_sequence</code> 现在接受单一 <code>&amp;PyAny</code> 类型参数（之前接受两个参数 <code>Python</code> 和 <code>PyObject</code>）。<a href="https://github.com/PyO3/pyo3/pull/3532">#3532</a></li>
<li>不推荐使用 <code>Py::is_ellipsis</code> 和 <code>PyAny::is_ellipsis</code>，建议改用 <code>any.is(py.Ellipsis())</code>。<a href="https://github.com/PyO3/pyo3/pull/3577">#3577</a></li>
<li>将部分 <code>PyTypeInfo</code> 功能拆分成新的 <code>HasPyGilRef</code> 和 <code>PyTypeCheck</code> trait。<a href="https://github.com/PyO3/pyo3/pull/3600">#3600</a></li>
<li>不推荐使用 <code>PyTryFrom</code> 和 <code>PyTryInto</code> trait，建议通过 <code>PyTypeCheck</code> 和 <code>PyTypeInfo</code> trait 使用 <code>any.downcast()</code>。<a href="https://github.com/PyO3/pyo3/pull/3601">#3601</a></li>
<li>允许异步方法接收 <code>&amp;self</code>/<code>&amp;mut self</code>。<a href="https://github.com/PyO3/pyo3/pull/3609">#3609</a></li>
<li><code>FromPyObject</code> 对于集合类型现在也可以接受 <code>frozenset</code> 对象作为输入。<a href="https://github.com/PyO3/pyo3/pull/3632">#3632</a></li>
<li><code>FromPyObject</code> 对于 <code>bool</code> 现在也可以接受 NumPy 的 <code>bool_</code> 类型作为输入。<a href="https://github.com/PyO3/pyo3/pull/3638">#3638</a></li>
<li>为 <code>PyNativeType</code> 添加 <code>AsRefSource</code> 关联类型。<a href="https://github.com/PyO3/pyo3/pull/3653">#3653</a></li>
<li>将 <code>PyAny</code> 和 <code>Py&lt;PyAny&gt;</code> 上的 <code>.is_true</code> 重命名为 <code>.is_truthy</code>，以澄清该测试并非基于与 True 单例的身份或相等性比较。<a href="https://github.com/PyO3/pyo3/pull/3657">#3657</a></li>
<li><code>PyType::name</code> 现在是 <code>PyType::qualname</code>，而 <code>PyType::name</code> 高效地访问包含模块名的完整名称。<a href="https://github.com/PyO3/pyo3/pull/3660">#3660</a></li>
<li><code>Iter(A)NextOutput</code> 类型现已弃用，<code>__(a)next__</code> 可以直接返回任何可转换为 Python 对象的类型，即 awaitable 不再需要包装在 <code>IterANextOutput</code> 或 <code>Option</code> 中。<code>Option</code> 仍可使用，返回 <code>None</code> 将触发 <code>__next__</code> 的快速路径，停止迭代而无需引发 <code>StopIteration</code> 异常。<a href="https://github.com/PyO3/pyo3/pull/3661">#3661</a></li>
<li>为 <code>chrono::DateTime&lt;Tz&gt;</code> 中所有 <code>Tz</code> 类型实现 <code>FromPyObject</code>，不再仅限于 <code>FixedOffset</code> 和 <code>Utc</code>。<a href="https://github.com/PyO3/pyo3/pull/3663">#3663</a></li>
<li>为 <code>PyTzInfoAccess</code> trait 添加生命周期参数。对于已弃用的 GIL 引用 API，该 trait 现在实现于 <code>&amp;'py PyTime</code> 和 <code>&amp;'py PyDateTime</code> 而非 <code>PyTime</code> 和 <code>PyDate</code>。<a href="https://github.com/PyO3/pyo3/pull/3679">#3679</a></li>
<li>当在错误线程上调用时，对不可发送的 pyclass 的 <code>__traverse__</code> 调用变为无操作，从而避免硬中止，但可能造成内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/3689">#3689</a></li>
<li>将 <code>PyNativeType</code> 添加到 <code>pyo3::prelude</code> 中。<a href="https://github.com/PyO3/pyo3/pull/3692">#3692</a></li>
<li>通过避免在 Python 3.10+ 上调用 <code>__index__()</code> 来提升 <code>extract::&lt;i64&gt;</code>（及其他整数类型）的性能，直接转换值为整数，成功提取时性能提升约 30%。<a href="https://github.com/PyO3/pyo3/pull/3742">#3742</a></li>
<li>将 <code>FromPyObject</code> 对于 <code>Py&lt;T&gt;</code> 的边界放宽为仅要求 <code>T: PyTypeCheck</code>。<a href="https://github.com/PyO3/pyo3/pull/3776">#3776</a></li>
<li><code>PySet</code> 和 <code>PyFrozenSet</code> 迭代器现在始终等效于 <code>iter(set)</code> 的迭代。（移除了无明显性能优势的“快速路径”。）<a href="https://github.com/PyO3/pyo3/pull/3849">#3849</a></li>
<li>当 <code>gil-refs</code> 特性未启用时，将 <code>FromPyObject</code> 对于 <code>&amp;str</code>、<code>Cow&lt;str&gt;</code>、<code>&amp;[u8]</code> 和 <code>Cow&lt;[u8]&gt;</code> 的实现转移到临时 trait <code>FromPyObjectBound</code> 上。<a href="https://github.com/PyO3/pyo3/pull/3928">#3928</a></li>
<li>不推荐使用 <code>GILPool</code>、<code>Python::with_pool</code> 和 <code>Python::new_pool</code>。<a href="https://github.com/PyO3/pyo3/pull/3947">#3947</a></li>
</ul>
<h3 id="移除-2"><a class="header" href="#移除-2">移除</a></h3>
<ul>
<li>移除 PyO3 0.19 中已弃用的所有功能。<a href="https://github.com/PyO3/pyo3/pull/3603">#3603</a></li>
</ul>
<h3 id="修复-8"><a class="header" href="#修复-8">修复</a></h3>
<ul>
<li>匹配 PyPy 7.3.14，移除 PyPy 专有的符号 <code>Py_MAX_NDIMS</code>，改用 <code>PyBUF_MAX_NDIM</code>。<a href="https://github.com/PyO3/pyo3/pull/3757">#3757</a></li>
<li>修复当 <code>sys.path</code> 上存在无效 <code>datetime</code> 模块时使用 <code>datetime</code> 类型导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/3818">#3818</a></li>
<li>修复因 PyO3 宏触发的 <code>non_local_definitions</code> lint 警告。<a href="https://github.com/PyO3/pyo3/pull/3901">#3901</a></li>
<li>在 PyPy 上禁用 <code>PyCode</code> 和 <code>PyCode_Type</code>：PyPy 未暴露 <code>PyCode_Type</code>。<a href="https://github.com/PyO3/pyo3/pull/3934">#3934</a></li>
</ul>
<h2 id="0210-beta0---2024-03-10"><a class="header" href="#0210-beta0---2024-03-10">[0.21.0-beta.0] - 2024-03-10</a></h2>
<p>PyO3 0.21 的预发布版本。有关 0.21.0-beta.0 与最终版本之间的变更，请参阅 <a href="https://github.com/pyo3/pyo3/compare/v0.21.0-beta.0...v0.21.0">GitHub 差异</a>。</p>
<h2 id="0203---2024-02-23"><a class="header" href="#0203---2024-02-23">[0.20.3] - 2024-02-23</a></h2>
<h3 id="打包-10"><a class="header" href="#打包-10">打包</a></h3>
<ul>
<li>添加 <code>portable-atomic</code> 依赖。<a href="https://github.com/PyO3/pyo3/pull/3619">#3619</a></li>
<li>在构建时检查 Python 最高版本，对于尚未支持的版本，要求通过环境变量 <code>PYO3_USE_ABI3_FORWARD_COMPATIBILITY=1</code> 显式选择使用 <code>abi3</code> 稳定 ABI。<a href="https://github.com/PyO3/pyo3/pull/3821">#3821</a></li>
</ul>
<h3 id="修复-9"><a class="header" href="#修复-9">修复</a></h3>
<ul>
<li>使用 <code>portable-atomic</code> 支持无 64 位原子操作的平台。<a href="https://github.com/PyO3/pyo3/pull/3619">#3619</a></li>
<li>修复在启用 <code>either</code> 特性但未启用 <code>experimental-inspect</code> 时的编译失败。<a href="https://github.com/PyO3/pyo3/pull/3834">#3834</a></li>
</ul>
<h2 id="0202---2024-01-04"><a class="header" href="#0202---2024-01-04">[0.20.2] - 2024-01-04</a></h2>
<h3 id="打包-11"><a class="header" href="#打包-11">打包</a></h3>
<ul>
<li>将 <code>pyo3</code> 和 <code>pyo3-ffi</code> 对 <code>pyo3-build-config</code> 的依赖固定为要求相同的补丁版本，即 <code>pyo3</code> 0.20.2 严格依赖 <code>pyo3-build-config</code> 0.20.2。<a href="https://github.com/PyO3/pyo3/pull/3721">#3721</a></li>
</ul>
<h3 id="修复-10"><a class="header" href="#修复-10">修复</a></h3>
<ul>
<li>修复 <code>pyo3</code> 0.20.0 与最新 <code>pyo3-build-config</code> 0.20.X 构建时的编译失败。<a href="https://github.com/PyO3/pyo3/pull/3724">#3724</a></li>
<li>修复 docs.rs 构建。<a href="https://github.com/PyO3/pyo3/pull/3722">#3722</a></li>
</ul>
<h2 id="0201---2023-12-30"><a class="header" href="#0201---2023-12-30">[0.20.1] - 2023-12-30</a></h2>
<h3 id="新增-15"><a class="header" href="#新增-15">新增</a></h3>
<ul>
<li>添加可选 <code>either</code> 特性，支持 <code>either::Either&lt;L, R&gt;</code> 和类型的转换。<a href="https://github.com/PyO3/pyo3/pull/3456">#3456</a></li>
<li>添加可选 <code>smallvec</code> 特性，支持 <code>smallvec::SmallVec</code> 的转换。<a href="https://github.com/PyO3/pyo3/pull/3507">#3507</a></li>
<li>为 <code>GILOnceCell</code> 添加 <code>take</code> 和 <code>into_inner</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/3556">#3556</a></li>
<li><code>#[classmethod]</code> 方法现在也可以接收 <code>Py&lt;PyType&gt;</code> 作为第一个参数。<a href="https://github.com/PyO3/pyo3/pull/3587">#3587</a></li>
<li><code>#[pyfunction(pass_module)]</code> 现在也可以接收 <code>Py&lt;PyModule&gt;</code> 作为第一个参数。<a href="https://github.com/PyO3/pyo3/pull/3587">#3587</a></li>
<li>为 <code>GILProtected</code> 添加 <code>traverse</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/3616">#3616</a></li>
<li>添加 <code>abi3-py312</code> 特性。<a href="https://github.com/PyO3/pyo3/pull/3687">#3687</a></li>
</ul>
<h3 id="修复-11"><a class="header" href="#修复-11">修复</a></h3>
<ul>
<li>修复可选 <code>chrono</code> 依赖项的最低版本规范。<a href="https://github.com/PyO3/pyo3/pull/3512">#3512</a></li>
<li>消除在使用 <code>Py&lt;Self&gt;</code> 作为 <code>self</code> 接收器时触发的 <code>clippy::unnecessary_fallible_conversions</code> 新警告。<a href="https://github.com/PyO3/pyo3/pull/3564">#3564</a></li>
</ul>
<h2 id="0200---2023-10-11"><a class="header" href="#0200---2023-10-11">[0.20.0] - 2023-10-11</a></h2>
<h3 id="打包-12"><a class="header" href="#打包-12">打包</a></h3>
<ul>
<li>
<p>以 Apache 2.0 或 MIT 许可证双许可 PyO3，使项目兼容 GPLv2。<a href="https://github.com/PyO3/pyo3/pull/3108">#3108</a></p>
</li>
<li>
<p>更新最低支持 Rust 版本（MSRV）为 Rust 1.56。<a href="https://github.com/PyO3/pyo3/pull/3208">#3208</a></p>
</li>
<li>
<p>将 <code>indoc</code> 依赖升级至 2.0，<code>unindent</code> 依赖升级至 0.2。<a href="https://github.com/PyO3/pyo3/pull/3237">#3237</a></p>
</li>
<li>
<p>将 <code>syn</code> 依赖升级至 2.0。<a href="https://github.com/PyO3/pyo3/pull/3239">#3239</a></p>
</li>
<li>
<p>停止支持 Python 3.7 的调试构建。<a href="https://github.com/PyO3/pyo3/pull/3387">#3387</a></p>
</li>
<li>
<p>升级可选依赖 <code>chrono</code> 至要求 0.4.25 或更高版本。<a href="https://github.com/PyO3/pyo3/pull/3427">#3427</a></p>
</li>
<li>
<p>支持 Python 3.12。<a href="https://github.com/PyO3/pyo3/pull/3488">#3488</a>### 新增</p>
</li>
<li>
<p>在 <code>#[pymethods]</code> 中支持 <code>__lt__</code>、<code>__le__</code>、<code>__eq__</code>、<code>__ne__</code>、<code>__gt__</code> 和 <code>__ge__</code>。<a href="https://github.com/PyO3/pyo3/pull/3203">#3203</a></p>
</li>
<li>
<p>添加 FFI 定义 <code>Py_GETENV</code>。<a href="https://github.com/PyO3/pyo3/pull/3336">#3336</a></p>
</li>
<li>
<p>为 <code>Py</code>、<code>PyAny</code>、<code>PyRef</code> 和 <code>PyRefMut</code> 添加 <code>as_ptr</code> 和 <code>into_ptr</code> 固有方法。<a href="https://github.com/PyO3/pyo3/pull/3359">#3359</a></p>
</li>
<li>
<p>为 <code>PyTupleIterator</code> 和 <code>PyListIterator</code> 实现 <code>DoubleEndedIterator</code>。<a href="https://github.com/PyO3/pyo3/pull/3366">#3366</a></p>
</li>
<li>
<p>添加 <code>#[pyclass(rename_all = "...")]</code> 选项：允许重命名结构体的所有 getter 和 setter，或枚举的所有变体。支持的重命名规则包括：“camelCase”、“kebab-case”、“lowercase”、“PascalCase”、“SCREAMING-KEBAB-CASE”、“SCREAMING_SNAKE_CASE”、“snake_case”、“UPPERCASE”。<a href="https://github.com/PyO3/pyo3/pull/3384">#3384</a></p>
</li>
<li>
<p>在 Python 3.9 及更高版本（PyPy 3.10 及更高版本）中添加 FFI 定义 <code>PyObject_GC_IsTracked</code> 和 <code>PyObject_GC_IsFinalized</code>。<a href="https://github.com/PyO3/pyo3/pull/3403">#3403</a></p>
</li>
<li>
<p>添加对 <code>None</code>、<code>Ellipsis</code> 和 <code>NotImplemented</code> 的类型支持。<a href="https://github.com/PyO3/pyo3/pull/3408">#3408</a></p>
</li>
<li>
<p>添加 <code>Py_mod_multiple_interpreters</code> 常量及其可能值的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/3494">#3494</a></p>
</li>
<li>
<p>添加 <code>PyInterpreterConfig</code> 结构体、其常量以及 <code>Py_NewInterpreterFromConfig</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/3502">#3502</a></p>
</li>
</ul>
<h3 id="更改-9"><a class="header" href="#更改-9">更改</a></h3>
<ul>
<li>将 <code>PySet::discard</code> 的返回值改为 <code>PyResult&lt;bool&gt;</code>（之前无返回值）。<a href="https://github.com/PyO3/pyo3/pull/3281">#3281</a></li>
<li>优化 Rust 元组到 Python 元组的 <code>IntoPy</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/3321">#3321</a></li>
<li>更改 <code>PyDict::get_item</code> 不再抑制任意异常（返回类型现在是 <code>PyResult&lt;Option&lt;&amp;PyAny&gt;&gt;</code> 而非 <code>Option&lt;&amp;PyAny&gt;</code>），并弃用 <code>PyDict::get_item_with_error</code>。<a href="https://github.com/PyO3/pyo3/pull/3330">#3330</a></li>
<li>弃用在 Python 3.12 中已被弃用的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/3336">#3336</a></li>
<li><code>AsPyPointer</code> 现在是一个 <code>unsafe trait</code>。<a href="https://github.com/PyO3/pyo3/pull/3358">#3358</a></li>
<li>在 <code>PathBuf</code> 的 <code>FromPyObject</code> 实现中接受所有 <code>os.PathLike</code> 类型的值。<a href="https://github.com/PyO3/pyo3/pull/3374">#3374</a></li>
<li>在 <code>py.run()</code> 和 <code>py.eval()</code> 中如果缺失，则向全局变量添加 <code>__builtins__</code>。<a href="https://github.com/PyO3/pyo3/pull/3378">#3378</a></li>
<li>优化 <code>BigInt</code> 和 <code>BigUint</code> 的 <code>FromPyObject</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/3379">#3379</a></li>
<li><code>PyIterator::from_object</code> 和 <code>PyByteArray::from</code> 现在接受单一参数类型为 <code>&amp;PyAny</code>（之前接受两个参数：<code>Python</code> 和 <code>AsPyPointer</code>）。<a href="https://github.com/PyO3/pyo3/pull/3389">#3389</a></li>
<li>在 <code>From&lt;&amp;T&gt; for PyObject</code> 的泛型实现中，将 <code>AsPyPointer</code> 替换为 <code>AsRef&lt;PyAny&gt;</code> 作为约束。<a href="https://github.com/PyO3/pyo3/pull/3391">#3391</a></li>
<li>将泛型 <code>impl IntoPy&lt;PyObject&gt; for &amp;T where T: AsPyPointer</code> 替换为 <code>impl IntoPy&lt;PyObject&gt;</code> 对 <code>&amp;PyAny</code>、<code>&amp;T where T: AsRef&lt;PyAny&gt;</code> 和 <code>&amp;Py&lt;T&gt;</code> 的具体实现。<a href="https://github.com/PyO3/pyo3/pull/3393">#3393</a></li>
<li>在 <code>From&lt;std::io::IntoInnerError&gt;</code> 到 <code>PyErr</code> 的实现中保留 <code>std::io::Error</code> 的种类。<a href="https://github.com/PyO3/pyo3/pull/3396">#3396</a></li>
<li>在 <code>From&lt;PyErr&gt;</code> 到 <code>OSError</code> 子类的实现中尝试选择相关的 <code>ErrorKind</code>。<a href="https://github.com/PyO3/pyo3/pull/3397">#3397</a></li>
<li>在 <code>From&lt;std::io::Error&gt;</code> 到 <code>PyErr</code> 的实现中，若 <code>std::io::Error</code> 是基于 Python 异常构建的，则恢复原始的 <code>PyErr</code>（之前会创建一个新的包装 <code>std::io::Error</code> 的异常）。<a href="https://github.com/PyO3/pyo3/pull/3402">#3402</a></li>
<li>在 Python 3.9 及更高版本中，<code>#[pymodule]</code> 在同一 Python 解释器内重复导入时将返回相同的模块对象。<a href="https://github.com/PyO3/pyo3/pull/3446">#3446</a></li>
<li>在将 <code>chrono</code> 类型转换为 Python 的 <code>datetime</code> 类型时截断闰秒并发出警告（<code>datetime</code> 无法表示闰秒）。<a href="https://github.com/PyO3/pyo3/pull/3458">#3458</a></li>
<li>从 <code>catch</code> 块内部调用 <code>#[pyfunction]</code> 返回的 <code>Err</code> 现在会有非 None 的 <code>__context__</code>。<a href="https://github.com/PyO3/pyo3/pull/3455">#3455</a></li>
<li>弃用未记录的 <code>#[new]</code> 属性的 <code>#[__new__]</code> 形式。<a href="https://github.com/PyO3/pyo3/pull/3505">#3505</a></li>
</ul>
<h3 id="移除-3"><a class="header" href="#移除-3">移除</a></h3>
<ul>
<li>移除 PyO3 0.18 中弃用的所有功能，包括 <code>#[pymethods]</code> 的 <code>#[args]</code> 属性。<a href="https://github.com/PyO3/pyo3/pull/3232">#3232</a></li>
<li>移除 <code>IntoPyPointer</code> trait，改用 <code>into_ptr</code> 固有方法。<a href="https://github.com/PyO3/pyo3/pull/3385">#3385</a></li>
</ul>
<h3 id="修复-12"><a class="header" href="#修复-12">修复</a></h3>
<ul>
<li>正确处理 <code>PySet::discard</code> 中的异常。<a href="https://github.com/PyO3/pyo3/pull/3281">#3281</a></li>
<li><code>PyTuple::iter</code> 返回的 <code>PyTupleIterator</code> 类型现在是公开的，因此下游 crate 可以引用它。<a href="https://github.com/PyO3/pyo3/pull/3366">#3366</a></li>
<li>修复 PyPy 上 <code>PyOS_FSPath</code> 的链接问题。<a href="https://github.com/PyO3/pyo3/pull/3374">#3374</a></li>
<li>修复 <code>PyTypeBuilder::build</code> 中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/3401">#3401</a></li>
<li>在 Python 3.11 及以上版本中禁用已移除的 FFI 定义 <code>_Py_GetAllocatedBlocks</code>、<code>_PyObject_GC_Malloc</code> 和 <code>_PyObject_GC_Calloc</code>。<a href="https://github.com/PyO3/pyo3/pull/3403">#3403</a></li>
<li>修复在使用 CPython 的调试构建运行时与 GC 相关的 <code>ResourceWarning</code> 和崩溃问题。<a href="https://github.com/PyO3/pyo3/pull/3404">#3404</a></li>
<li><code>Option&lt;T&gt;</code> 默认参数的 <code>Some</code> 包装不会再重复包装 <code>Some(T)</code> 或求值为 <code>None</code> 的表达式。<a href="https://github.com/PyO3/pyo3/pull/3461">#3461</a></li>
<li>修复 <code>IterNextOutput::Return</code> 在 PyPy 上不返回值的问题。<a href="https://github.com/PyO3/pyo3/pull/3471">#3471</a></li>
<li>在 <code>#[pymethods]</code> 块内部发出编译错误而不是忽略宏调用。<a href="https://github.com/PyO3/pyo3/pull/3491">#3491</a></li>
<li>对 <code>#[new]</code>、<code>#[classmethod]</code>、<code>#[staticmethod]</code> 和 <code>#[classattr]</code> 的无效参数发出错误。<a href="https://github.com/PyO3/pyo3/pull/3484">#3484</a></li>
<li>在启用 <code>abi3</code> 特性时禁用 <code>PyMarshal_WriteObjectToString</code> 和 <code>PyMarshal_ReadObjectFromString</code> 的组合使用。<a href="https://github.com/PyO3/pyo3/pull/3490">#3490</a></li>
<li>修复 Python 3.11 及以上版本中 <code>_PyFrameEvalFunction</code> 的 FFI 定义（现在接收一个 <code>_PyInterpreterFrame</code> 不透明结构体）。<a href="https://github.com/PyO3/pyo3/pull/3500">#3500</a></li>
</ul>
<h2 id="0192---2023-08-01"><a class="header" href="#0192---2023-08-01">[0.19.2] - 2023-08-01</a></h2>
<h3 id="新增-16"><a class="header" href="#新增-16">新增</a></h3>
<ul>
<li>为 PyPy 3.9 及以上版本添加 FFI 定义 <code>PyState_AddModule</code>、<code>PyState_RemoveModule</code> 和 <code>PyState_FindModule</code>。<a href="https://github.com/PyO3/pyo3/pull/3295">#3295</a></li>
<li>添加 FFI 定义 <code>_PyObject_CallFunction_SizeT</code> 和 <code>_PyObject_CallMethod_SizeT</code>。<a href="https://github.com/PyO3/pyo3/pull/3297">#3297</a></li>
<li>在用户指南中添加“性能”部分，汇总与性能相关的技巧和问题。<a href="https://github.com/PyO3/pyo3/pull/3304">#3304</a></li>
<li>为所有 Python 版本添加 <code>PyErr::Display</code>，并为 Python 3.12 添加 FFI 符号 <code>PyErr_DisplayException</code>。<a href="https://github.com/PyO3/pyo3/pull/3334">#3334</a></li>
<li>为 Python 3.12 添加 FFI 定义 <code>PyType_GetDict()</code>。<a href="https://github.com/PyO3/pyo3/pull/3339">#3339</a></li>
<li>添加 <code>PyAny::downcast_exact</code>。<a href="https://github.com/PyO3/pyo3/pull/3346">#3346</a></li>
<li>添加 <code>PySlice::full()</code> 用于构造完整切片（<code>::</code>）。<a href="https://github.com/PyO3/pyo3/pull/3353">#3353</a></li>
</ul>
<h3 id="更改-10"><a class="header" href="#更改-10">更改</a></h3>
<ul>
<li>更新 <code>PyErr</code> 以适配 3.12 的 beta 版本，避免使用已弃用的 FFI 方法。<a href="https://github.com/PyO3/pyo3/pull/3306">#3306</a></li>
<li>更新 Python 3.12.0b4 的 <code>object.h</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/3335">#3335</a></li>
<li>更新 <code>pyo3::ffi</code> 结构体定义以兼容 3.12.0b4。<a href="https://github.com/PyO3/pyo3/pull/3342">#3342</a></li>
<li>优化在非 abi3 构建中 <code>float</code> 到 <code>f64</code>（以及 <code>PyFloat::value</code>）的转换性能。<a href="https://github.com/PyO3/pyo3/pull/3345">#3345</a></li>
</ul>
<h3 id="修复-13"><a class="header" href="#修复-13">修复</a></h3>
<ul>
<li>修复 FixedOffset 日期时间错误转换到和从 UTC 的时区转换 bug。<a href="https://github.com/PyO3/pyo3/pull/3269">#3269</a></li>
<li>修复在 PyPy 3.10 上调用 <code>PyUnicodeDecodeError_Create</code> 时引发的 <code>SystemError</code>。<a href="https://github.com/PyO3/pyo3/pull/3297">#3297</a></li>
<li>修正 FFI 定义 <code>Py_EnterRecursiveCall</code> 返回 <code>c_int</code>（之前错误地返回 <code>()</code>）。<a href="https://github.com/PyO3/pyo3/pull/3300">#3300</a></li>
<li>修复 <code>PyErr::matches</code> 和 <code>PyErr::is_instance</code> 在某些情况下返回与 <code>PyErr::get_type</code> 不一致结果的问题。<a href="https://github.com/PyO3/pyo3/pull/3313">#3313</a></li>
<li>修复在异常 “规范化” 后从 <code>PanicException</code> 解除栈时丢失 panic 消息的问题。<a href="https://github.com/PyO3/pyo3/pull/3326">#3326</a></li>
<li>修复 <code>PyErr::from_value</code> 和 <code>PyErr::into_value</code> 在转换时丢失 traceback 的问题。<a href="https://github.com/PyO3/pyo3/pull/3328">#3328</a></li>
<li>修复 Python 3.12.0b4 上对永生对象（immortal objects）的引用计数问题。<a href="https://github.com/PyO3/pyo3/pull/3335">#3335</a></li>
</ul>
<h2 id="0191---2023-07-03"><a class="header" href="#0191---2023-07-03">[0.19.1] - 2023-07-03</a></h2>
<h3 id="打包-13"><a class="header" href="#打包-13">打包</a></h3>
<ul>
<li>扩展可选依赖 <code>hashbrown</code> 支持的版本范围以包含 0.14 版本。<a href="https://github.com/PyO3/pyo3/pull/3258">#3258</a></li>
<li>扩展可选依赖 <code>indexmap</code> 支持的版本范围以包含 2.x 版本。<a href="https://github.com/PyO3/pyo3/pull/3277">#3277</a></li>
<li>支持 PyPy 3.10。<a href="https://github.com/PyO3/pyo3/pull/3289">#3289</a></li>
</ul>
<h3 id="新增-17"><a class="header" href="#新增-17">新增</a></h3>
<ul>
<li>添加 <code>pyo3::types::PyFrozenSetBuilder</code>，允许逐项构建 <code>PyFrozenSet</code>。<a href="https://github.com/PyO3/pyo3/pull/3156">#3156</a></li>
<li>添加对 Python 的 <code>ipaddress.IPv4Address</code>/<code>ipaddress.IPv6Address</code> 与 <code>std::net::IpAddr</code> 之间相互转换的支持。<a href="https://github.com/PyO3/pyo3/pull/3197">#3197</a></li>
<li>添加 <code>num-bigint</code> 功能与 <code>abi3</code> 结合使用时的支持。<a href="https://github.com/PyO3/pyo3/pull/3198">#3198</a></li>
<li>为 Python 3.12 及以后版本的 FFI 定义添加 <code>PyErr_GetRaisedException()</code> 和 <code>PyErr_SetRaisedException()</code>。<a href="https://github.com/PyO3/pyo3/pull/3248">#3248</a></li>
<li>添加 <code>Python::with_pool</code>，作为 <code>Python::new_pool</code> 更安全但功能更有限的替代方案。<a href="https://github.com/PyO3/pyo3/pull/3263">#3263</a></li>
<li>在 PyPy 上添加 <code>PyDict::get_item_with_error</code>。<a href="https://github.com/PyO3/pyo3/pull/3270">#3270</a>- 允许 <code>#[new]</code> 方法返回 <code>Py&lt;Self&gt;</code> 以返回现有实例。<a href="https://github.com/PyO3/pyo3/pull/3287">#3287</a></li>
</ul>
<h3 id="修复-14"><a class="header" href="#修复-14">修复</a></h3>
<ul>
<li>修复在使用 <code>abi3</code> 或 PyPy 时，实现 <code>__complex__</code> 的类转换为 <code>Complex</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/3185">#3185</a></li>
<li>停止在 <code>PyAny::hasattr</code> 中抑制无关异常。<a href="https://github.com/PyO3/pyo3/pull/3271">#3271</a></li>
<li>修复在创建 <code>PySet</code> 或 <code>PyFrozenSet</code>，或返回内部转换为这些类型的类型（如 <code>HashSet</code> 或 <code>BTreeSet</code>）时的内存泄漏问题。<a href="https://github.com/PyO3/pyo3/pull/3286">#3286</a></li>
</ul>
<h2 id="0190---2023-05-31"><a class="header" href="#0190---2023-05-31">[0.19.0] - 2023-05-31</a></h2>
<h3 id="打包-14"><a class="header" href="#打包-14">打包</a></h3>
<ul>
<li>将对 <code>syn</code> 的依赖版本由错误的 1.0.56 正确更新为 1.0.85。<a href="https://github.com/PyO3/pyo3/pull/3152">#3152</a></li>
</ul>
<h3 id="新增-18"><a class="header" href="#新增-18">新增</a></h3>
<ul>
<li>在 <code>#[pymethods]</code> 中为 <code>#[new]</code> 接受 <code>text_signature</code> 选项，并支持自动生成签名。<a href="https://github.com/PyO3/pyo3/pull/2980">#2980</a></li>
<li>添加对 Python 的 <code>decimal.Decimal</code> 与 <code>rust_decimal::Decimal</code> 相互转换的支持。<a href="https://github.com/PyO3/pyo3/pull/3016">#3016</a></li>
<li>在派生 <code>FromPyObject</code> 时添加 <code>#[pyo3(from_item_all)]</code>，用于指定所有字段使用 <code>get_item</code> 作为获取器。<a href="https://github.com/PyO3/pyo3/pull/3120">#3120</a></li>
<li>为 Python 3.11 添加 <code>pyo3::exceptions::PyBaseExceptionGroup</code>，以及对应的 FFI 定义 <code>PyExc_BaseExceptionGroup</code>。<a href="https://github.com/PyO3/pyo3/pull/3141">#3141</a></li>
<li>支持 <code>#[new]</code> 与 <code>#[classmethod]</code> 一起使用，以创建接收子类型类/<code>PyType</code> 作为第一个参数的构造函数。<a href="https://github.com/PyO3/pyo3/pull/3157">#3157</a></li>
<li>为带有 <code>#[pyclass(frozen)]</code> 的类添加 <code>PyClass::get</code> 和 <code>Py::get</code>，支持与 GIL 无关的访问。<a href="https://github.com/PyO3/pyo3/pull/3158">#3158</a></li>
<li>添加 <code>PyAny::is_exact_instance</code> 和 <code>PyAny::is_exact_instance_of</code>。<a href="https://github.com/PyO3/pyo3/pull/3161">#3161</a></li>
</ul>
<h3 id="变更-5"><a class="header" href="#变更-5">变更</a></h3>
<ul>
<li><code>PyAny::is_instance_of::&lt;T&gt;(obj)</code> 现在等同于 <code>T::is_type_of(obj)</code>，并改为返回 <code>bool</code> 而非 <code>PyResult&lt;bool&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/2881">#2881</a></li>
<li>弃用 <code>#[pyclass]</code> 结构体上的 <code>text_signature</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/2980">#2980</a></li>
<li>不再将仅包含基本 <code>PyErr</code> 而无链式错误的 <code>anyhow::Error</code>/<code>eyre::Report</code> 包装为 <code>PyRuntimeError</code>。<a href="https://github.com/PyO3/pyo3/pull/3004">#3004</a></li>
<li>将 <code>#[getter]</code> 和 <code>#[setter]</code> 更改为使用一个通用的调用“跳板”，以略微减少生成代码大小和编译时间。<a href="https://github.com/PyO3/pyo3/pull/3029">#3029</a></li>
<li>改进自动生成的 <code>text_signature</code> 中字符串、数字和布尔值的默认值显示。<a href="https://github.com/PyO3/pyo3/pull/3050">#3050</a></li>
<li>改进自动生成的 <code>text_signature</code> 中 <code>None</code> 的默认值显示。<a href="https://github.com/PyO3/pyo3/pull/3066">#3066</a></li>
<li>将 <code>PySequence::list</code> 和 <code>PySequence::tuple</code> 重命名为 <code>PySequence::to_list</code> 和 <code>PySequence::to_tuple</code>。（旧名称仍保留为弃用形式。）<a href="https://github.com/PyO3/pyo3/pull/3111">#3111</a></li>
<li>延长 <code>PyRef::py</code> 和 <code>PyRefMut::py</code> 返回的 GIL token 的生命周期，使其与底层借用匹配。<a href="https://github.com/PyO3/pyo3/pull/3131">#3131</a></li>
<li>现在在实现 <code>__traverse__</code> 槽位内部，对 GIL 的安全访问（例如通过 <code>Python::with_gil</code>）会被锁定。<a href="https://github.com/PyO3/pyo3/pull/3168">#3168</a></li>
</ul>
<h3 id="移除-4"><a class="header" href="#移除-4">移除</a></h3>
<ul>
<li>移除在 PyO3 0.17 中已弃用的所有功能，最显著的是 <code>Python::acquire_gil</code> 已由 <code>Python::with_gil</code> 取代。<a href="https://github.com/PyO3/pyo3/pull/2981">#2981</a></li>
</ul>
<h3 id="修复-15"><a class="header" href="#修复-15">修复</a></h3>
<ul>
<li>修正 FFI 定义 <code>PyGetSetDef</code>、<code>PyMemberDef</code>、<code>PyStructSequence_Field</code> 和 <code>PyStructSequence_Desc</code> 中 <code>name</code> 和 <code>doc</code> 成员的类型为 <code>*const c_char</code>（而非 <code>*mut c_char</code>）。<a href="https://github.com/PyO3/pyo3/pull/3036">#3036</a></li>
<li>修复 <code>fmt::Display</code> 中的 panic，改为返回字符串 <code>"&lt;unprintable object&gt;"</code> 并通过 <code>sys.unraisablehook()</code> 报告错误。<a href="https://github.com/PyO3/pyo3/pull/3062">#3062</a></li>
<li>修复当 <code>#[pyfunction]</code> 引用 <code>#[pyclass]</code> 中的引用时出现的“临时值在借用期间被丢弃”编译错误。<a href="https://github.com/PyO3/pyo3/pull/3142">#3142</a></li>
<li>修复因 PyO3 在进入 <code>__traverse__</code> 实现时应用延迟的引用计数更新而导致的崩溃。<a href="https://github.com/PyO3/pyo3/pull/3168">#3168</a></li>
<li>禁止在其他线程上运行无法发送（unsendable）类的 <code>Drop</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/3176">#3176</a></li>
<li>修复当 <code>#[pymethods]</code> 的项来自外部（例如作为宏参数）且使用了如 <code>Py&lt;Self&gt;</code> 这样的自定义接收器时的编译错误。<a href="https://github.com/PyO3/pyo3/pull/3178">#3178</a></li>
</ul>
<h2 id="0183---2023-04-13"><a class="header" href="#0183---2023-04-13">[0.18.3] - 2023-04-13</a></h2>
<h3 id="新增-19"><a class="header" href="#新增-19">新增</a></h3>
<ul>
<li>添加 <code>GILProtected&lt;T&gt;</code>，用于借助 Python 的全局解释器锁（GIL）协调对值的并发访问。<a href="https://github.com/PyO3/pyo3/pull/2975">#2975</a></li>
<li>支持在大端架构上使用 <code>PyASCIIObject</code> / <code>PyUnicode</code> 及相关方法。<a href="https://github.com/PyO3/pyo3/pull/3015">#3015</a></li>
<li>为 CPython 3.10 及以上版本添加 FFI 定义 <code>_PyDict_Contains_KnownHash()</code>。<a href="https://github.com/PyO3/pyo3/pull/3088">#3088</a></li>
</ul>
<h3 id="修复-16"><a class="header" href="#修复-16">修复</a></h3>
<ul>
<li>修复函数名为 “output” 的 <code>#[pymethods]</code> 和 <code>#[pyfunction]</code> 的编译错误。<a href="https://github.com/PyO3/pyo3/pull/3022">#3022</a></li>
<li>修复使用 <code>#[staticmethod]</code> 实现的魔法方法在生成代码中的编译错误。<a href="https://github.com/PyO3/pyo3/pull/3055">#3055</a></li>
<li>修复 <code>PyDateTime</code> 的 <code>is_instance</code> 问题（原会错误地检查 <code>PyDate</code>）。<a href="https://github.com/PyO3/pyo3/pull/3071">#3071</a></li>
<li>修复因 Python 3.10 起 <code>PyUnicode_InternImmortal</code> 被弃用导致的上游问题。<a href="https://github.com/PyO3/pyo3/pull/3087">#3087</a></li>
</ul>
<h2 id="0182---2023-03-24"><a class="header" href="#0182---2023-03-24">[0.18.2] - 2023-03-24</a></h2>
<h3 id="打包-15"><a class="header" href="#打包-15">打包</a></h3>
<ul>
<li>禁用 <code>chrono</code> 的默认功能，以避免依赖 <code>time</code> v0.1.x。<a href="https://github.com/PyO3/pyo3/pull/2939">#2939</a></li>
</ul>
<h3 id="新增-20"><a class="header" href="#新增-20">新增</a></h3>
<ul>
<li>为 <code>Cow&lt;[u8]&gt;</code> 实现 <code>IntoPy&lt;PyObject&gt;</code>、<code>ToPyObject</code> 和 <code>FromPyObject</code>，以便高效处理 <code>bytes</code> 和 <code>bytearray</code> 对象。<a href="https://github.com/PyO3/pyo3/pull/2899">#2899</a></li>
<li>为 <code>Cell&lt;T&gt;</code> 实现 <code>IntoPy&lt;PyObject&gt;</code>、<code>ToPyObject</code> 和 <code>FromPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/3014">#3014</a></li>
<li>添加 <code>PyList::to_tuple()</code>，提供一种便捷高效的列表到元组转换方式。<a href="https://github.com/PyO3/pyo3/pull/3042">#3042</a></li>
<li>添加 <code>PyTuple::to_list()</code>，提供一种便捷高效的元组到列表转换方式。<a href="https://github.com/PyO3/pyo3/pull/3044">#3044</a></li>
</ul>
<h3 id="变更-6"><a class="header" href="#变更-6">变更</a></h3>
<ul>
<li>优化针对 <code>list</code> 和 <code>tuple</code> 输入的 <code>PySequence</code> 转换。<a href="https://github.com/PyO3/pyo3/pull/2944">#2944</a></li>
<li>改进模块导入期间创建 <code>#[pyclass]</code> 类型对象失败时引发的异常信息。<a href="https://github.com/PyO3/pyo3/pull/2947">#2947</a></li>
<li>优化针对 <code>dict</code> 输入的 <code>PyMapping</code> 转换。<a href="https://github.com/PyO3/pyo3/pull/2954">#2954</a></li>
<li>允许 <code>create_exception!</code> 接收 <code>dotted.module</code> 形式的参数，将异常放入子模块中。<a href="https://github.com/PyO3/pyo3/pull/2979">#2979</a></li>
</ul>
<h3 id="修复-17"><a class="header" href="#修复-17">修复</a></h3>
<ul>
<li>修复在 <code>allow_threads</code> 块中克隆 <code>PyObject</code> 时存在的引用计数竞争条件。<a href="https://github.com/PyO3/pyo3/pull/2952">#2952</a></li>
<li>修复 <code>#[pyo3(signature = (...))]</code> 注解中默认参数触发 <code>clippy::redundant_closure</code> 检查的问题。<a href="https://github.com/PyO3/pyo3/pull/2990">#2990</a></li>
<li>修复 <code>#[pyfunction]</code> 宏生成代码中触发 <code>non_snake_case</code> 检查的问题。<a href="https://github.com/PyO3/pyo3/pull/2993">#2993</a></li>
<li>修复用于即将发布的 PyPy 3.10 版本的一些 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/3031">#3031</a></li>
</ul>
<h2 id="0181---2023-02-07"><a class="header" href="#0181---2023-02-07">[0.18.1] - 2023-02-07</a></h2>
<h3 id="新增-21"><a class="header" href="#新增-21">新增</a></h3>
<ul>
<li>添加 <code>PyErr::write_unraisable()</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/2889">#2889</a></li>
<li>添加 <code>Python::Ellipsis()</code> 和 <code>PyAny::is_ellipsis()</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/2911">#2911</a></li>
<li>添加 <code>PyDict::update()</code> 和 <code>PyDict::update_if_missing()</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/2912">#2912</a></li>
</ul>
<h3 id="变更-7"><a class="header" href="#变更-7">变更</a></h3>
<ul>
<li>CPython 3.7 上的 FFI 定义 <code>PyIter_Check</code> 现在实现为 <code>hasattr(type(obj), "__next__")</code>，可在所有平台正确运行并支持 <code>abi3</code>。<a href="https://github.com/PyO3/pyo3/pull/2914">#2914</a></li>
<li>将 <code>PYO3_CONFIG_FILE</code> 中未知配置键的处理由拒绝改为警告。<a href="https://github.com/PyO3/pyo3/pull/2926">#2926</a></li>
</ul>
<h3 id="修复-18"><a class="header" href="#修复-18">修复</a></h3>
<ul>
<li>将 <code>__releasebuffer__</code> 返回的错误发送至 <code>sys.unraisablehook</code>，而非引发 <code>SystemError</code>。<a href="https://github.com/PyO3/pyo3/pull/2886">#2886</a></li>
<li>修复对未实现 <code>__next__</code> 的 Python 类也能成功向下转换为 <code>PyIterator</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2914">#2914</a></li>
<li>修复在 <code>__traverse__</code> 中访问 <code>Option&lt;T: AsPyPointer&gt;</code> 的 <code>None</code> 字段时导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/2921">#2921</a></li>
<li>修复 <code>#[pymethods(crate = "...")]</code> 选项被忽略的问题。<a href="https://github.com/PyO3/pyo3/pull/2923">#2923</a></li>
<li>在 Windows 上为调试版本的 Python 构建时链接 <code>pythonXY_d.dll</code>。<a href="https://github.com/PyO3/pyo3/pull/2937">#2937</a></li>
</ul>
<h2 id="0180---2023-01-17"><a class="header" href="#0180---2023-01-17">[0.18.0] - 2023-01-17</a></h2>
<h3 id="打包-16"><a class="header" href="#打包-16">打包</a></h3>
<ul>
<li>放宽 <code>indexmap</code> 可选依赖的范围为 <code>&gt;= 1.6, &lt; 2</code>。<a href="https://github.com/PyO3/pyo3/pull/2849">#2849</a></li>
<li>放宽 <code>hashbrown</code> 可选依赖的范围为 <code>&gt;= 0.9, &lt; 0.14</code>。<a href="https://github.com/PyO3/pyo3/pull/2875">#2875</a></li>
<li>将 <code>memoffset</code> 依赖更新至 0.8 版本。<a href="https://github.com/PyO3/pyo3/pull/2875">#2875</a></li>
</ul>
<h3 id="新增-22"><a class="header" href="#新增-22">新增</a></h3>
<ul>
<li>为 <code>GILOnceCell</code> 添加 <code>get_or_try_init</code> 方法，支持可失败的初始化。<a href="https://github.com/PyO3/pyo3/pull/2398">#2398</a></li>
<li>添加实验性功能 <code>experimental-inspect</code>，包含 <code>type_input()</code> 和 <code>type_output()</code> 辅助函数，用于获取任意 Python 兼容对象的 Python 类型。<a href="https://github.com/PyO3/pyo3/pull/2490">#2490</a> <a href="https://github.com/PyO3/pyo3/pull/2882">#2882</a></li>
<li><code>#[pyclass]</code> 宏现在可接受 <code>get_all</code> 和 <code>set_all</code>，为每个字段自动生成 getter 和 setter。<a href="https://github.com/PyO3/pyo3/pull/2692">#2692</a></li>
<li>为 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 添加 <code>#[pyo3(signature = (...))]</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/2702">#2702</a></li>
<li><code>pyo3-build-config</code>：当环境变量 <code>PYO3_ENVIRONMENT_SIGNATURE</code> 值变化时重新构建。<a href="https://github.com/PyO3/pyo3/pull/2727">#2727</a>- 在 <code>std::num</code> 中的非零整型与 Python <code>int</code> 之间添加转换支持。<a href="https://github.com/PyO3/pyo3/pull/2730">#2730</a></li>
<li>为 <code>PyAny::downcast()</code> 添加配套的 <code>Py::downcast()</code>，并为两者添加 <code>downcast_unchecked()</code>。<a href="https://github.com/PyO3/pyo3/pull/2734">#2734</a></li>
<li>添加所有内置 <code>Warning</code> 类型的类型定义，以及 <code>PyErr::warn_explicit</code>。<a href="https://github.com/PyO3/pyo3/pull/2742">#2742</a></li>
<li>添加 <code>abi3-py311</code> 功能特性。<a href="https://github.com/PyO3/pyo3/pull/2776">#2776</a></li>
<li>为 CPython 添加 FFI 定义 <code>_PyErr_ChainExceptions()</code>。<a href="https://github.com/PyO3/pyo3/pull/2788">#2788</a></li>
<li>为 PyPy 3.8 及更高版本添加 FFI 定义 <code>PyVectorcall_NARGS</code> 和 <code>PY_VECTORCALL_ARGUMENTS_OFFSET</code>。<a href="https://github.com/PyO3/pyo3/pull/2811">#2811</a></li>
<li>为 PyPy 添加 <code>PyList::get_item_unchecked</code>。<a href="https://github.com/PyO3/pyo3/pull/2827">#2827</a></li>
</ul>
<h3 id="变更-8"><a class="header" href="#变更-8">变更</a></h3>
<ul>
<li>当函数返回值未实现所需 trait 时，PyO3 宏现在会输出更友好的错误信息。<a href="https://github.com/PyO3/pyo3/pull/2664">#2664</a></li>
<li>当拒绝将字符串视为 Vec 时，使用 TypeError 而不是 ValueError。<a href="https://github.com/PyO3/pyo3/pull/2685">#2685</a></li>
<li>修改 <code>PyCFunction::new_closure</code> 以接受 <code>name</code> 和 <code>doc</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/2686">#2686</a></li>
<li><code>PyType::is_subclass</code>、<code>PyErr::is_instance</code> 和 <code>PyAny::is_instance</code> 现在接受 <code>&amp;PyAny</code> 而不是 <code>&amp;PyType</code> 参数，以便与通过 <code>__subclasscheck__</code> 和 <code>__instancecheck__</code> 伪装为类型的对象兼容。<a href="https://github.com/PyO3/pyo3/pull/2695">#2695</a></li>
<li>弃用 <code>#[args]</code> 属性以及直接将 “args” 说明传递给 <code>#[pyfunction]</code> 的方式，推荐使用新的 <code>#[pyo3(signature = (...))]</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/2702">#2702</a></li>
<li>弃用在 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 中，在 <code>Option&lt;T&gt;</code> 参数之后使用必需参数，而未同时使用 <code>#[pyo3(signature)]</code> 指定参数是否必需或具有默认值的做法。<a href="https://github.com/PyO3/pyo3/pull/2703">#2703</a></li>
<li>修改 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 以使用通用的调用“跳板”，略微减少生成代码大小和编译时间。<a href="https://github.com/PyO3/pyo3/pull/2705">#2705</a></li>
<li><code>PyAny::cast_as()</code> 和 <code>Py::cast_as()</code> 现已被弃用，推荐使用 <code>PyAny::downcast()</code> 和新的 <code>Py::downcast()</code>。<a href="https://github.com/PyO3/pyo3/pull/2734">#2734</a></li>
<li>放宽 <code>PyAny::downcast()</code> 的生命周期限制。<a href="https://github.com/PyO3/pyo3/pull/2734">#2734</a></li>
<li>为所有使用 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 创建的 Python 函数自动生成 <code>__text_signature__</code>。<a href="https://github.com/PyO3/pyo3/pull/2784">#2784</a></li>
<li>在 <code>PySet::new</code> 和 <code>PyFrozenSet::new</code> 中接受任意迭代器。<a href="https://github.com/PyO3/pyo3/pull/2795">#2795</a></li>
<li><code>#[pyclass]</code> 结构体字段上的 <code>#[cfg(...)]</code> 和 <code>#[pyo3(...)]</code> 属性混合使用现在可以正常工作。<a href="https://github.com/PyO3/pyo3/pull/2796">#2796</a></li>
<li>重新启用在构建 abi3 或 PyPy 时的 <code>PyFunction</code>。<a href="https://github.com/PyO3/pyo3/pull/2838">#2838</a></li>
<li>改进 <code>derive(FromPyObject)</code>，在适用时对 <code>#[pyo3(item)]</code> 使用 <code>intern!</code>。<a href="https://github.com/PyO3/pyo3/pull/2879">#2879</a></li>
</ul>
<h3 id="移除-5"><a class="header" href="#移除-5">移除</a></h3>
<ul>
<li>移除已弃用的 <code>pyproto</code> 功能、<code>#[pyproto]</code> 宏及相关 API。<a href="https://github.com/PyO3/pyo3/pull/2587">#2587</a></li>
<li>移除 PyO3 0.16 中弃用的所有功能。<a href="https://github.com/PyO3/pyo3/pull/2843">#2843</a></li>
</ul>
<h3 id="修复-19"><a class="header" href="#修复-19">修复</a></h3>
<ul>
<li>在 PyPy 上禁用 <code>PyModule::filename</code>。<a href="https://github.com/PyO3/pyo3/pull/2715">#2715</a></li>
<li><code>PyCodeObject</code> 在 Python 3.7 上再次定义为包含字段。<a href="https://github.com/PyO3/pyo3/pull/2726">#2726</a></li>
<li>若带有 <code>#[new]</code> 的 pymethod 接收无参数但在调用时传入了参数，抛出 <code>TypeError</code>。<a href="https://github.com/PyO3/pyo3/pull/2749">#2749</a></li>
<li>对仅接受单个 <code>py: Python</code> 参数的方法使用 <code>NOARGS</code> 调用约定（作为性能优化）。<a href="https://github.com/PyO3/pyo3/pull/2760">#2760</a></li>
<li>修复 <code>PySlice::new</code> 中 <code>isize</code> 值被截断为 <code>c_long</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2769">#2769</a></li>
<li>修复 PyPy 上 FFI 定义 <code>PyUnicodeDecodeError_Create</code> 导致的内存安全问题，该问题会引起不确定行为（通常是 <code>TypeError</code>）。<a href="https://github.com/PyO3/pyo3/pull/2772">#2772</a></li>
<li>允许接受 <code>**kwargs</code> 的函数接收与仅位置参数同名的关键字参数（符合 PEP 570 的规定）。<a href="https://github.com/PyO3/pyo3/pull/2800">#2800</a></li>
<li>修复 PyPy 3.9 及更高版本中 <code>PyObject_Vectorcall</code> 符号未解析的问题。<a href="https://github.com/PyO3/pyo3/pull/2811">#2811</a></li>
<li>修复 <code>PyCFunction::new_closure</code> 中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/2842">#2842</a></li>
</ul>
<h2 id="0173---2022-11-01"><a class="header" href="#0173---2022-11-01">[0.17.3] - 2022-11-01</a></h2>
<h3 id="打包-17"><a class="header" href="#打包-17">打包</a></h3>
<ul>
<li>支持 Python 3.11。（之前的 PyO3 0.17 版本已测试过 Python 3.11 的发布候选版并预期兼容，这是首个正式测试 Python 3.11.0 的版本。）<a href="https://github.com/PyO3/pyo3/pull/2708">#2708</a></li>
</ul>
<h3 id="新增-23"><a class="header" href="#新增-23">新增</a></h3>
<ul>
<li>为 <code>PyListIterator</code>、<code>PyDictIterator</code>、<code>PySetIterator</code> 和 <code>PyFrozenSetIterator</code> 实现 <code>ExactSizeIterator</code>。<a href="https://github.com/PyO3/pyo3/pull/2676">#2676</a></li>
</ul>
<h3 id="修复-20"><a class="header" href="#修复-20">修复</a></h3>
<ul>
<li>修复 <code>impl FromPyObject for [T; N]</code> 无法接受通过 <code>PySequence_Check</code> 的类型（如 NumPy 数组）的回归问题，该问题自 0.17.0 版本出现，此次是将 0.17.1 对 <code>Vec&lt;T&gt;</code> 的修复扩展至定长数组。<a href="https://github.com/PyO3/pyo3/pull/2675">#2675</a></li>
<li>修复因从空指针创建切片导致的 <code>FunctionDescription::extract_arguments_fastcall</code> 中的未定义行为（UB）。<a href="https://github.com/PyO3/pyo3/pull/2687">#2687</a></li>
</ul>
<h2 id="0172---2022-10-04"><a class="header" href="#0172---2022-10-04">[0.17.2] - 2022-10-04</a></h2>
<h3 id="打包-18"><a class="header" href="#打包-18">打包</a></h3>
<ul>
<li>添加可选的 <code>chrono</code> 功能以将 <code>chrono</code> 类型转换为 <code>datetime</code> 模块中的类型。<a href="https://github.com/PyO3/pyo3/pull/2612">#2612</a></li>
</ul>
<h3 id="新增-24"><a class="header" href="#新增-24">新增</a></h3>
<ul>
<li>添加对 PyPy 上 <code>num-bigint</code> 功能的支持。<a href="https://github.com/PyO3/pyo3/pull/2626">#2626</a></li>
</ul>
<h3 id="修复-21"><a class="header" href="#修复-21">修复</a></h3>
<ul>
<li>正确实现枚举的 <code>__richcmp__</code>，修复 <code>__ne__</code> 始终返回 <code>True</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2622">#2622</a></li>
<li>修复自 0.17.0 以来使用带有默认值的 <code>Option&lt;&amp;SomePyClass&gt;</code> 参数导致的编译错误。<a href="https://github.com/PyO3/pyo3/pull/2630">#2630</a></li>
<li>修复 <code>impl FromPyObject for Vec&lt;T&gt;</code> 无法接受通过 <code>PySequence_Check</code> 的类型（如 NumPy 数组）的回归问题，该问题自 0.17.0 版本起存在。<a href="https://github.com/PyO3/pyo3/pull/2631">#2631</a></li>
</ul>
<h2 id="0171---2022-08-28"><a class="header" href="#0171---2022-08-28">[0.17.1] - 2022-08-28</a></h2>
<h3 id="修复-22"><a class="header" href="#修复-22">修复</a></h3>
<ul>
<li>修复 PyO3 0.17.0 中新增的 <code>PyDictItems</code>、<code>PyDictKeys</code> 和 <code>PyDictValues</code> 类型的可见性问题。</li>
<li>修复在 <code>Option&lt;T&gt;</code> 类型参数上使用 <code>#[pyo3(from_py_with = "...")]</code> 属性时导致的编译失败。<a href="https://github.com/PyO3/pyo3/pull/2592">#2592</a></li>
<li>修复 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 对 <code>**kwargs</code> 参数触发 clippy <code>redundant-closure</code> 警告的问题。<a href="https://github.com/PyO3/pyo3/pull/2595">#2595</a></li>
</ul>
<h2 id="0170---2022-08-23"><a class="header" href="#0170---2022-08-23">[0.17.0] - 2022-08-23</a></h2>
<h3 id="打包-19"><a class="header" href="#打包-19">打包</a></h3>
<ul>
<li>将 inventory 依赖更新至 <code>0.3</code>（<code>multiple-pymethods</code> 功能现需 Rust 1.62 以保证正确性）。<a href="https://github.com/PyO3/pyo3/pull/2492">#2492</a></li>
</ul>
<h3 id="新增-25"><a class="header" href="#新增-25">新增</a></h3>
<ul>
<li>添加 <code>timezone_utc</code>。<a href="https://github.com/PyO3/pyo3/pull/1588">#1588</a></li>
<li>为 <code>[T; N]</code> 实现 <code>ToPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/2313">#2313</a></li>
<li>添加 <code>PyDictKeys</code>、<code>PyDictValues</code> 和 <code>PyDictItems</code> Rust 类型。<a href="https://github.com/PyO3/pyo3/pull/2358">#2358</a></li>
<li>添加 <code>append_to_inittab</code>。<a href="https://github.com/PyO3/pyo3/pull/2377">#2377</a></li>
<li>添加 FFI 定义 <code>PyFrame_GetCode</code>。<a href="https://github.com/PyO3/pyo3/pull/2406">#2406</a></li>
<li>添加高层对象 <code>PyCode</code> 和 <code>PyFrame</code>。<a href="https://github.com/PyO3/pyo3/pull/2408">#2408</a></li>
<li>添加 FFI 定义 <code>Py_fstring_input</code>、<code>sendfunc</code> 和 <code>_PyErr_StackItem</code>。<a href="https://github.com/PyO3/pyo3/pull/2423">#2423</a></li>
<li>为 PyPy 添加 <code>PyDateTime::new_with_fold</code>、<code>PyTime::new_with_fold</code>、<code>PyTime::get_fold</code> 和 <code>PyDateTime::get_fold</code>。<a href="https://github.com/PyO3/pyo3/pull/2428">#2428</a></li>
<li>添加 <code>#[pyclass(frozen)]</code>。<a href="https://github.com/PyO3/pyo3/pull/2448">#2448</a></li>
<li>允许 <code>#[pyo3(name)]</code> 用于枚举变体。<a href="https://github.com/PyO3/pyo3/pull/2457">#2457</a></li>
<li>添加 <code>CompareOp::matches</code>，通过 <code>std::cmp::Ordering</code> 比较结果来实现 <code>__richcmp__</code>。<a href="https://github.com/PyO3/pyo3/pull/2460">#2460</a></li>
<li>添加 <code>PySuper</code> 类型。<a href="https://github.com/PyO3/pyo3/pull/2486">#2486</a></li>
<li>通过 <code>generate-import-lib</code> 功能支持 Windows 上的 PyPy。<a href="https://github.com/PyO3/pyo3/pull/2506">#2506</a></li>
<li>添加 FFI 定义 <code>Py_EnterRecursiveCall</code> 和 <code>Py_LeaveRecursiveCall</code>。<a href="https://github.com/PyO3/pyo3/pull/2511">#2511</a></li>
<li>添加 <code>PyDict::get_item_with_error</code>。<a href="https://github.com/PyO3/pyo3/pull/2536">#2536</a></li>
<li>添加 <code>#[pyclass(sequence)]</code> 选项。<a href="https://github.com/PyO3/pyo3/pull/2567">#2567</a></li>
</ul>
<h3 id="变更-9"><a class="header" href="#变更-9">变更</a></h3>
<ul>
<li>将接收 <code>tzinfo</code> 的 datetime 构造函数改为接收 <code>Option&lt;&amp;PyTzInfo&gt;</code> 而非 <code>Option&lt;&amp;PyObject&gt;</code>：<code>PyDateTime::new</code>、<code>PyDateTime::new_with_fold</code>、<code>PyTime::new</code> 和 <code>PyTime::new_with_fold</code>。<a href="https://github.com/PyO3/pyo3/pull/1588">#1588</a></li>
<li>将 <code>PyTypeObject::type_object</code> 方法移至 <code>PyTypeInfo</code> trait，并弃用 <code>PyTypeObject</code> trait。<a href="https://github.com/PyO3/pyo3/pull/2287">#2287</a></li>
<li><code>Py</code> 和 <code>PyAny</code> 的方法现在接受 <code>impl IntoPy&lt;Py&lt;PyString&gt;&gt;</code> 而不仅是 <code>&amp;str</code>，以支持 <code>intern!</code> 宏。<a href="https://github.com/PyO3/pyo3/pull/2312">#2312</a></li>
<li>将已弃用的 <code>pyproto</code> 功能改为默认不启用（opt-in）而非默认启用（opt-out）。<a href="https://github.com/PyO3/pyo3/pull/2322">#2322</a></li>
<li>在 <code>#[pyfunction]</code> 返回类型未实现 <code>IntoPy</code> 时输出更清晰的错误信息。<a href="https://github.com/PyO3/pyo3/pull/2326">#2326</a></li>
<li>对 <code>impl&lt;T, const N: usize&gt; IntoPy&lt;PyObject&gt; for [T; N]</code> 要求 <code>T: IntoPy</code> 而不是 <code>T: ToPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/2326">#2326</a></li>
<li>弃用 <code>ToBorrowedObject</code> trait。<a href="https://github.com/PyO3/pyo3/pull/2333">#2333</a></li>
<li>若迭代过程中底层集合被修改，<code>PySet</code> 和 <code>PyDict</code> 的迭代器现在会 panic。<a href="https://github.com/PyO3/pyo3/pull/2380">#2380</a>- 当迭代期间底层集合被修改时，<code>PySet</code> 和 <code>PyDict</code> 的迭代器现在会 panic。<a href="https://github.com/PyO3/pyo3/pull/2380">#2380</a></li>
<li>允许 <code>#[classattr]</code> 方法返回错误。<a href="https://github.com/PyO3/pyo3/pull/2385">#2385</a></li>
<li>防止单个 <code>#[pyclass]</code> 中出现多个同名 <code>#[pymethods]</code>。<a href="https://github.com/PyO3/pyo3/pull/2399">#2399</a></li>
<li>使用 <code>PYO3_CONFIG_FILE</code> 时修复 <code>lib_name</code> 的配置问题。<a href="https://github.com/PyO3/pyo3/pull/2404">#2404</a></li>
<li>为元组结构体 <code>#[derive(FromPyObject)]</code> 实现抛出的 <code>ValueError</code> 添加错误消息。<a href="https://github.com/PyO3/pyo3/pull/2414">#2414</a></li>
<li>允许 <code>#[classattr]</code> 方法接受 <code>Python</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/2456">#2456</a></li>
<li>重构 <code>PyCapsule</code> 类型以解决安全性问题：<a href="https://github.com/PyO3/pyo3/pull/2485">#2485</a>
<ul>
<li><code>PyCapsule::new</code> 和 <code>PyCapsule::new_with_destructor</code> 现在接受 <code>name: Option&lt;CString&gt;</code> 而不是 <code>&amp;CStr</code>。</li>
<li><code>PyCapsule::new_with_destructor</code> 中的析构函数 <code>F</code> 现在必须是 <code>Send</code>。</li>
<li>不再推荐使用 <code>PyCapsule::get_context</code>，推荐使用不接受 <code>py: Python&lt;'_&gt;</code> 参数的 <code>PyCapsule::context</code>。</li>
<li><code>PyCapsule::set_context</code> 不再接受 <code>py: Python&lt;'_&gt;</code> 参数。</li>
<li><code>PyCapsule::name</code> 现在返回 <code>PyResult&lt;Option&lt;&amp;CStr&gt;&gt;</code> 而不是 <code>&amp;CStr</code>。</li>
</ul>
</li>
<li><code>Vec&lt;T&gt;</code> 的 <code>FromPyObject::extract</code> 不再接受 Python <code>str</code> 输入。<a href="https://github.com/PyO3/pyo3/pull/2500">#2500</a></li>
<li>确保每个 <code>#[pymodule]</code> 仅初始化一次。<a href="https://github.com/PyO3/pyo3/pull/2523">#2523</a></li>
<li><code>pyo3_build_config::add_extension_module_link_args</code> 现在也会为 <code>wasm32-unknown-emscripten</code> 发出链接器参数。<a href="https://github.com/PyO3/pyo3/pull/2538">#2538</a></li>
<li><code>PySequence</code> 和 <code>PyMapping</code> 的类型检查现在要求输入分别继承自（或注册到）<code>collections.abc.Sequence</code> 和 <code>collections.abc.Mapping</code>。<a href="https://github.com/PyO3/pyo3/pull/2477">#2477</a></li>
<li>在构建 abi3 或 PyPy 目标时禁用 <code>PyFunction</code>。<a href="https://github.com/PyO3/pyo3/pull/2542">#2542</a></li>
<li>标记 <code>Python::acquire_gil</code> 为已弃用。<a href="https://github.com/PyO3/pyo3/pull/2549">#2549</a></li>
</ul>
<h3 id="已移除-4"><a class="header" href="#已移除-4">已移除</a></h3>
<ul>
<li>移除 PyO3 0.15 中已弃用的所有功能。<a href="https://github.com/PyO3/pyo3/pull/2283">#2283</a></li>
<li>将 <code>Dict</code>、<code>WeakRef</code> 和 <code>BaseNativeType</code> 成员设为 <code>PyClass</code> 的私有实现细节。<a href="https://github.com/PyO3/pyo3/pull/2572">#2572</a></li>
</ul>
<h3 id="已修复-14"><a class="header" href="#已修复-14">已修复</a></h3>
<ul>
<li>启用错误禁用的 FFI 定义 <code>PyThreadState_DeleteCurrent</code>。<a href="https://github.com/PyO3/pyo3/pull/2357">#2357</a></li>
<li>修复 <code>wrap_pymodule</code> 与命名解析规则的交互：当 <code>submodule::submodule</code> 是 <code>#[pymodule]</code> 时，不再“穿透” <code>use submodule::*</code> 的通配符导入。<a href="https://github.com/PyO3/pyo3/pull/2363">#2363</a></li>
<li>修正 FFI 定义 <code>PyEval_EvalCodeEx</code> 以接受 <code>*const *mut PyObject</code> 数组参数，而非 <code>*mut *mut PyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/2368">#2368</a></li>
<li>修复“原始标识符”结构体（如 <code>#[pyclass] struct r#RawName</code>）在 Python 中创建的类名错误地包含前导 <code>r#</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2395">#2395</a></li>
<li>修正 FFI 定义 <code>Py_tracefunc</code> 为 <code>unsafe extern "C" fn</code>（之前是安全的）。<a href="https://github.com/PyO3/pyo3/pull/2407">#2407</a></li>
<li>修复在 <code>#[derive(FromPyObject)]</code> 结构体字段上使用 <code>#[pyo3(from_py_with = "...")]</code> 注解时的编译失败问题。<a href="https://github.com/PyO3/pyo3/pull/2414">#2414</a></li>
<li>修复 FFI 定义 <code>_PyDateTime_BaseTime</code> 和 <code>_PyDateTime_BaseDateTime</code> 名称缺少前导下划线的问题。<a href="https://github.com/PyO3/pyo3/pull/2421">#2421</a></li>
<li>在 Python 3.10 及以上版本中移除 FFI 定义 <code>PyArena</code>。<a href="https://github.com/PyO3/pyo3/pull/2421">#2421</a></li>
<li>修复 FFI 定义 <code>PyCompilerFlags</code> 在 Python 3.8 及以上版本中缺少成员 <code>cf_feature_version</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2423">#2423</a></li>
<li>修复 FFI 定义 <code>PyAsyncMethods</code> 在 Python 3.10 及以上版本中缺少成员 <code>am_send</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2423">#2423</a></li>
<li>修复 FFI 定义 <code>PyGenObject</code> 在不同 Python 版本中多个成员不正确的问题。<a href="https://github.com/PyO3/pyo3/pull/2423">#2423</a></li>
<li>修复 FFI 定义 <code>PySyntaxErrorObject</code> 在 Python 3.10 及以上版本中缺少成员 <code>end_lineno</code> 和 <code>end_offset</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2423">#2423</a></li>
<li>修复 FFI 定义 <code>PyHeapTypeObject</code> 在 Python 3.9 及以上版本中缺少成员 <code>ht_module</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2423">#2423</a></li>
<li>修复 FFI 定义 <code>PyFrameObject</code> 在不同 Python 版本中多个成员不正确的问题。<a href="https://github.com/PyO3/pyo3/pull/2424">#2424</a> <a href="https://github.com/PyO3/pyo3/pull/2434">#2434</a></li>
<li>修复 FFI 定义 <code>PyTypeObject</code> 在 Python 3.8 中缺少已弃用字段 <code>tp_print</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2428">#2428</a></li>
<li>修复 PyPy 上的 FFI 定义 <code>PyDateTime_CAPI</code>、<code>PyDateTime_Date</code>、<code>PyASCIIObject</code>、<code>PyBaseExceptionObject</code>、<code>PyListObject</code> 和 <code>PyTypeObject</code>。<a href="https://github.com/PyO3/pyo3/pull/2428">#2428</a></li>
<li>修复 FFI 定义 <code>_inittab</code> 的字段 <code>initfun</code> 的拼写错误（应为 <code>initfunc</code>）。<a href="https://github.com/PyO3/pyo3/pull/2431">#2431</a></li>
<li>修复 FFI 定义 <code>_PyDateTime_BaseTime</code> 和 <code>_PyDateTime_BaseDateTime</code> 错误包含 <code>fold</code> 成员的问题。<a href="https://github.com/PyO3/pyo3/pull/2432">#2432</a></li>
<li>修复 PyPy 3.9 上的 FFI 定义 <code>PyTypeObject</code>、<code>PyHeapTypeObject</code> 和 <code>PyCFunctionObject</code> 中成员不正确的问题。<a href="https://github.com/PyO3/pyo3/pull/2433">#2433</a></li>
<li>修正 FFI 定义 <code>PyGetSetDef</code> 的 <code>doc</code> 成员为 <code>*const c_char</code>（而非 <code>*mut c_char</code>）。<a href="https://github.com/PyO3/pyo3/pull/2439">#2439</a></li>
<li>修复对单元素元组结构体和透明结构体忽略 <code>#[pyo3(from_py_with = "...")]</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2440">#2440</a></li>
<li>使用 <code>memoffset</code> 计算 <code>PyCell</code> 布局以避免未定义行为（UB）。<a href="https://github.com/PyO3/pyo3/pull/2450">#2450</a></li>
<li>修复 <code>#[pyclass(name = "...")]</code> 重命名的枚举生成的 <code>repr</code> 返回错误的枚举名称的问题。<a href="https://github.com/PyO3/pyo3/pull/2457">#2457</a></li>
<li>修复在 Python 3.9 上构建 abi3 时错误地可用 <code>PyObject_CallNoArgs</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2476">#2476</a></li>
<li>修复 <code>#[pyfunction]</code> 参数生成的多个 clippy 警告。<a href="https://github.com/PyO3/pyo3/pull/2503">#2503</a></li>
</ul>
<h2 id="0166---2022-08-23"><a class="header" href="#0166---2022-08-23">[0.16.6] - 2022-08-23</a></h2>
<h3 id="更改-11"><a class="header" href="#更改-11">更改</a></h3>
<ul>
<li>使用部分变通方法修复 <code>PyCapsule</code> 类型的安全性问题。建议用户尽快升级到 PyO3 0.17，该版本通过破坏性变更提供了长期解决方案。<a href="https://github.com/PyO3/pyo3/pull/2522">#2522</a>
<ul>
<li><code>PyCapsule::new</code> 和 <code>PyCapsule::new_with_destructor</code> 现在会复制并拥有 <code>name</code> 的所有权，以解决可能的悬垂指针问题。</li>
<li>若胶囊无名称，<code>PyCapsule::name</code> 现在返回空 <code>CStr</code>，而不再解引用空指针。</li>
<li>若胶囊在其创建线程以外的其他线程中被删除，则 <code>PyCapsule::new_with_destructor</code> 中的析构函数 <code>F</code> 永远不会被调用（将发出警告）。</li>
</ul>
</li>
<li>当 PyO3 捕获的 panic payload 在 drop 期间发生 panic 时，现在将中止程序。<a href="https://github.com/PyO3/pyo3/pull/2544">#2544</a></li>
</ul>
<h2 id="0165---2022-05-15"><a class="header" href="#0165---2022-05-15">[0.16.5] - 2022-05-15</a></h2>
<h3 id="新增-26"><a class="header" href="#新增-26">新增</a></h3>
<ul>
<li>添加实验性 <code>generate-import-lib</code> 功能，支持为 Windows 目标自动生​​成非 abi3 的 Python 导入库。<a href="https://github.com/PyO3/pyo3/pull/2364">#2364</a></li>
<li>添加 FFI 定义 <code>Py_ExitStatusException</code>。<a href="https://github.com/PyO3/pyo3/pull/2374">#2374</a></li>
</ul>
<h3 id="更改-12"><a class="header" href="#更改-12">更改</a></h3>
<ul>
<li>将实验性 <code>generate-abi3-import-lib</code> 功能标记为弃用，推荐使用新的 <code>generate-import-lib</code> 功能。<a href="https://github.com/PyO3/pyo3/pull/2364">#2364</a></li>
</ul>
<h3 id="已修复-15"><a class="header" href="#已修复-15">已修复</a></h3>
<ul>
<li>为 3.10+ 版本的 <code>PyConfig</code> 添加缺失的 <code>warn_default_encoding</code> 字段。此前缺失该字段可能导致不正确的行为或崩溃。<a href="https://github.com/PyO3/pyo3/pull/2370">#2370</a></li>
<li>修复 3.10+ 版本中 <code>PyConfig</code> 的 <code>pathconfig_warnings</code> 和 <code>program_name</code> 字段顺序错误的问题。此前字段顺序颠倒，可能引发不正确的行为或崩溃。<a href="https://github.com/PyO3/pyo3/pull/2370">#2370</a></li>
</ul>
<h2 id="0164---2022-04-14"><a class="header" href="#0164---2022-04-14">[0.16.4] - 2022-04-14</a></h2>
<h3 id="新增-27"><a class="header" href="#新增-27">新增</a></h3>
<ul>
<li>添加 <code>PyTzInfoAccess</code> trait，用于安全访问时区信息。<a href="https://github.com/PyO3/pyo3/pull/2263">#2263</a></li>
<li>添加实验性 <code>generate-abi3-import-lib</code> 功能，用于为 Windows 自动生​​成 <code>python3.dll</code> 导入库。<a href="https://github.com/PyO3/pyo3/pull/2282">#2282</a></li>
<li>添加 <code>PyDateTime_BaseTime</code> 和 <code>PyDateTime_BaseDateTime</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/2294">#2294</a></li>
</ul>
<h3 id="更改-13"><a class="header" href="#更改-13">更改</a></h3>
<ul>
<li>提升调用 <code>FromPyObject::extract</code> 失败时的性能，此类情况在函数接受多种不同类型时很常见。<a href="https://github.com/PyO3/pyo3/pull/2279">#2279</a></li>
<li>在 Unix 上为 CPython 3.7 选择 <code>libpython</code> 链接名时默认使用 “m” ABI 标签。<a href="https://github.com/PyO3/pyo3/pull/2288">#2288</a></li>
<li>允许在没有可用构建主机 Python 解释器的情况下编译 “abi3” 扩展。<a href="https://github.com/PyO3/pyo3/pull/2293">#2293</a></li>
</ul>
<h3 id="已修复-16"><a class="header" href="#已修复-16">已修复</a></h3>
<ul>
<li>依赖 PyO3 的 crate 现可在稳定版 Rust 下通过 LLVM 插桩收集代码覆盖率。<a href="https://github.com/PyO3/pyo3/pull/2286">#2286</a></li>
<li>修复在没有 <code>tzinfo</code> 的 <code>datetime</code> 或 <code>time</code> 上调用 FFI 方法 <code>PyDateTime_DATE_GET_TZINFO</code> 或 <code>PyDateTime_TIME_GET_TZINFO</code> 时的段错误。<a href="https://github.com/PyO3/pyo3/pull/2289">#2289</a></li>
<li>修复因目录名以字母 <code>n</code> 开头导致从 PyO3 0.16.3 开始在 Windows 上序列化解析器配置失败的问题。<a href="https://github.com/PyO3/pyo3/pull/2299">#2299</a></li>
</ul>
<h2 id="0163---2022-04-05"><a class="header" href="#0163---2022-04-05">[0.16.3] - 2022-04-05</a></h2>
<h3 id="打包-20"><a class="header" href="#打包-20">打包</a></h3>
<ul>
<li>扩展 <code>parking_lot</code> 依赖的版本支持，包括 0.12 版本。<a href="https://github.com/PyO3/pyo3/pull/2239">#2239</a></li>
</ul>
<h3 id="新增-28"><a class="header" href="#新增-28">新增</a></h3>
<ul>
<li>为 <code>pyo3_build_config::InterpreterConfig</code> 添加方法，以使用配置的可执行文件运行 Python 脚本。<a href="https://github.com/PyO3/pyo3/pull/2092">#2092</a></li>
<li>为 <code>Py&lt;PyBytes&gt;</code> 添加 <code>as_bytes</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/2235">#2235</a>- 为 <code>PyType_FromModuleAndSpec</code>、<code>PyType_GetModule</code>、<code>PyType_GetModuleState</code> 和 <code>PyModule_AddType</code> 添加 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/2250">#2250</a></li>
<li>添加 <code>pyo3_build_config::cross_compiling_from_to</code>，作为检测 PyO3 是否处于交叉编译状态的辅助工具。<a href="https://github.com/PyO3/pyo3/pull/2253">#2253</a></li>
<li>添加 <code>#[pyclass(mapping)]</code> 选项，以在容器实现中留空序列槽位。<a href="https://github.com/PyO3/pyo3/pull/2265">#2265</a></li>
<li>添加 <code>PyString::intern</code>，用于启用 Python 内建的字符串驻留机制。<a href="https://github.com/PyO3/pyo3/pull/2268">#2268</a></li>
<li>加入 <code>intern!</code> 宏，可通过将字符串存储在 <code>GILOnceCell</code> 中来分摊创建 Python 字符串的开销。<a href="https://github.com/PyO3/pyo3/pull/2269">#2269</a></li>
<li>添加 <code>PYO3_CROSS_PYTHON_IMPLEMENTATION</code> 环境变量，用于选择默认的交叉编译 Python 实现。<a href="https://github.com/PyO3/pyo3/pull/2272">#2272</a></li>
</ul>
<h3 id="更改-14"><a class="header" href="#更改-14">更改</a></h3>
<ul>
<li>允许 <code>#[pyo3(crate = "...", text_signature = "...")]</code> 选项直接用于 <code>#[pyclass(crate = "...", text_signature = "...")]</code> 中。<a href="https://github.com/PyO3/pyo3/pull/2234">#2234</a></li>
<li>在交叉编译时使 <code>PYO3_CROSS_LIB_DIR</code> 环境变量变为可选。<a href="https://github.com/PyO3/pyo3/pull/2241">#2241</a></li>
<li>将 <code>METH_FASTCALL</code> 调用约定在 Python 3.10 中标记为受限 API。<a href="https://github.com/PyO3/pyo3/pull/2250">#2250</a></li>
<li>将 <code>pyo3_build_config::cross_compiling</code> 标记为废弃，推荐使用 <code>pyo3_build_config::cross_compiling_from_to</code>。<a href="https://github.com/PyO3/pyo3/pull/2253">#2253</a></li>
</ul>
<h3 id="修复-23"><a class="header" href="#修复-23">修复</a></h3>
<ul>
<li>修复 <code>abi3-py310</code> 功能：当可用时使用 Python 3.10 ABI，而不是静默降级到 3.9 ABI。<a href="https://github.com/PyO3/pyo3/pull/2242">#2242</a></li>
<li>在为 macOS 交叉编译并链接 <a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/FrameworkAnatomy.html">Framework bundle</a> 时使用共享链接模式。<a href="https://github.com/PyO3/pyo3/pull/2233">#2233</a></li>
<li>修复当 <code>PYO3_CROSS_LIB_DIR</code> 在某些主机/目标组合下设置时编译期间的 panic 问题。<a href="https://github.com/PyO3/pyo3/pull/2232">#2232</a></li>
<li>修正 <code>syn</code> 依赖版本，要求最小补丁版本为 1.0.56。<a href="https://github.com/PyO3/pyo3/pull/2240">#2240</a></li>
</ul>
<h2 id="0162---2022-03-15"><a class="header" href="#0162---2022-03-15">[0.16.2] - 2022-03-15</a></h2>
<h3 id="打包-21"><a class="header" href="#打包-21">打包</a></h3>
<ul>
<li>当在 PyPy 3.7 且版本旧于 PyPy 7.3.8 的环境中导入模块时发出警告，因为已知存在二进制兼容性问题。<a href="https://github.com/PyO3/pyo3/pull/2217">#2217</a></li>
<li>确保 <code>pyo3-ffi</code> 的构建脚本在 <code>pyo3</code> 之前运行，以修复交叉编译问题。<a href="https://github.com/PyO3/pyo3/pull/2224">#2224</a></li>
</ul>
<h2 id="0161---2022-03-05"><a class="header" href="#0161---2022-03-05">[0.16.1] - 2022-03-05</a></h2>
<h3 id="打包-22"><a class="header" href="#打包-22">打包</a></h3>
<ul>
<li>扩展 <code>hashbrown</code> 可选依赖的支持版本以包含 0.12。<a href="https://github.com/PyO3/pyo3/pull/2197">#2197</a></li>
</ul>
<h3 id="修复-24"><a class="header" href="#修复-24">修复</a></h3>
<ul>
<li>修复 <code>pyo3-build-config</code> 中 Windows 平台检测不正确的问题。<a href="https://github.com/PyO3/pyo3/pull/2198">#2198</a></li>
<li>修复 0.16 版本后无法交叉编译到 aarch64 macOS 的回归问题。<a href="https://github.com/PyO3/pyo3/pull/2201">#2201</a></li>
</ul>
<h2 id="0160---2022-02-27"><a class="header" href="#0160---2022-02-27">[0.16.0] - 2022-02-27</a></h2>
<h3 id="打包-23"><a class="header" href="#打包-23">打包</a></h3>
<ul>
<li>将最低支持 Rust 版本（MSRV）更新为 1.48。<a href="https://github.com/PyO3/pyo3/pull/2004">#2004</a></li>
<li>将可选依赖 <code>indoc</code> 更新至 1.0。<a href="https://github.com/PyO3/pyo3/pull/2004">#2004</a></li>
<li>停止支持 Python 3.6，移除 <code>abi3-py36</code> 功能。<a href="https://github.com/PyO3/pyo3/pull/2006">#2006</a></li>
<li><code>pyo3-build-config</code> 不再默认启用 <code>resolve-config</code> 功能。<a href="https://github.com/PyO3/pyo3/pull/2008">#2008</a></li>
<li>将可选依赖 <code>inventory</code> 更新至 0.2。<a href="https://github.com/PyO3/pyo3/pull/2019">#2019</a></li>
<li>移除 <code>paste</code> 依赖。<a href="https://github.com/PyO3/pyo3/pull/2081">#2081</a></li>
<li><code>pyo3::ffi</code> 中的绑定现在是独立的 <code>pyo3-ffi</code> crate 的重新导出。<a href="https://github.com/PyO3/pyo3/pull/2126">#2126</a></li>
<li>支持 PyPy 3.9。<a href="https://github.com/PyO3/pyo3/pull/2143">#2143</a></li>
</ul>
<h3 id="新增-29"><a class="header" href="#新增-29">新增</a></h3>
<ul>
<li>添加 <code>PyCapsule</code> 类型，暴露 <a href="https://docs.python.org/3/c-api/capsule.html#capsules">Capsule API</a>。<a href="https://github.com/PyO3/pyo3/pull/1980">#1980</a></li>
<li>添加 <code>pyo3_build_config::Sysconfigdata</code> 及相关支持 API。<a href="https://github.com/PyO3/pyo3/pull/1996">#1996</a></li>
<li>添加 <code>Py::setattr</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/2009">#2009</a></li>
<li>在所有属性宏中添加 <code>#[pyo3(crate = "some::path")]</code> 选项（除已废弃的 <code>#[pyproto]</code> 外）。<a href="https://github.com/PyO3/pyo3/pull/2022">#2022</a></li>
<li>允许 <code>create_exception!</code> 宏接受可选的文档字符串。<a href="https://github.com/PyO3/pyo3/pull/2027">#2027</a></li>
<li>支持对无字段（即 C 风格）枚举使用 <code>#[pyclass]</code>。<a href="https://github.com/PyO3/pyo3/pull/2034">#2034</a></li>
<li>在 <code>#[pymethods]</code> 中添加缓冲区魔术方法 <code>__getbuffer__</code> 和 <code>__releasebuffer__</code>。<a href="https://github.com/PyO3/pyo3/pull/2067">#2067</a></li>
<li>在 <code>wrap_pyfunction</code> 和 <code>wrap_pymodule</code> 中添加对路径的支持。<a href="https://github.com/PyO3/pyo3/pull/2081">#2081</a></li>
<li>允许 <code>wrap_pyfunction!</code> 包装在不同 Rust 模块或 crate 中实现的 <code>#[pyfunction]</code>。<a href="https://github.com/PyO3/pyo3/pull/2091">#2091</a></li>
<li>添加 <code>PyAny::contains</code> 方法（对应 <code>PyAny</code> 的 <code>in</code> 操作符）。<a href="https://github.com/PyO3/pyo3/pull/2115">#2115</a></li>
<li>添加 <code>PyMapping::contains</code> 方法（对应 <code>PyMapping</code> 的 <code>in</code> 操作符）。<a href="https://github.com/PyO3/pyo3/pull/2133">#2133</a></li>
<li>在 <code>#[pymethods]</code> 中添加垃圾回收魔术方法 <code>__traverse__</code> 和 <code>__clear__</code>。<a href="https://github.com/PyO3/pyo3/pull/2159">#2159</a></li>
<li>添加对结构体元组和枚举的 <code>from_py_with</code> 支持，以覆盖默认的从 Python 转换逻辑。<a href="https://github.com/PyO3/pyo3/pull/2181">#2181</a></li>
<li>为 <code>PyAny</code> 添加 <code>eq</code>、<code>ne</code>、<code>lt</code>、<code>le</code>、<code>gt</code>、<code>ge</code> 方法，以包装 <code>rich_compare</code>。<a href="https://github.com/PyO3/pyo3/pull/2175">#2175</a></li>
<li>添加 <code>Py::is</code> 和 <code>PyAny::is</code> 方法用于检查对象身份。<a href="https://github.com/PyO3/pyo3/pull/2183">#2183</a></li>
<li>添加对 <code>__getattribute__</code> 魔术方法的支持。<a href="https://github.com/PyO3/pyo3/pull/2187">#2187</a></li>
</ul>
<h3 id="更改-15"><a class="header" href="#更改-15">更改</a></h3>
<ul>
<li><code>PyType::is_subclass</code>、<code>PyErr::is_instance</code> 和 <code>PyAny::is_instance</code> 现在在运行时操作类型对象，而不是编译时已知的类型。旧行为仍可通过 <code>PyType::is_subclass_of</code>、<code>PyErr::is_instance_of</code> 和 <code>PyAny::is_instance_of</code> 使用。<a href="https://github.com/PyO3/pyo3/pull/1985">#1985</a></li>
<li>重命名 <code>PyErr</code> 上的一些方法（旧名称目前仅标记为废弃）：<a href="https://github.com/PyO3/pyo3/pull/2026">#2026</a>
<ul>
<li><code>pytype</code> -&gt; <code>get_type</code></li>
<li><code>pvalue</code> -&gt; <code>value</code>（并废弃等效的 <code>instance</code>）</li>
<li><code>ptraceback</code> -&gt; <code>traceback</code></li>
<li><code>from_instance</code> -&gt; <code>from_value</code></li>
<li><code>into_instance</code> -&gt; <code>into_value</code></li>
</ul>
</li>
<li><code>PyErr::new_type</code> 现在接受可选的文档字符串，并返回 <code>PyResult&lt;Py&lt;PyType&gt;&gt;</code> 而不是一个 <code>ffi::PyTypeObject</code> 指针。<a href="https://github.com/PyO3/pyo3/pull/2027">#2027</a></li>
<li>将 <code>PyType::is_instance</code> 标记为废弃；它与其他 PyO3 中的 <code>is_instance</code> 方法不一致。应使用 <code>obj.is_instance(typ)</code> 代替 <code>typ.is_instance(obj)</code>。<a href="https://github.com/PyO3/pyo3/pull/2031">#2031</a></li>
<li><code>#[pymethods]</code> 中的 <code>__getitem__</code>、<code>__setitem__</code> 和 <code>__delitem__</code> 现在默认同时实现 Python 映射和序列。<a href="https://github.com/PyO3/pyo3/pull/2065">#2065</a></li>
<li>提升 <code>#[derive(FromPyObject)]</code> 枚举的性能和错误消息。<a href="https://github.com/PyO3/pyo3/pull/2068">#2068</a></li>
<li>减少以下内容生成的 LLVM 代码大小（以提高编译速度）：
<ul>
<li>内部 <code>handle_panic</code> 辅助函数 <a href="https://github.com/PyO3/pyo3/pull/2074">#2074</a> <a href="https://github.com/PyO3/pyo3/pull/2158">#2158</a></li>
<li><code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 的参数提取 <a href="https://github.com/PyO3/pyo3/pull/2075">#2075</a> <a href="https://github.com/PyO3/pyo3/pull/2085">#2085</a></li>
<li><code>#[pyclass]</code> 类型对象的创建 <a href="https://github.com/PyO3/pyo3/pull/2076">#2076</a> <a href="https://github.com/PyO3/pyo3/pull/2081">#2081</a> <a href="https://github.com/PyO3/pyo3/pull/2157">#2157</a></li>
</ul>
</li>
<li>尊重被 <code>wrap_pyfunction</code> 和 <code>wrap_pymodule</code> 包裹项的 Rust 私有性规则。<a href="https://github.com/PyO3/pyo3/pull/2081">#2081</a></li>
<li>为 <code>__ipow__</code> 魔术方法添加模数参数。<a href="https://github.com/PyO3/pyo3/pull/2083">#2083</a></li>
<li>修复 <code>_PyCFunctionFast</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/2126">#2126</a></li>
<li><code>PyDateTimeAPI</code> 和 <code>PyDateTime_TimeZone_UTC</code> 现在是不安全函数而非静态变量。<a href="https://github.com/PyO3/pyo3/pull/2126">#2126</a></li>
<li><code>PyDateTimeAPI</code> 不再隐式调用 <code>PyDateTime_IMPORT</code>，以更贴近原始 Python API。在首次调用 <code>PyDateTime_IMPORT</code> 前返回空指针。因此在调用以下任一 FFI 函数前必须先调用 <code>PyDateTime_IMPORT</code>，以避免未定义行为：<a href="https://github.com/PyO3/pyo3/pull/2126">#2126</a>
<ul>
<li><code>PyDateTime_TimeZone_UTC</code></li>
<li><code>PyDate_Check</code></li>
<li><code>PyDate_CheckExact</code></li>
<li><code>PyDateTime_Check</code></li>
<li><code>PyDateTime_CheckExact</code></li>
<li><code>PyTime_Check</code></li>
<li><code>PyTime_CheckExact</code></li>
<li><code>PyDelta_Check</code></li>
<li><code>PyDelta_CheckExact</code></li>
<li><code>PyTZInfo_Check</code></li>
<li><code>PyTZInfo_CheckExact</code></li>
<li><code>PyDateTime_FromTimestamp</code></li>
<li><code>PyDate_FromTimestamp</code></li>
</ul>
</li>
<li>将 <code>pyclass</code> 的 <code>gc</code> 选项（如 <code>#[pyclass(gc)]</code>）标记为废弃。直接实现 <code>__traverse__</code> <code>#[pymethod]</code> 即可。<a href="https://github.com/PyO3/pyo3/pull/2159">#2159</a></li>
<li><code>PyMethodDef</code> 中的 <code>ml_meth</code> 字段现在由 <code>PyMethodDefPointer</code> 联合体表示。<a href="https://github.com/PyO3/pyo3/pull/2166">2166</a></li>
<li>将 <code>#[pyproto]</code> 特质标记为废弃。<a href="https://github.com/PyO3/pyo3/pull/2173">#2173</a></li>
</ul>
<h3 id="移除-6"><a class="header" href="#移除-6">移除</a></h3>
<ul>
<li>移除所有在 PyO3 0.14 中已废弃的功能。<a href="https://github.com/PyO3/pyo3/pull/2007">#2007</a></li>
<li>移除 <code>PyMethodDef</code> 的 <code>Default</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/2166">#2166</a></li>
<li>移除 <code>Py</code> 和 <code>PyAny</code> 的 <code>PartialEq</code> 实现（请改用新的 <code>is</code>）。<a href="https://github.com/PyO3/pyo3/pull/2183">#2183</a></li>
</ul>
<h3 id="修复-25"><a class="header" href="#修复-25">修复</a></h3>
<ul>
<li>修复在 PyPy 上 <code>PyObject_HasAttr</code> 出现的未定义符号问题。<a href="https://github.com/PyO3/pyo3/pull/2025">#2025</a></li>
<li>修复 <code>PyErr::into_value</code> 中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/2026">#2026</a></li>
<li>修复由 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 生成代码中的 clippy 警告 <code>needless-option-as-deref</code>。<a href="https://github.com/PyO3/pyo3/pull/2040">#2040</a>- 修复 <code>PySlice::indices</code> 中的未定义行为。<a href="https://github.com/PyO3/pyo3/pull/2061">#2061</a></li>
<li>修复 <code>wrap_pymodule!</code> 宏在带有 <code>#[pyo3(name = "..")]</code> 属性的 <code>#[pymodule]</code> 上使用了错误名称的问题。<a href="https://github.com/PyO3/pyo3/pull/2081">#2081</a></li>
<li>修复 <code>#[pymethods]</code> 中的魔法方法接受参数数量错误的实现。<a href="https://github.com/PyO3/pyo3/pull/2083">#2083</a></li>
<li>修复在 <code>#[pyfunction]</code> 生成的代码中，当一个位于 <code>Option</code> 之后的必需参数未提供时引发的 panic。<a href="https://github.com/PyO3/pyo3/pull/2093">#2093</a></li>
<li>修复因不正确的 <code>ExactSizeIterator</code> 实现导致的未定义行为。<a href="https://github.com/PyO3/pyo3/pull/2124">#2124</a></li>
<li>修复在 Python 3.9 及以上版本中缺少 FFI 定义 <code>PyCMethod_New</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/2143">#2143</a></li>
<li>在 PyPy 上添加缺失的 FFI 定义 <code>_PyLong_NumBits</code> 和 <code>_PyLong_AsByteArray</code>。<a href="https://github.com/PyO3/pyo3/pull/2146">#2146</a></li>
<li>修复 <code>Option&lt;T&gt;</code> 的 <code>AsPyPointer</code> 实现中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/2160">#2160</a></li>
<li>将 <code>_PyLong_NumBits</code> 的 FFI 定义修改为返回 <code>size_t</code> 而非 <code>c_int</code>。<a href="https://github.com/PyO3/pyo3/pull/2161">#2161</a></li>
<li>修复参数解析失败时抛出的 <code>TypeError</code> 缺少原始错误原因的问题。<a href="https://github.com/PyO3/pyo3/pull/2178">#2177</a></li>
</ul>
<h2 id="0152---2022-04-14"><a class="header" href="#0152---2022-04-14">[0.15.2] - 2022-04-14</a></h2>
<h3 id="打包-24"><a class="header" href="#打包-24">打包</a></h3>
<ul>
<li>从 PyO3 0.16 向后移植 PyPy 3.9 支持。<a href="https://github.com/PyO3/pyo3/pull/2262">#2262</a></li>
</ul>
<h2 id="0151---2021-11-19"><a class="header" href="#0151---2021-11-19">[0.15.1] - 2021-11-19</a></h2>
<h3 id="新增-30"><a class="header" href="#新增-30">新增</a></h3>
<ul>
<li>为 <code>Py&lt;PySequence&gt;</code>、<code>Py&lt;PyIterator&gt;</code> 和 <code>Py&lt;PyMapping&gt;</code> 添加 <code>Py::as_ref</code> 和 <code>Py::into_ref</code> 的实现。<a href="https://github.com/PyO3/pyo3/pull/1682">#1682</a></li>
<li>添加 <code>PyTraceback</code> 类型以表示和格式化 Python 的 traceback。<a href="https://github.com/PyO3/pyo3/pull/1977">#1977</a></li>
</ul>
<h3 id="更改-16"><a class="header" href="#更改-16">更改</a></h3>
<ul>
<li>使用已知魔法方法名（小写）的 <code>#[classattr]</code> 常量不再触发期望常量为大写的 lint 警告。<a href="https://github.com/PyO3/pyo3/pull/1969">#1969</a></li>
</ul>
<h3 id="修复-26"><a class="header" href="#修复-26">修复</a></h3>
<ul>
<li>修复通过名称为已知魔法方法的函数创建 <code>#[classattr]</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/1969">#1969</a></li>
<li>修复在 <code>allow_threads</code> 中使用 <code>catch_unwind</code> 可能导致致命崩溃的问题。<a href="https://github.com/PyO3/pyo3/pull/1989">#1989</a></li>
<li>修复在激活 abi3 特性时 PyPy 上构建失败的问题。<a href="https://github.com/PyO3/pyo3/pull/1991">#1991</a></li>
<li>修复 mingw 平台检测问题。<a href="https://github.com/PyO3/pyo3/pull/1993">#1993</a></li>
<li>修复访问类型对象上的描述符时 <code>__get__</code> 实现中出现的 panic。<a href="https://github.com/PyO3/pyo3/pull/1997">#1997</a></li>
</ul>
<h2 id="0150---2021-11-03"><a class="header" href="#0150---2021-11-03">[0.15.0] - 2021-11-03</a></h2>
<h3 id="打包-25"><a class="header" href="#打包-25">打包</a></h3>
<ul>
<li><code>pyo3</code> 的 <code>Cargo.toml</code> 现在声明 <code>links = "python"</code>，以告知 Cargo 它链接到 <em>libpython</em>。<a href="https://github.com/PyO3/pyo3/pull/1819">#1819</a></li>
<li>添加可选的 <code>anyhow</code> 特性，用于将 <code>anyhow::Error</code> 转换为 <code>PyErr</code>。<a href="https://github.com/PyO3/pyo3/pull/1822">#1822</a></li>
<li>支持 Python 3.10。<a href="https://github.com/PyO3/pyo3/pull/1889">#1889</a></li>
<li>添加可选的 <code>eyre</code> 特性，用于将 <code>eyre::Report</code> 转换为 <code>PyErr</code>。<a href="https://github.com/PyO3/pyo3/pull/1893">#1893</a></li>
<li>支持 PyPy 3.8。<a href="https://github.com/PyO3/pyo3/pull/1948">#1948</a></li>
</ul>
<h3 id="新增-31"><a class="header" href="#新增-31">新增</a></h3>
<ul>
<li>添加 <code>PyList::get_item_unchecked</code> 和 <code>PyTuple::get_item_unchecked</code>，用于在无边界检查的情况下获取元素。<a href="https://github.com/PyO3/pyo3/pull/1733">#1733</a></li>
<li>支持 Rust 1.54 及以上版本的 <code>#[doc = include_str!(...)]</code> 属性。<a href="https://github.com/PyO3/pyo3/issues/1746">#1746</a></li>
<li>添加 <code>PyAny::py</code> 作为 <code>PyNativeType::py</code> 的便捷方法。<a href="https://github.com/PyO3/pyo3/pull/1751">#1751</a></li>
<li>为 <code>PyList</code>、<code>PyTuple</code> 和 <code>PySequence</code> 添加 <code>std::ops::Index&lt;usize&gt;</code> 的实现。<a href="https://github.com/PyO3/pyo3/pull/1825">#1825</a></li>
<li>为 <code>PyList</code>、<code>PyTuple</code> 和 <code>PySequence</code> 添加 <code>std::ops::Index</code> 的范围索引实现。<a href="https://github.com/PyO3/pyo3/pull/1829">#1829</a></li>
<li>添加 <code>PyMapping</code> 类型以表示 Python 映射协议。<a href="https://github.com/PyO3/pyo3/pull/1844">#1844</a></li>
<li>为 <code>PyList</code> 和 <code>PyTuple</code> 添加常用序列方法。<a href="https://github.com/PyO3/pyo3/pull/1849">#1849</a></li>
<li>为 <code>PyList</code> 和 <code>PyTuple</code> 添加 <code>as_sequence</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/1860">#1860</a></li>
<li>在 <code>#[pymethods]</code> 中添加对魔法方法的支持，旨在替代 <code>#[pyproto]</code>。<a href="https://github.com/PyO3/pyo3/pull/1864">#1864</a></li>
<li>添加 <code>abi3-py310</code> 特性。<a href="https://github.com/PyO3/pyo3/pull/1889">#1889</a></li>
<li>添加 <code>PyCFunction::new_closure</code>，用于从 Rust 闭包创建 Python 函数。<a href="https://github.com/PyO3/pyo3/pull/1901">#1901</a></li>
<li>在 <code>#[pyfunction]</code> 中添加对仅位置参数的支持。<a href="https://github.com/PyO3/pyo3/pull/1925">#1925</a></li>
<li>添加 <code>PyErr::take</code>，用于尝试获取当前存在的 Python 异常。<a href="https://github.com/PyO3/pyo3/pull/1957">#1957</a></li>
</ul>
<h3 id="更改-17"><a class="header" href="#更改-17">更改</a></h3>
<ul>
<li><code>PyList</code>、<code>PyTuple</code> 和 <code>PySequence</code> 的 API 现在接受 <code>usize</code> 索引而非 <code>isize</code>。
<a href="https://github.com/PyO3/pyo3/pull/1733">#1733</a>，<a href="https://github.com/PyO3/pyo3/pull/1802">#1802</a>，
<a href="https://github.com/PyO3/pyo3/pull/1803">#1803</a></li>
<li><code>PyList::get_item</code> 和 <code>PyTuple::get_item</code> 现在返回 <code>PyResult&lt;&amp;PyAny&gt;</code> 而非 panic。<a href="https://github.com/PyO3/pyo3/pull/1733">#1733</a></li>
<li><code>PySequence::in_place_repeat</code> 和 <code>PySequence::in_place_concat</code> 现在返回 <code>PyResult&lt;&amp;PySequence&gt;</code> 而非 <code>PyResult&lt;()&gt;</code>，这对不可变序列（如元组）是必需的。<a href="https://github.com/PyO3/pyo3/pull/1803">#1803</a></li>
<li><code>PySequence::get_slice</code> 现在返回 <code>PyResult&lt;&amp;PySequence&gt;</code> 而非 <code>PyResult&lt;&amp;PyAny&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/1829">#1829</a></li>
<li>弃用 <code>PyTuple::split_from</code>。<a href="https://github.com/PyO3/pyo3/pull/1804">#1804</a></li>
<li>弃用 <code>PyTuple::slice</code>，新增使用 <code>usize</code> 索引的方法 <code>PyTuple::get_slice</code>。<a href="https://github.com/PyO3/pyo3/pull/1828">#1828</a></li>
<li>在为 Python 3.9 构建时，弃用 FFI 定义 <code>PyParser_SimpleParseStringFlags</code>、<code>PyParser_SimpleParseStringFlagsFilename</code> 和 <code>PyParser_SimpleParseFileFlags</code>。<a href="https://github.com/PyO3/pyo3/pull/1830">#1830</a></li>
<li>标记 Python 3.10 中已移除的 FFI 定义 <code>PyParser_ASTFromString</code>、<code>PyParser_ASTFromStringObject</code>、<code>PyParser_ASTFromFile</code>、<code>PyParser_ASTFromFileObject</code>、<code>PyParser_SimpleParseStringFlags</code>、<code>PyParser_SimpleParseStringFlagsFilename</code>、<code>PyParser_SimpleParseFileFlags</code>、<code>PyParser_SimpleParseString</code>、<code>PyParser_SimpleParseFile</code>、<code>Py_SymtableString</code> 和 <code>Py_SymtableStringObject</code>。<a href="https://github.com/PyO3/pyo3/pull/1830">#1830</a></li>
<li><code>#[pymethods]</code> 现在对魔法方法的处理方式类似于 <code>#[pyproto]</code>。未来可能会弃用 <code>#[pyproto]</code>。<a href="https://github.com/PyO3/pyo3/pull/1864">#1864</a></li>
<li>弃用 FFI 定义 <code>PySys_AddWarnOption</code>、<code>PySys_AddWarnOptionUnicode</code> 和 <code>PySys_HasWarnOptions</code>。<a href="https://github.com/PyO3/pyo3/pull/1887">#1887</a></li>
<li>弃用 <code>#[call]</code> 属性，建议改用 <code>fn __call__</code>。<a href="https://github.com/PyO3/pyo3/pull/1929">#1929</a></li>
<li>修复 Python 3.10 上缺失的 FFI 定义 <code>_PyImport_FindExtensionObject</code>。<a href="https://github.com/PyO3/pyo3/pull/1942">#1942</a></li>
<li>更改 <code>PyErr::fetch</code>，在 debug 模式下若无异常存在则 panic。<a href="https://github.com/PyO3/pyo3/pull/1957">#1957</a></li>
</ul>
<h3 id="修复-27"><a class="header" href="#修复-27">修复</a></h3>
<ul>
<li>修复在 Windows 上使用 conda 环境构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1873">#1873</a></li>
<li>修复在 Python 初始化但线程未初始化时，调用 <code>Python::with_gil</code> 在 Python 3.6 上 panic 的问题。<a href="https://github.com/PyO3/pyo3/pull/1874">#1874</a></li>
<li>修复在使用 <code>abi3</code> 时交叉编译到 Windows 时错误链接版本特定 DLL 而非 <code>python3.dll</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/1880">#1880</a></li>
<li>修复 <code>PyTuple_ClearFreeList</code> 的 FFI 定义在 Python 3.9 及以上版本中错误存在的问题。<a href="https://github.com/PyO3/pyo3/pull/1887">#1887</a></li>
<li>修复为枚举生成的 <code>#[derive(FromPyObject)]</code> 中出现的 panic。<a href="https://github.com/PyO3/pyo3/pull/1888">#1888</a></li>
<li>修复使用 “m” abi 标志交叉编译到 Python 3.7 构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1908">#1908</a></li>
<li>修复 <code>__mod__</code> 魔法方法回退到 <code>__rmod__</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/1934">#1934</a></li>
<li>修复 Python 3.10 上缺失的 FFI 定义 <code>_PyImport_FindExtensionObject</code>。<a href="https://github.com/PyO3/pyo3/pull/1942">#1942</a></li>
</ul>
<h2 id="0145---2021-09-05"><a class="header" href="#0145---2021-09-05">[0.14.5] - 2021-09-05</a></h2>
<h3 id="新增-32"><a class="header" href="#新增-32">新增</a></h3>
<ul>
<li>将 <code>pyo3_build_config::InterpreterConfig</code> 及其子字段设为公开。<a href="https://github.com/PyO3/pyo3/pull/1848">#1848</a></li>
<li>在 <code>pyo3-build-config</code> 中添加 <code>resolve-config</code> 特性，以控制其构建脚本是否执行操作。<a href="https://github.com/PyO3/pyo3/pull/1856">#1856</a></li>
</ul>
<h3 id="修复-28"><a class="header" href="#修复-28">修复</a></h3>
<ul>
<li>修复 0.14.4 在 <code>s390x-unknown-linux-gnu</code> 目标上的编译回归问题。<a href="https://github.com/PyO3/pyo3/pull/1850">#1850</a></li>
</ul>
<h2 id="0144---2021-08-29"><a class="header" href="#0144---2021-08-29">[0.14.4] - 2021-08-29</a></h2>
<h3 id="更改-18"><a class="header" href="#更改-18">更改</a></h3>
<ul>
<li>将 <code>PyString::data</code> 标记为 <code>unsafe</code>，并且在大端序目标上禁用该方法及一些依赖 C 位域的 PyUnicode FFI API。<a href="https://github.com/PyO3/pyo3/pull/1834">#1834</a></li>
</ul>
<h2 id="0143---2021-08-22"><a class="header" href="#0143---2021-08-22">[0.14.3] - 2021-08-22</a></h2>
<h3 id="新增-33"><a class="header" href="#新增-33">新增</a></h3>
<ul>
<li>添加 <code>PyString::data</code> 以访问 Python 字符串中存储的原始字节。<a href="https://github.com/PyO3/pyo3/pull/1794">#1794</a></li>
</ul>
<h3 id="修复-29"><a class="header" href="#修复-29">修复</a></h3>
<ul>
<li>在对带有 <code>#[setter]</code> 的类属性调用 <code>del</code> 时抛出 <code>AttributeError</code> 以避免 panic。<a href="https://github.com/PyO3/pyo3/pull/1779">#1779</a></li>
<li>将 FFI 定义 <code>PyGILState_Check</code> 和 <code>Py_tracefunc</code> 限制在无限 API 中。<a href="https://github.com/PyO3/pyo3/pull/1787">#1787</a></li>
<li>在 <code>PyStatus</code> 结构体定义中添加缺失的 <code>_type</code> 字段。<a href="https://github.com/PyO3/pyo3/pull/1791">#1791</a></li>
<li>降低 <code>num-complex</code> 可选依赖的下限版本，以支持在 MSRV 为 1.41 时与 <code>rust-numpy</code> 和 <code>ndarray</code> 互操作。<a href="https://github.com/PyO3/pyo3/pull/1799">#1799</a></li>
<li>修复 <code>Python::run_code</code> 中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/1806">#1806</a></li>
<li>修复 <code>PyModule::from_code</code> 中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/1810">#1810</a></li>
<li>移除 <code>pyo3::types::datetime</code> 中对 <code>pyo3::</code> 的使用，此问题在使用 <code>-Z avoid-dev-deps</code> 时会破坏构建。<a href="https://github.com/PyO3/pyo3/pull/1811">#1811</a></li>
</ul>
<h2 id="0142---2021-08-09"><a class="header" href="#0142---2021-08-09">[0.14.2] - 2021-08-09</a></h2>
<h3 id="新增--添加-indexmap-功能为-indexmapindexmap-提供-topyobjectintopy-和-frompyobject-的实现1728"><a class="header" href="#新增--添加-indexmap-功能为-indexmapindexmap-提供-topyobjectintopy-和-frompyobject-的实现1728">新增- 添加 <code>indexmap</code> 功能，为 <code>indexmap::IndexMap</code> 提供 <code>ToPyObject</code>、<code>IntoPy</code> 和 <code>FromPyObject</code> 的实现。<a href="https://github.com/PyO3/pyo3/pull/1728">#1728</a></a></h3>
<ul>
<li>添加 <code>pyo3_build_config::add_extension_module_link_args</code>，用于在构建脚本中设置链接器参数（适用于 macOS）。<a href="https://github.com/PyO3/pyo3/pull/1755">#1755</a></li>
<li>添加 <code>Python::with_gil_unchecked</code>，这是 <code>Python::with_gil</code> 的不安全变体，允许在 <code>Python::with_gil</code> 会失败的场景中获取 <code>Python</code>。<a href="https://github.com/PyO3/pyo3/pull/1769">#1769</a></li>
</ul>
<h3 id="变更-10"><a class="header" href="#变更-10">变更</a></h3>
<ul>
<li><code>PyErr::new</code> 不再在内部获取 Python GIL。<a href="https://github.com/PyO3/pyo3/pull/1724">#1724</a></li>
<li>撤销 PyO3 0.14.0 在其构建脚本中使用 <code>cargo:rustc-cdylib-link-arg</code> 的行为，因为 Cargo 意外地允许 crate 通过这种方式向下游 crate 传递链接器参数。支持 macOS 的项目可能需要恢复 <code>.cargo/config.toml</code> 文件。<a href="https://github.com/PyO3/pyo3/pull/1755">#1755</a></li>
</ul>
<h3 id="修复-30"><a class="header" href="#修复-30">修复</a></h3>
<ul>
<li>修复 0.14.0 版本中的回归问题，该问题拒绝在使用 PyO3 宏注解的结构体和函数上使用 <code>#[doc(hidden)]</code>。<a href="https://github.com/PyO3/pyo3/pull/1722">#1722</a></li>
<li>修复 0.14.0 版本中的回归问题，该问题导致 <code>#[pyfunction]</code> 的代码覆盖率计算不正确。<a href="https://github.com/PyO3/pyo3/pull/1726">#1726</a></li>
<li>修复 PyPy 上 <code>Py_Buffer</code> 的错误 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1737">#1737</a></li>
<li>修复 32 位 Windows 上 <code>dictoffset</code> 的错误计算。<a href="https://github.com/PyO3/pyo3/pull/1475">#1475</a></li>
<li>修复 0.13.2 版本中的回归问题，该问题导致在 Windows “gnu” 目标上链接到错误的 Python 库。<a href="https://github.com/PyO3/pyo3/pull/1759">#1759</a></li>
<li>修复编译器警告：禁止在表达式宏中使用尾随分号。<a href="https://github.com/PyO3/pyo3/pull/1762">#1762</a></li>
<li>修复 <code>Py_DecodeLocale</code> 的错误 FFI 定义。第二个参数现在是 <code>*mut Py_ssize_t</code> 而不是 <code>Py_ssize_t</code>。<a href="https://github.com/PyO3/pyo3/pull/1766">#1766</a></li>
</ul>
<h2 id="0141---2021-07-04"><a class="header" href="#0141---2021-07-04">[0.14.1] - 2021-07-04</a></h2>
<h3 id="新增-34"><a class="header" href="#新增-34">新增</a></h3>
<ul>
<li>为 <code>&amp;PathBuf</code> 和 <code>&amp;OsString</code> 实现 <code>IntoPy&lt;PyObject&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/1712">#1712</a></li>
</ul>
<h3 id="修复-31"><a class="header" href="#修复-31">修复</a></h3>
<ul>
<li>修复因 <code>PyList_SET_ITEM</code> 的错误定义导致在 PyPy 上崩溃的问题。<a href="https://github.com/PyO3/pyo3/pull/1713">#1713</a></li>
</ul>
<h2 id="0140---2021-07-03"><a class="header" href="#0140---2021-07-03">[0.14.0] - 2021-07-03</a></h2>
<h3 id="打包-26"><a class="header" href="#打包-26">打包</a></h3>
<ul>
<li>将可选依赖项 <code>num-bigint</code> 更新至 0.4。<a href="https://github.com/PyO3/pyo3/pull/1481">#1481</a></li>
<li>将可选依赖项 <code>num-complex</code> 更新至 0.4。<a href="https://github.com/PyO3/pyo3/pull/1482">#1482</a></li>
<li>扩展可选依赖项 <code>hashbrown</code> 的支持版本，包含 0.11。<a href="https://github.com/PyO3/pyo3/pull/1496">#1496</a></li>
<li>支持 PyPy 3.7。<a href="https://github.com/PyO3/pyo3/pull/1538">#1538</a></li>
</ul>
<h3 id="新增-35"><a class="header" href="#新增-35">新增</a></h3>
<ul>
<li>使用 const generics（在 Rust 1.51 及以上版本）扩展 <code>[T; N]</code> 的转换支持至所有 <code>N</code>。<a href="https://github.com/PyO3/pyo3/pull/1128">#1128</a></li>
<li>添加 <code>OsStr</code> / <code>OsString</code> 与 Python 字符串之间的转换。<a href="https://github.com/PyO3/pyo3/pull/1379">#1379</a></li>
<li>添加 <code>Path</code> / <code>PathBuf</code> 与 Python 字符串（以及 <code>pathlib.Path</code> 对象）之间的转换。<a href="https://github.com/PyO3/pyo3/pull/1379">#1379</a> <a href="https://github.com/PyO3/pyo3/pull/1654">#1654</a></li>
<li>添加一组新的 <code>#[pyo3(...)]</code> 属性，用于控制各种 PyO3 宏功能：
<ul>
<li><code>#[pyo3(from_py_with = "...")]</code> 用于覆盖默认的从 Python 转换逻辑，适用于函数参数和结构体字段。<a href="https://github.com/PyO3/pyo3/pull/1411">#1411</a></li>
<li><code>#[pyo3(name = "...")]</code> 用于设置 Python 名称。<a href="https://github.com/PyO3/pyo3/pull/1567">#1567</a></li>
<li><code>#[pyo3(text_signature = "...")]</code> 用于设置文本签名。<a href="https://github.com/PyO3/pyo3/pull/1658">#1658</a></li>
</ul>
</li>
<li>为 Python 3.9 及更高版本添加 FFI 定义 <code>PyCFunction_CheckExact</code>。<a href="https://github.com/PyO3/pyo3/pull/1425">#1425</a></li>
<li>添加 FFI 定义 <code>Py_IS_TYPE</code>。<a href="https://github.com/PyO3/pyo3/pull/1429">#1429</a></li>
<li>添加 FFI 定义 <code>_Py_InitializeMain</code>。<a href="https://github.com/PyO3/pyo3/pull/1473">#1473</a></li>
<li>添加来自 <code>cpython/import.h</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1475">#1475</a></li>
<li>为 <code>#[pyclass]</code> 宏添加元组和单元结构体支持。<a href="https://github.com/PyO3/pyo3/pull/1504">#1504</a></li>
<li>添加 FFI 定义 <code>PyDateTime_TimeZone_UTC</code>。<a href="https://github.com/PyO3/pyo3/pull/1572">#1572</a></li>
<li>添加对 <code>#[pyclass(extends=Exception)]</code> 的支持。<a href="https://github.com/PyO3/pyo3/pull/1591">#1591</a></li>
<li>添加 <code>PyErr::cause</code> 和 <code>PyErr::set_cause</code>。<a href="https://github.com/PyO3/pyo3/pull/1679">#1679</a></li>
<li>添加来自 <code>cpython/pystate.h</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1687/">#1687</a></li>
<li>在 <code>pyo3::prelude</code> 中添加 <code>wrap_pyfunction!</code> 宏。<a href="https://github.com/PyO3/pyo3/pull/1695">#1695</a></li>
</ul>
<h3 id="变更-11"><a class="header" href="#变更-11">变更</a></h3>
<ul>
<li>默认情况下，每个 <code>#[pyclass]</code> 仅允许一个 <code>#[pymethods]</code> 块，以移除对 <code>inventory</code> 的依赖。添加 <code>multiple-pymethods</code> 功能以选择性启用原始行为及对 <code>inventory</code> 的依赖。<a href="https://github.com/PyO3/pyo3/pull/1457">#1457</a></li>
<li>将 <code>PyTimeAccess::get_fold</code> 的返回值从 <code>u8</code> 更改为 <code>bool</code>。<a href="https://github.com/PyO3/pyo3/pull/1397">#1397</a></li>
<li>为 Python 3.9 及以上版本弃用 FFI 定义 <code>PyCFunction_Call</code>。<a href="https://github.com/PyO3/pyo3/pull/1425">#1425</a></li>
<li>弃用 FFI 定义 <code>PyModule_GetFilename</code>。<a href="https://github.com/PyO3/pyo3/pull/1425">#1425</a></li>
<li><code>auto-initialize</code> 功能不再默认启用。<a href="https://github.com/PyO3/pyo3/pull/1443">#1443</a></li>
<li>将 <code>PyCFunction::new</code> 和 <code>PyCFunction::new_with_keywords</code> 更改为接受 <code>'static str</code> 参数，而不是隐式复制（并泄漏）它们。<a href="https://github.com/PyO3/pyo3/pull/1450">#1450</a></li>
<li>弃用 <code>PyModule::call</code>、<code>PyModule::call0</code>、<code>PyModule::call1</code> 和 <code>PyModule::get</code>。<a href="https://github.com/PyO3/pyo3/pull/1492">#1492</a></li>
<li>在 <code>PyBuffer::copy_to_slice</code> 和 <code>PyBuffer::copy_from_slice</code> 引发的 <code>PyBufferError</code> 中添加长度信息。<a href="https://github.com/PyO3/pyo3/pull/1534">#1534</a></li>
<li>在使用 <code>extension-module</code> 功能时，自动在 macOS 上设置 <code>-undefined</code> 和 <code>dynamic_lookup</code> 链接器参数。<a href="https://github.com/PyO3/pyo3/pull/1539">#1539</a></li>
<li>弃用更易于通过 <code>#[pymethods]</code> 实现的 <code>#[pyproto]</code> 方法：<a href="https://github.com/PyO3/pyo3/pull/1560">#1560</a>
<ul>
<li><code>PyBasicProtocol::__bytes__</code> 和 <code>PyBasicProtocol::__format__</code></li>
<li><code>PyContextProtocol::__enter__</code> 和 <code>PyContextProtocol::__exit__</code></li>
<li><code>PyDescrProtocol::__delete__</code> 和 <code>PyDescrProtocol::__set_name__</code></li>
<li><code>PyMappingProtocol::__reversed__</code></li>
<li><code>PyNumberProtocol::__complex__</code> 和 <code>PyNumberProtocol::__round__</code></li>
<li><code>PyAsyncProtocol::__aenter__</code> 和 <code>PyAsyncProtocol::__aexit__</code></li>
</ul>
</li>
<li>弃用多个属性，改用新的 <code>#[pyo3(...)]</code> 选项：
<ul>
<li><code>#[name = "..."]</code> 替换为 <code>#[pyo3(name = "...")]</code> <a href="https://github.com/PyO3/pyo3/pull/1567">#1567</a></li>
<li><code>#[pyfn(m, "name")]</code> 替换为 <code>#[pyfn(m)] #[pyo3(name = "...")]</code> <a href="https://github.com/PyO3/pyo3/pull/1610">#1610</a></li>
<li><code>#[pymodule(name)]</code> 替换为 <code>#[pymodule] #[pyo3(name = "...")]</code> <a href="https://github.com/PyO3/pyo3/pull/1650">#1650</a></li>
<li><code>#[text_signature = "..."]</code> 替换为 <code>#[pyo3(text_signature = "...")]</code> <a href="https://github.com/PyO3/pyo3/pull/1658">#1658</a></li>
</ul>
</li>
<li>减少 LLVM 行数以提高编译速度。<a href="https://github.com/PyO3/pyo3/pull/1604">#1604</a></li>
<li>不再在 <code>#[pymodule]</code> 初始化代码中调用 <code>PyEval_InitThreads</code>。<a href="https://github.com/PyO3/pyo3/pull/1630">#1630</a></li>
<li>在可能的情况下使用 <code>METH_FASTCALL</code> 参数传递约定，以提高 <code>#[pyfunction]</code> 和方法的性能。
<a href="https://github.com/PyO3/pyo3/pull/1619">#1619</a>, <a href="https://github.com/PyO3/pyo3/pull/1660">#1660</a></li>
<li>交叉编译时按架构过滤 sysconfigdata 候选项。<a href="https://github.com/PyO3/pyo3/pull/1626">#1626</a></li>
</ul>
<h3 id="移除-7"><a class="header" href="#移除-7">移除</a></h3>
<ul>
<li>移除已弃用的异常名称 <code>BaseException</code> 等。<a href="https://github.com/PyO3/pyo3/pull/1426">#1426</a></li>
<li>移除已弃用的方法 <code>Python::is_instance</code>、<code>Python::is_subclass</code>、<code>Python::release</code>、<code>Python::xdecref</code> 和 <code>Py::from_owned_ptr_or_panic</code>。<a href="https://github.com/PyO3/pyo3/pull/1426">#1426</a></li>
<li>移除许多在 Python C-API 中从未存在的 FFI 定义：
<ul>
<li>（先前已弃用）<code>PyGetSetDef_INIT</code>、<code>PyGetSetDef_DICT</code>、<code>PyCoro_Check</code>、<code>PyCoroWrapper_Check</code> 和 <code>PyAsyncGen_Check</code> <a href="https://github.com/PyO3/pyo3/pull/1426">#1426</a></li>
<li><code>PyMethodDef_INIT</code> <a href="https://github.com/PyO3/pyo3/pull/1426">#1426</a></li>
<li><code>PyTypeObject_INIT</code> <a href="https://github.com/PyO3/pyo3/pull/1429">#1429</a></li>
<li><code>PyObject_Check</code>、<code>PySuper_Check</code> 和 <code>FreeFunc</code> <a href="https://github.com/PyO3/pyo3/pull/1438">#1438</a></li>
<li><code>PyModuleDef_INIT</code> <a href="https://github.com/PyO3/pyo3/pull/1630">#1630</a></li>
</ul>
</li>
<li>从 <code>PyTypeInfo</code> 中移除 pyclass 的实现细节：
<ul>
<li><code>Type</code>、<code>DESCRIPTION</code> 和 <code>FLAGS</code> <a href="https://github.com/PyO3/pyo3/pull/1456">#1456</a></li>
<li><code>BaseType</code>、<code>BaseLayout</code>、<code>Layout</code>、<code>Initializer</code> <a href="https://github.com/PyO3/pyo3/pull/1596">#1596</a></li>
</ul>
</li>
<li>移除 <code>PYO3_CROSS_INCLUDE_DIR</code> 环境变量及相关 C 头文件解析功能。<a href="https://github.com/PyO3/pyo3/pull/1521">#1521</a></li>
<li>移除 <code>raw_pycfunction!</code> 宏。<a href="https://github.com/PyO3/pyo3/pull/1619">#1619</a></li>
<li>移除 <code>PyClassAlloc</code> trait。<a href="https://github.com/PyO3/pyo3/pull/1657">#1657</a></li>
<li>移除 <code>PyList::get_parked_item</code>。<a href="https://github.com/PyO3/pyo3/pull/1664">#1664</a></li>
</ul>
<h3 id="修复-32"><a class="header" href="#修复-32">修复</a></h3>
<ul>
<li>为 Python 3.9 及更高版本移除 FFI 定义 <code>PyCFunction_ClearFreeList</code>。<a href="https://github.com/PyO3/pyo3/pull/1425">#1425</a></li>
<li>编译时从 macOS arm64 向 x86-64 Python 编译或反之，不再需要 <code>PYO3_CROSS_LIB_DIR</code> 环境变量。<a href="https://github.com/PyO3/pyo3/pull/1428">#1428</a></li>
<li>修复 FFI 定义 <code>_PyEval_RequestCodeExtraIndex</code>，其参数类型错误。<a href="https://github.com/PyO3/pyo3/pull/1429">#1429</a></li>
<li>修复在启用 <code>abi3</code> 功能时 <code>PyIndex_Check</code> 的 FFI 定义缺失问题。<a href="https://github.com/PyO3/pyo3/pull/1436">#1436</a></li>
<li>修复当在 <code>*args</code> 中传递关键字参数和位置参数时引发的错误 <code>TypeError</code>。<a href="https://github.com/PyO3/pyo3/pull/1440">#1440</a></li>
<li>修复在 <code>#[pyfunction]</code> 中无法为 <code>&amp;PyTuple</code> 的 <code>*args</code> 使用命名生命周期的问题。<a href="https://github.com/PyO3/pyo3/pull/1440">#1440</a>- 修复在宏展开内部使用 Python 参数时 <code>#[pymethods]</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/1505">#1505</a></li>
<li>不再将 <code>__doc__</code> 包含在 <code>#[pymodule]</code> 生成的 <code>__all__</code> 中。<a href="https://github.com/PyO3/pyo3/pull/1509">#1509</a></li>
<li>只要设置了 <code>PYO3_CROSS</code> 系列环境变量中的任意一个，就始终使用交叉编译配置。<a href="https://github.com/PyO3/pyo3/pull/1514">#1514</a></li>
<li>在 PyPy 上支持 <code>EnvironmentError</code>、<code>IOError</code> 和 <code>WindowsError</code>。<a href="https://github.com/PyO3/pyo3/pull/1533">#1533</a></li>
<li>修复在 Python 虚拟环境中来回执行 <code>cargo check</code> 和 <code>cargo clippy</code> 时不必要的重新构建问题。<a href="https://github.com/PyO3/pyo3/pull/1557">#1557</a></li>
<li>修复在未持有 GIL 时解引用 <code>ffi::PyDateTimeAPI</code> 导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/1563">#1563</a></li>
<li>修复 <code>u128</code> 和 <code>i128</code> 的 <code>FromPyObject</code> 实现中的内存泄漏。<a href="https://github.com/PyO3/pyo3/pull/1638">#1638</a></li>
<li>修复 <code>#[pyclass(extends=PyDict)]</code> 在 Drop 时泄露字典内容的问题。<a href="https://github.com/PyO3/pyo3/pull/1657">#1657</a></li>
<li>修复调用 <code>PyList::get_item</code> 时使用负索引导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/1668">#1668</a></li>
<li>修复 <code>PyEval_SetProfile</code>/<code>PyEval_SetTrace</code> 的 FFI 定义，使其接受 <code>Option&lt;Py_tracefunc&gt;</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/1692">#1692</a></li>
<li>修复 <code>HashSet</code> 的 <code>ToPyObject</code> 实现以支持非默认哈希器。<a href="https://github.com/PyO3/pyo3/pull/1702">#1702</a></li>
</ul>
<h2 id="0132---2021-02-12"><a class="header" href="#0132---2021-02-12">[0.13.2] - 2021-02-12</a></h2>
<h3 id="打包-27"><a class="header" href="#打包-27">打包</a></h3>
<ul>
<li>将最低支持的 Rust 版本降低为 1.41。<a href="https://github.com/PyO3/pyo3/pull/1421">#1421</a></li>
</ul>
<h3 id="新增-36"><a class="header" href="#新增-36">新增</a></h3>
<ul>
<li>添加不安全 API <code>with_embedded_python_interpreter</code>，用于初始化 Python 解释器、执行闭包并最终化解释器。<a href="https://github.com/PyO3/pyo3/pull/1355">#1355</a></li>
<li>添加 <code>serde</code> 功能，为 <code>Py&lt;T&gt;</code> 提供 <code>Serialize</code> 和 <code>Deserialize</code> 的实现。<a href="https://github.com/PyO3/pyo3/pull/1366">#1366</a></li>
<li>在 Python 3.7 及以上版本中添加 FFI 定义 <code>_PyCFunctionFastWithKeywords</code>。<a href="https://github.com/PyO3/pyo3/pull/1384">#1384</a></li>
<li>添加 <code>PyDateTime::new_with_fold</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/1398">#1398</a></li>
<li>为 <code>{PyDict, PyList, PySet, PyTuple}Iterator</code> 添加 <code>size_hint</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/1699">#1699</a></li>
</ul>
<h3 id="更改-19"><a class="header" href="#更改-19">更改</a></h3>
<ul>
<li><code>prepare_freethreaded_python</code> 将不再注册 <code>atexit</code> 处理程序来调用 <code>Py_Finalize</code>。这解决了因不兼容的 C 扩展在最终化时引发崩溃的问题。<a href="https://github.com/PyO3/pyo3/pull/1355">#1355</a></li>
<li>将 <code>PyLayout::py_init</code>、<code>PyClassDict::clear_dict</code> 和 <code>opt_to_pyobj</code> 标记为安全函数，因为它们不执行任何不安全操作。<a href="https://github.com/PyO3/pyo3/pull/1404">#1404</a></li>
</ul>
<h3 id="修复-33"><a class="header" href="#修复-33">修复</a></h3>
<ul>
<li>修复在 pyfunction 中使用 <code>r#raw_idents</code> 作为参数名的支持问题。<a href="https://github.com/PyO3/pyo3/pull/1383">#1383</a></li>
<li>修复 <code>PyFunction_GetCode</code> 的 FFI 定义中的拼写错误（之前错误地写成了 <code>PyFunction_Code</code>）。<a href="https://github.com/PyO3/pyo3/pull/1387">#1387</a></li>
<li>修复 FFI 定义 <code>PyMarshal_WriteObjectToString</code> 和 <code>PyMarshal_ReadObjectFromString</code>，使其在有限 API 中可用。<a href="https://github.com/PyO3/pyo3/pull/1387">#1387</a></li>
<li>修复 FFI 定义 <code>PyListObject</code> 以及来自 <code>funcobject.h</code> 的定义，使其需使用非有限 API。<a href="https://github.com/PyO3/pyo3/pull/1387">#1387</a></li>
<li>修复 <code>pyobject_native_type_base</code> 中未限定的 <code>Result</code> 使用。<a href="https://github.com/PyO3/pyo3/pull/1402">#1402</a></li>
<li>修复在默认 Python 编码不是 UTF-8 的系统上的构建问题。<a href="https://github.com/PyO3/pyo3/pull/1405">#1405</a></li>
<li>修复在 mingw / MSYS2 上的构建问题。<a href="https://github.com/PyO3/pyo3/pull/1423">#1423</a></li>
</ul>
<h2 id="0131---2021-01-10"><a class="header" href="#0131---2021-01-10">[0.13.1] - 2021-01-10</a></h2>
<h3 id="新增-37"><a class="header" href="#新增-37">新增</a></h3>
<ul>
<li>在 Python 3.9 及以上版本中，为 <code>abi3</code> 功能添加对 <code>#[pyclass(dict)]</code> 和 <code>#[pyclass(weakref)]</code> 的支持。<a href="https://github.com/PyO3/pyo3/pull/1342">#1342</a></li>
<li>为 Python 3.7 及以上版本添加 FFI 定义 <code>PyOS_BeforeFork</code>、<code>PyOS_AfterFork_Parent</code> 和 <code>PyOS_AfterFork_Child</code>。<a href="https://github.com/PyO3/pyo3/pull/1348">#1348</a></li>
<li>添加 <code>auto-initialize</code> 功能，用于控制 PyO3 是否应自动初始化嵌入式 Python 解释器。出于兼容性考虑，该功能在 PyO3 0.13.1 中默认启用，但从 PyO3 0.14.0 开始将改为选择性启用。<a href="https://github.com/PyO3/pyo3/pull/1347">#1347</a></li>
<li>添加对无需 <code>PYO3_CROSS_INCLUDE_DIR</code> 即可交叉编译到 Windows 的支持。<a href="https://github.com/PyO3/pyo3/pull/1350">#1350</a></li>
</ul>
<h3 id="已弃用"><a class="header" href="#已弃用">已弃用</a></h3>
<ul>
<li>在为 Python 3.9 构建时，弃用 FFI 定义 <code>PyEval_CallObjectWithKeywords</code>、<code>PyEval_CallObject</code>、<code>PyEval_CallFunction</code> 和 <code>PyEval_CallMethod</code>。<a href="https://github.com/PyO3/pyo3/pull/1338">#1338</a></li>
<li>弃用从未存在于 Python API 中的 FFI 定义 <code>PyGetSetDef_DICT</code> 和 <code>PyGetSetDef_INIT</code>。<a href="https://github.com/PyO3/pyo3/pull/1341">#1341</a></li>
<li>弃用 FFI 定义 <code>PyGen_NeedsFinalizing</code>、<code>PyImport_Cleanup</code>（已在 3.9 中移除）和 <code>PyOS_InitInterrupts</code>（3.10）。<a href="https://github.com/PyO3/pyo3/pull/1348">#1348</a></li>
<li>为 Python 3.7 及以上版本弃用 FFI 定义 <code>PyOS_AfterFork</code>。<a href="https://github.com/PyO3/pyo3/pull/1348">#1348</a></li>
<li>弃用 FFI 定义 <code>PyCoro_Check</code>、<code>PyAsyncGen_Check</code> 和 <code>PyCoroWrapper_Check</code>，这些从未出现在 Python API 中（对于前两个，可以使用 <code>PyCoro_CheckExact</code> 和 <code>PyAsyncGen_CheckExact</code> 替代；这些才是 Python API 实际提供的函数）。<a href="https://github.com/PyO3/pyo3/pull/1348">#1348</a></li>
<li>因 <a href="https://www.python.org/dev/peps/pep-0623/">PEP 623</a>，弃用将从 Python 3.12 及以上版本中移除的 <code>PyUnicode_FromUnicode</code>、<code>PyUnicode_AsUnicode</code> 和 <code>PyUnicode_AsUnicodeAndSize</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1370">#1370</a></li>
</ul>
<h3 id="已移除-5"><a class="header" href="#已移除-5">已移除</a></h3>
<ul>
<li>为 Python 3.9 构建时，移除 FFI 定义 <code>PyFrame_ClearFreeList</code>。<a href="https://github.com/PyO3/pyo3/pull/1341">#1341</a></li>
<li>为 Python 3.10 构建时，移除 FFI 定义 <code>_PyDict_Contains</code>。<a href="https://github.com/PyO3/pyo3/pull/1341">#1341</a></li>
<li>移除 FFI 定义 <code>PyGen_NeedsFinalizing</code> 和 <code>PyImport_Cleanup</code>（适用于 3.9 及以上），以及 <code>PyOS_InitInterrupts</code>（3.10）。<a href="https://github.com/PyO3/pyo3/pull/1348">#1348</a></li>
</ul>
<h3 id="修复-34"><a class="header" href="#修复-34">修复</a></h3>
<ul>
<li>当 Python 3.8 及以上版本中设置了 <code>Py_DEBUG</code> 时，不再自动包含 <code>Py_TRACE_REFS</code> 配置设置。<a href="https://github.com/PyO3/pyo3/pull/1334">#1334</a></li>
<li>移除 <code>#[deny(warnings)]</code> 属性（转而仅在 CI 中拒绝警告）。<a href="https://github.com/PyO3/pyo3/pull/1340">#1340</a></li>
<li>修复 <code>#[pyclass]</code> 中缺少 <code>__module__</code> 引发的弃用警告。<a href="https://github.com/PyO3/pyo3/pull/1343">#1343</a></li>
<li>将 <code>PyFrozenSet::empty</code> 的返回类型修正为 <code>&amp;PyFrozenSet</code>（之前错误地为 <code>&amp;PySet</code>）。<a href="https://github.com/PyO3/pyo3/pull/1351">#1351</a></li>
<li>修复在 3.8 以下版本 Python 中对堆类型对象缺少 <code>Py_INCREF</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/1365">#1365</a></li>
</ul>
<h2 id="0130---2020-12-22"><a class="header" href="#0130---2020-12-22">[0.13.0] - 2020-12-22</a></h2>
<h3 id="打包-28"><a class="header" href="#打包-28">打包</a></h3>
<ul>
<li>停止支持 Python 3.5（因其已停止维护）。<a href="https://github.com/PyO3/pyo3/pull/1250">#1250</a></li>
<li>将最低支持的 Rust 版本提升至 1.45。<a href="https://github.com/PyO3/pyo3/pull/1272">#1272</a></li>
<li>将 indoc 依赖版本提升至 1.0。<a href="https://github.com/PyO3/pyo3/pull/1272">#1272</a></li>
<li>将 paste 依赖版本提升至 1.0。<a href="https://github.com/PyO3/pyo3/pull/1272">#1272</a></li>
<li>将内部 crate <code>pyo3cls</code> 和 <code>pyo3-derive-backend</code> 重命名为 <code>pyo3-macros</code> 和 <code>pyo3-macros-backend</code>。<a href="https://github.com/PyO3/pyo3/pull/1317">#1317</a></li>
</ul>
<h3 id="新增-38"><a class="header" href="#新增-38">新增</a></h3>
<ul>
<li>添加对构建 CPython 有限 API 的支持。启用有限 API 后，使用 PyO3 构建的单一扩展 wheel 可安装到多个 Python 版本上。这需要对 PyO3 <code>#[pyclass]</code> 类型的运行时行为进行一些细微调整。详见迁移指南。<a href="https://github.com/PyO3/pyo3/pull/1152">#1152</a>
<ul>
<li>添加功能标志 <code>abi3-py36</code>、<code>abi3-py37</code>、<code>abi3-py38</code> 等，以在使用有限 API 时设定最低 Python 版本。<a href="https://github.com/PyO3/pyo3/pull/1263">#1263</a></li>
</ul>
</li>
<li>为 pymethod 包装器生成的 <code>TypeError</code> 消息添加参数名称。<a href="https://github.com/PyO3/pyo3/pull/1212">#1212</a></li>
<li>添加 PEP 587 “Python 初始化配置”的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1247">#1247</a></li>
<li>添加 <code>PyEval_SetProfile</code> 和 <code>PyEval_SetTrace</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1255">#1255</a></li>
<li>添加 context.h 函数的 FFI 定义（如 <code>PyContext_New</code> 等）。<a href="https://github.com/PyO3/pyo3/pull/1259">#1259</a></li>
<li>添加 <code>PyAny::is_instance</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/1276">#1276</a></li>
<li>添加 <code>char</code> 和 <code>PyString</code> 之间的转换支持。<a href="https://github.com/PyO3/pyo3/pull/1282">#1282</a></li>
<li>添加 <code>PyBuffer_SizeFromFormat</code>、<code>PyObject_LengthHint</code>、<code>PyObject_CallNoArgs</code>、<code>PyObject_CallOneArg</code>、<code>PyObject_CallMethodNoArgs</code>、<code>PyObject_CallMethodOneArg</code>、<code>PyObject_VectorcallDict</code> 和 <code>PyObject_VectorcallMethod</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1287">#1287</a></li>
<li>为 PyPy 添加 <code>u128</code>/<code>i128</code> 与 <code>PyLong</code> 之间的转换支持。<a href="https://github.com/PyO3/pyo3/pull/1310">#1310</a></li>
<li>添加 <code>Python::version</code> 和 <code>Python::version_info</code> 方法以获取运行中的解释器版本。<a href="https://github.com/PyO3/pyo3/pull/1322">#1322</a></li>
<li>添加对长度为 10、11 和 12 的元组的转换支持。<a href="https://github.com/PyO3/pyo3/pull/1454">#1454</a></li>
</ul>
<h3 id="更改-20"><a class="header" href="#更改-20">更改</a></h3>
<ul>
<li>将 <code>PyType::name</code> 的返回类型由 <code>Cow&lt;str&gt;</code> 改为 <code>PyResult&lt;&amp;str&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/1152">#1152</a></li>
<li>现在从 Rust 进行子类化时必须使用 <code>#[pyclass(subclass)]</code>（以前仅在从 Python 子类化时要求）。<a href="https://github.com/PyO3/pyo3/pull/1152">#1152</a></li>
<li>修改 <code>PyIterator</code> 以保持与其他原生类型的一致性：现在使用 <code>&amp;PyIterator</code> 而非 <code>PyIterator&lt;'a&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/1176">#1176</a></li>
<li>调整 <code>PyDowncastError</code> 消息的格式，使其更接近 Python 内置的错误消息。<a href="https://github.com/PyO3/pyo3/pull/1212">#1212</a></li>
<li>修改 <code>PyException</code> 的 <code>Debug</code> 和 <code>Display</code> 实现，使其与 <code>PyAny</code> 保持一致。<a href="https://github.com/PyO3/pyo3/pull/1275">#1275</a>- 更改 <code>PyErr</code> 的 <code>Debug</code> 实现以输出更有用的信息（如有必要，获取 GIL）。<a href="https://github.com/PyO3/pyo3/pull/1275">#1275</a></li>
<li>将 <code>PyTypeInfo::is_instance</code> 和 <code>PyTypeInfo::is_exact_instance</code> 重命名为 <code>PyTypeInfo::is_type_of</code> 和 <code>PyTypeInfo::is_exact_type_of</code>。<a href="https://github.com/PyO3/pyo3/pull/1278">#1278</a></li>
<li>在 Python 3.9 及以上版本中优化 <code>PyAny::call0</code>、<code>Py::call0</code>、<code>PyAny::call_method0</code> 和 <code>Py::call_method0</code>。<a href="https://github.com/PyO3/pyo3/pull/1285">#1287</a></li>
<li>要求 pyclass 的名称参数使用双引号，例如 <code>#[pyclass(name = "MyClass")]</code>。<a href="https://github.com/PyO3/pyo3/pull/1303">#1303</a></li>
</ul>
<h3 id="已弃用-1"><a class="header" href="#已弃用-1">已弃用</a></h3>
<ul>
<li>弃用 <code>Python::is_instance</code>、<code>Python::is_subclass</code>、<code>Python::release</code> 和 <code>Python::xdecref</code>。<a href="https://github.com/PyO3/pyo3/pull/1292">#1292</a></li>
</ul>
<h3 id="已移除-6"><a class="header" href="#已移除-6">已移除</a></h3>
<ul>
<li>移除已弃用的 FFI 定义 <code>PyUnicode_AsUnicodeCopy</code>、<code>PyUnicode_GetMax</code>、<code>_Py_CheckRecursionLimit</code>、<code>PyObject_AsCharBuffer</code>、<code>PyObject_AsReadBuffer</code>、<code>PyObject_CheckReadBuffer</code> 和 <code>PyObject_AsWriteBuffer</code>，这些将在 Python 3.10 中被移除。<a href="https://github.com/PyO3/pyo3/pull/1217">#1217</a></li>
<li>移除未使用的 <code>python3</code> 功能。<a href="https://github.com/PyO3/pyo3/pull/1235">#1235</a></li>
</ul>
<h3 id="修复-35"><a class="header" href="#修复-35">修复</a></h3>
<ul>
<li>修复 <code>PyCodeObject</code> 结构体中缺失的字段（<code>co_posonlyargcount</code>），该问题在 Python &gt;3.7 中导致其他字段访问无效。<a href="https://github.com/PyO3/pyo3/pull/1260">#1260</a></li>
<li>修复从 <code>x86_64-unknown-linux-gnu</code> 主机向 <code>x86_64-unknown-linux-musl</code> 目标构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1267">#1267</a></li>
<li>修复 <code>#[text_signature]</code> 与 Rust 的 <code>r#raw_identifiers</code> 不兼容的问题。<a href="https://github.com/PyO3/pyo3/pull/1286">#1286</a></li>
<li>修复 <code>PyObject_Vectorcall</code> 和 <code>PyVectorcall_Call</code> 的 FFI 定义。<a href="https://github.com/PyO3/pyo3/pull/1285">#1287</a></li>
<li>修复在 virtualenv 中使用 Anaconda Python 构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1290">#1290</a></li>
<li>修复不透明 FFI 类型的定义。<a href="https://github.com/PyO3/pyo3/pull/1312">#1312</a></li>
<li>修复在 pyclass 的 <code>#[new]</code> 方法中使用自定义错误类型的问题。<a href="https://github.com/PyO3/pyo3/pull/1319">#1319</a></li>
</ul>
<h2 id="0124---2020-11-28"><a class="header" href="#0124---2020-11-28">[0.12.4] - 2020-11-28</a></h2>
<h3 id="修复-36"><a class="header" href="#修复-36">修复</a></h3>
<ul>
<li>修复 <code>From&lt;Py&lt;T&gt;&gt;</code> for <code>PyObject</code> 实现中的引用计数错误，此问题是 PyO3 0.12 版本引入的回归问题。<a href="https://github.com/PyO3/pyo3/pull/1297">#1297</a></li>
</ul>
<h2 id="0123---2020-10-12"><a class="header" href="#0123---2020-10-12">[0.12.3] - 2020-10-12</a></h2>
<h3 id="修复-37"><a class="header" href="#修复-37">修复</a></h3>
<ul>
<li>修复因在 PyO3 0.12.2 中错误地内部更新到 paste 1.0 而导致的 Rust 1.39 至 1.44 版本支持问题。<a href="https://github.com/PyO3/pyo3/pull/1234">#1234</a></li>
</ul>
<h2 id="0122---2020-10-12"><a class="header" href="#0122---2020-10-12">[0.12.2] - 2020-10-12</a></h2>
<h3 id="新增-39"><a class="header" href="#新增-39">新增</a></h3>
<ul>
<li>在 <code>#[pyfunction]</code> 中支持无默认值的关键字限定参数。<a href="https://github.com/PyO3/pyo3/pull/1209">#1209</a></li>
<li>添加 <code>Python::check_signals</code>，作为 <code>PyErr_CheckSignals</code> 的安全包装器。<a href="https://github.com/PyO3/pyo3/pull/1214">#1214</a></li>
</ul>
<h3 id="修复-38"><a class="header" href="#修复-38">修复</a></h3>
<ul>
<li>修复协议方法文档不正确的问题。<a href="https://github.com/PyO3/pyo3/pull/1169">#1169</a></li>
<li>隐藏 <code>pyo3::class::methods</code> 中 PyO3 私有实现细节的文档。<a href="https://github.com/PyO3/pyo3/pull/1169">#1169</a></li>
<li>修复当 Python 解释器由 PYO3_PYTHON 提供时，PATH 变化导致不必要的重新构建问题。<a href="https://github.com/PyO3/pyo3/pull/1231">#1231</a></li>
</ul>
<h2 id="0121---2020-09-16"><a class="header" href="#0121---2020-09-16">[0.12.1] - 2020-09-16</a></h2>
<h3 id="修复-39"><a class="header" href="#修复-39">修复</a></h3>
<ul>
<li>修复在 64 位 Windows 上使用 64 位 Rust 工具链为 32 位 Python 构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1179">#1179</a></li>
<li>修复在 <code>c_char</code> 为 <code>u8</code> 的平台上构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1182">#1182</a></li>
</ul>
<h2 id="0120---2020-09-12"><a class="header" href="#0120---2020-09-12">[0.12.0] - 2020-09-12</a></h2>
<h3 id="新增-40"><a class="header" href="#新增-40">新增</a></h3>
<ul>
<li>添加 FFI 定义 <code>Py_FinalizeEx</code>、<code>PyOS_getsig</code> 和 <code>PyOS_setsig</code>。<a href="https://github.com/PyO3/pyo3/pull/1021">#1021</a></li>
<li>添加 <code>PyString::to_str</code> 以将 <code>PyString</code> 作为 <code>&amp;str</code> 访问。<a href="https://github.com/PyO3/pyo3/pull/1023">#1023</a></li>
<li>添加 <code>Python::with_gil</code>，用于在持有 Python GIL 的情况下执行闭包。<a href="https://github.com/PyO3/pyo3/pull/1037">#1037</a></li>
<li>在 <code>PyAny::downcast</code> 中添加类型信息到失败信息中。<a href="https://github.com/PyO3/pyo3/pull/1050">#1050</a></li>
<li>为 <code>PyIterator</code> 实现 <code>Debug</code>。<a href="https://github.com/PyO3/pyo3/pull/1051">#1051</a></li>
<li>添加 <code>PyBytes::new_with</code> 和 <code>PyByteArray::new_with</code>，用于通过闭包初始化 <code>bytes</code> 和 <code>bytearray</code> 对象。<a href="https://github.com/PyO3/pyo3/pull/1074">#1074</a></li>
<li>添加用于枚举和结构体的 <code>#[derive(FromPyObject)]</code> 宏。<a href="https://github.com/PyO3/pyo3/pull/1065">#1065</a></li>
<li>添加 <code>Py::as_ref</code> 和 <code>Py::into_ref</code>，用于将 <code>Py&lt;T&gt;</code> 转换为 <code>&amp;T</code>。<a href="https://github.com/PyO3/pyo3/pull/1098">#1098</a></li>
<li>添加从 <code>#[pyfunction]</code>、<code>#[pymethod]</code> 和 <code>#[pyproto]</code> 函数返回除 <code>PyResult</code> 之外的 <code>Result</code> 类型的能力。<a href="https://github.com/PyO3/pyo3/pull/1118">#1106</a></li>
<li>为 <a href="https://crates.io/crates/hashbrown">hashbrown</a> 的 <code>HashMap</code> 和 <code>HashSet</code> 类型实现 <code>ToPyObject</code>、<code>IntoPy</code> 和 <code>FromPyObject</code>（需要 <code>hashbrown</code> 功能）。<a href="https://github.com/PyO3/pyo3/pull/1114">#1114</a></li>
<li>添加 <code>#[pyfunction(pass_module)]</code> 和 <code>#[pyfn(pass_module)]</code>，以便将模块对象作为第一个函数参数传递。<a href="https://github.com/PyO3/pyo3/pull/1143">#1143</a></li>
<li>添加 <code>PyModule::add_function</code> 和 <code>PyModule::add_submodule</code>，作为 <code>PyModule::add_wrapped</code> 的类型安全替代方案。<a href="https://github.com/PyO3/pyo3/pull/1143">#1143</a></li>
<li>添加原生的 <code>PyCFunction</code> 和 <code>PyFunction</code> 类型。<a href="https://github.com/PyO3/pyo3/pull/1163">#1163</a></li>
</ul>
<h3 id="变更-12"><a class="header" href="#变更-12">变更</a></h3>
<ul>
<li>重构异常类型：<a href="https://github.com/PyO3/pyo3/pull/1024">#1024</a> <a href="https://github.com/PyO3/pyo3/pull/1115">#1115</a>
<ul>
<li>将异常类型从例如 <code>RuntimeError</code> 重命名为 <code>PyRuntimeError</code>。旧名称仍存在但已被弃用。</li>
<li>异常对象现在可以像其他 Python 原生类型一样作为 <code>&amp;T</code> 或 <code>Py&lt;T&gt;</code> 访问。</li>
<li>将 <code>PyException::py_err</code> 重命名为 <code>PyException::new_err</code>。</li>
<li>将 <code>PyUnicodeDecodeErr::new_err</code> 重命名为 <code>PyUnicodeDecodeErr::new</code>。</li>
<li>移除 <code>PyStopIteration::stop_iteration</code>。</li>
</ul>
</li>
<li>要求 <code>Python::allow_threads</code> 的返回值 <code>T</code> 满足 <code>T: Send</code>。<a href="https://github.com/PyO3/pyo3/pull/1036">#1036</a></li>
<li>将 <code>PYTHON_SYS_EXECUTABLE</code> 重命名为 <code>PYO3_PYTHON</code>。旧名称会继续工作（无文档），但将在未来版本中移除。<a href="https://github.com/PyO3/pyo3/pull/1039">#1039</a></li>
<li>从 <code>PyType::as_type_ptr</code> 的签名中移除 <code>unsafe</code>。<a href="https://github.com/PyO3/pyo3/pull/1047">#1047</a></li>
<li>将 <code>PyIterator::from_object</code> 的返回类型改为 <code>PyResult&lt;PyIterator&gt;</code>（原来是 <code>Result&lt;PyIterator, PyDowncastError&gt;</code>）。<a href="https://github.com/PyO3/pyo3/pull/1051">#1051</a></li>
<li><code>IntoPy</code> 不再由 <code>FromPy</code> 隐式提供。<a href="https://github.com/PyO3/pyo3/pull/1063">#1063</a></li>
<li>将 <code>PyObject</code> 更改为 <code>Py&lt;PyAny&gt;</code> 的类型别名。<a href="https://github.com/PyO3/pyo3/pull/1063">#1063</a></li>
<li>重构 <code>PyErr</code> 以兼容 <code>std::error::Error</code> trait：<a href="https://github.com/PyO3/pyo3/pull/1067">#1067</a> <a href="https://github.com/PyO3/pyo3/pull/1115">#1115</a>
<ul>
<li>为 <code>PyErr</code> 和 <code>PyErrArguments</code> 实现 <code>Display</code>、<code>Error</code>、<code>Send</code> 和 <code>Sync</code>。</li>
<li>添加 <code>PyErr::instance</code> 以将 <code>PyErr</code> 作为 <code>&amp;PyBaseException</code> 访问。</li>
<li><code>PyErr</code> 的字段现在是实现细节，可通过 <code>PyErr::ptype</code>、<code>PyErr::pvalue</code> 和 <code>PyErr::ptraceback</code> 访问等价值。</li>
<li>将 <code>PyErr::print</code> 和 <code>PyErr::print_and_set_sys_last_vars</code> 的接收器改为 <code>&amp;self</code>（原为 <code>self</code>）。</li>
<li>移除 <code>PyErrValue</code>、<code>PyErr::from_value</code>、<code>PyErr::into_normalized</code> 和 <code>PyErr::normalize</code>。</li>
<li>移除 <code>PyException::into</code>。</li>
<li>移除 <code>PyErr</code> 和 <code>PyException</code> 的 <code>Into&lt;PyResult&lt;T&gt;&gt;</code>。</li>
</ul>
</li>
<li>更改由 <code>#[pyproto]</code> 生成的方法，使其在 Python 应尝试反向操作时返回 <code>NotImplemented</code>。<a href="https://github.com/PyO3/pyo3/pull/1072">#1072</a></li>
<li>将 <code>PyModule::add</code> 的参数更改为 <code>impl IntoPy&lt;PyObject&gt;</code>（原为 <code>impl ToPyObject</code>）。<a href="https://github.com/PyO3/pyo3/pull/1124">#1124</a></li>
</ul>
<h3 id="已移除-7"><a class="header" href="#已移除-7">已移除</a></h3>
<ul>
<li>移除许多异常和 <code>PyErr</code> 的 API；请参阅上方“变更”部分。<a href="https://github.com/PyO3/pyo3/pull/1024">#1024</a> <a href="https://github.com/PyO3/pyo3/pull/1067">#1067</a> <a href="https://github.com/PyO3/pyo3/pull/1115">#1115</a></li>
<li>移除 <code>PyString::to_string</code>（使用新的 <code>PyString::to_str</code>）。<a href="https://github.com/PyO3/pyo3/pull/1023">#1023</a></li>
<li>移除 <code>PyString::as_bytes</code>。<a href="https://github.com/PyO3/pyo3/pull/1023">#1023</a></li>
<li>移除 <code>Python::register_any</code>。<a href="https://github.com/PyO3/pyo3/pull/1023">#1023</a></li>
<li>从公共 API 中移除 <code>GILGuard::acquire</code>。请使用 <code>Python::acquire_gil</code> 或 <code>Python::with_gil</code>。<a href="https://github.com/PyO3/pyo3/pull/1036">#1036</a></li>
<li>移除 <code>FromPy</code> trait。<a href="https://github.com/PyO3/pyo3/pull/1063">#1063</a></li>
<li>移除 <code>AsPyRef</code> trait。<a href="https://github.com/PyO3/pyo3/pull/1098">#1098</a></li>
</ul>
<h3 id="修复-40"><a class="header" href="#修复-40">修复</a></h3>
<ul>
<li>修正 FFI 定义 <code>Py_SetProgramName</code> 和 <code>Py_SetPythonHome</code> 的参数为 <code>*const</code>（原为 <code>*mut</code>）。<a href="https://github.com/PyO3/pyo3/pull/1021">#1021</a></li>
<li>修复 <code>FromPyObject</code> 对 <code>num_bigint::BigInt</code> 在具有 <code>__index__</code> 方法的 Python 对象上的使用。<a href="https://github.com/PyO3/pyo3/pull/1027">#1027</a></li>
<li>修正 FFI 定义 <code>_PyLong_AsByteArray</code> 的参数为 <code>*mut c_uchar</code>（原为 <code>*const c_uchar</code>）。<a href="https://github.com/PyO3/pyo3/pull/1029">#1029</a></li>
<li>修复 <code>#[pyclass(dict, unsendable)]</code> 导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/1058">#1058</a> <a href="https://github.com/PyO3/pyo3/pull/1059">#1059</a></li>
<li>修复在 <code>#[pymethods]</code> 块中将 <code>&amp;Self</code> 用作函数参数类型的问题。<a href="https://github.com/PyO3/pyo3/pull/1071">#1071</a></li>
<li>修复尽力支持针对 PyPy 3.6 的构建。<a href="https://github.com/PyO3/pyo3/pull/1092">#1092</a></li>
<li>修复 <code>#[pyproto]</code> 实现中的许多生命周期省略问题。<a href="https://github.com/PyO3/pyo3/pull/1093">#1093</a></li>
<li>修复交叉编译时 Python 构建配置的检测问题。<a href="https://github.com/PyO3/pyo3/pull/1095">#1095</a></li>
<li>在使用 <code>extension-module</code> 功能时，始终在 Android 上链接 libpython。<a href="https://github.com/PyO3/pyo3/pull/1095">#1095</a></li>
<li>修复 <code>+</code> 操作符在 <code>PyNumberProtocol</code> 中同时定义 <code>__add__</code> 和 <code>__radd__</code> 时不会尝试 <code>__radd__</code> 的问题（其他可逆操作符同理）。<a href="https://github.com/PyO3/pyo3/pull/1107">#1107</a></li>
<li>修复使用 Anaconda Python 构建的问题。<a href="https://github.com/PyO3/pyo3/pull/1175">#1175</a></li>
</ul>
<h2 id="0111---2020-06-30"><a class="header" href="#0111---2020-06-30">[0.11.1] - 2020-06-30</a></h2>
<h3 id="新增--pyclassunsendable1009"><a class="header" href="#新增--pyclassunsendable1009">新增- <code>#[pyclass(unsendable)]</code>。<a href="https://github.com/PyO3/pyo3/pull/1009">#1009</a></a></h3>
<h3 id="变更-13"><a class="header" href="#变更-13">变更</a></h3>
<ul>
<li>将 <code>parking_lot</code> 依赖项更新至 <code>0.11</code>。<a href="https://github.com/PyO3/pyo3/pull/1010">#1010</a></li>
</ul>
<h2 id="0110---2020-06-28"><a class="header" href="#0110---2020-06-28">[0.11.0] - 2020-06-28</a></h2>
<h3 id="新增-41"><a class="header" href="#新增-41">新增</a></h3>
<ul>
<li>支持稳定的 Rust 版本（&gt;=1.39）。<a href="https://github.com/PyO3/pyo3/pull/969">#969</a></li>
<li>添加 FFI 定义 <code>PyObject_AsFileDescriptor</code>。<a href="https://github.com/PyO3/pyo3/pull/938">#938</a></li>
<li>添加 <code>PyByteArray::data</code>、<code>PyByteArray::as_bytes</code> 和 <code>PyByteArray::as_bytes_mut</code>。<a href="https://github.com/PyO3/pyo3/pull/967">#967</a></li>
<li>添加 <code>GILOnceCell</code>，用于 <code>lazy_static</code> 或 <code>once_cell</code> 可能发生死锁的场景。<a href="https://github.com/PyO3/pyo3/pull/975">#975</a></li>
<li>为访问 <code>#[pyclass]</code> 值，添加 <code>Py::borrow</code>、<code>Py::borrow_mut</code>、<code>Py::try_borrow</code> 和 <code>Py::try_borrow_mut</code>。<a href="https://github.com/PyO3/pyo3/pull/976">#976</a></li>
<li>添加 <code>IterNextOutput</code> 和 <code>IterANextOutput</code>，用于从 <code>__next__</code> / <code>__anext__</code> 返回。<a href="https://github.com/PyO3/pyo3/pull/997">#997</a></li>
</ul>
<h3 id="变更-14"><a class="header" href="#变更-14">变更</a></h3>
<ul>
<li>简化 <code>#[pyo3(get)]</code> 属性的内部实现。（删除隐藏 API <code>GetPropertyValue</code>。）<a href="https://github.com/PyO3/pyo3/pull/934">#934</a></li>
<li>退出时调用 <code>Py_Finalize</code> 以刷新缓冲区等。<a href="https://github.com/PyO3/pyo3/pull/943">#943</a></li>
<li>为 <code>PyBuffer</code> 添加类型参数。<a href="https://github.com/PyO3/pyo3/pull/951">#951</a></li>
<li>为 <code>#[pyclass]</code> 要求 <code>Send</code> bound。<a href="https://github.com/PyO3/pyo3/pull/966">#966</a></li>
<li>为 <code>PyObject</code> 和 <code>Py&lt;T&gt;</code> 的大多数方法添加 <code>Python</code> 参数，以确保 GIL 安全。<a href="https://github.com/PyO3/pyo3/pull/970">#970</a></li>
<li>更改 <code>PyTypeObject::type_object</code> 的签名——现在接受 <code>Python</code> 参数并返回 <code>&amp;PyType</code>。<a href="https://github.com/PyO3/pyo3/pull/970">#970</a></li>
<li>将 <code>PyTuple::slice</code> 和 <code>PyTuple::split_from</code> 的返回类型从 <code>Py&lt;PyTuple&gt;</code> 更改为 <code>&amp;PyTuple</code>。<a href="https://github.com/PyO3/pyo3/pull/970">#970</a></li>
<li>将 <code>PyTuple::as_slice</code> 的返回类型更改为 <code>&amp;[&amp;PyAny]</code>。<a href="https://github.com/PyO3/pyo3/pull/971">#971</a></li>
<li>将 <code>PyTypeInfo::type_object</code> 重命名为 <code>type_object_raw</code>，并添加 <code>Python</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/975">#975</a></li>
<li>将 <code>num-complex</code> 可选依赖项从 <code>0.2</code> 更新至 <code>0.3</code>。<a href="https://github.com/PyO3/pyo3/pull/977">#977</a></li>
<li>将 <code>num-bigint</code> 可选依赖项从 <code>0.2</code> 更新至 <code>0.3</code>。<a href="https://github.com/PyO3/pyo3/pull/978">#978</a></li>
<li><code>#[pyproto]</code> 重新实现，不再使用特化。<a href="https://github.com/PyO3/pyo3/pull/961">#961</a></li>
<li>将 <code>PyClassAlloc::alloc</code> 重命名为 <code>PyClassAlloc::new</code>。<a href="https://github.com/PyO3/pyo3/pull/990">#990</a></li>
<li><code>#[pyproto]</code> 方法现在可返回 <code>T</code> 或 <code>PyResult&lt;T&gt;</code>（此前仅支持 <code>PyResult&lt;T&gt;</code>）。<a href="https://github.com/PyO3/pyo3/pull/996">#996</a></li>
<li>若返回类型为 <code>()</code>，<code>#[pyproto]</code> 方法现在可省略返回类型的注解。<a href="https://github.com/PyO3/pyo3/pull/998">#998</a></li>
</ul>
<h3 id="移除-8"><a class="header" href="#移除-8">移除</a></h3>
<ul>
<li>移除 <code>ManagedPyRef</code>（未使用，且需要特化）<a href="https://github.com/PyO3/pyo3/pull/930">#930</a></li>
</ul>
<h3 id="修复-41"><a class="header" href="#修复-41">修复</a></h3>
<ul>
<li>修复向带有默认值的 <code>#[pyfunction]</code> 中的 <code>Option&lt;T&gt;</code> 参数显式传递 <code>None</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/936">#936</a></li>
<li>修复 <code>PyClass.__new__</code> 在 Python 类继承时未能正确处理子类的问题。<a href="https://github.com/PyO3/pyo3/pull/990">#990</a></li>
<li>修复从 <code>#[pyproto]</code> 方法返回 <code>Option&lt;T&gt;</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/996">#996</a></li>
<li>修复 <code>#[getter]</code> 和 <code>#[setter]</code> 方法接受 <code>PyRef&lt;Self&gt;</code> 和 <code>PyRefMut&lt;Self&gt;</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/999">#999</a></li>
</ul>
<h2 id="0101---2020-05-14"><a class="header" href="#0101---2020-05-14">[0.10.1] - 2020-05-14</a></h2>
<h3 id="修复-42"><a class="header" href="#修复-42">修复</a></h3>
<ul>
<li>修复在丢弃 <code>PyObject</code> 或 <code>Py&lt;T&gt;</code> 后调用 <code>Python::acquire_gil</code> 时的死锁问题。<a href="https://github.com/PyO3/pyo3/pull/924">#924</a></li>
</ul>
<h2 id="0100---2020-05-13"><a class="header" href="#0100---2020-05-13">[0.10.0] - 2020-05-13</a></h2>
<h3 id="新增-42"><a class="header" href="#新增-42">新增</a></h3>
<ul>
<li>添加 FFI 定义 <code>_PyDict_NewPresized</code>。<a href="https://github.com/PyO3/pyo3/pull/849">#849</a></li>
<li>为 <code>HashSet</code> 和 <code>BTreeSet</code> 实现 <code>IntoPy&lt;PyObject&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/864">#864</a></li>
<li>添加 <code>PyAny::dir</code> 方法。<a href="https://github.com/PyO3/pyo3/pull/886">#886</a></li>
<li>将宏置于 <code>macros</code> 功能下（默认启用）。<a href="https://github.com/PyO3/pyo3/pull/897">#897</a></li>
<li>在 <code>#[pymethods]</code> 中使用 <code>#[classattr]</code> 函数定义类属性。<a href="https://github.com/PyO3/pyo3/pull/905">#905</a></li>
<li>为 <code>PyObject</code> 和 <code>Py&lt;T&gt;</code> 实现 <code>Clone</code>。<a href="https://github.com/PyO3/pyo3/pull/908">#908</a></li>
<li>为所有内置类型（<code>PyList</code>、<code>PyTuple</code>、<code>PyDict</code> 等）实现 <code>Deref&lt;Target = PyAny&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/911">#911</a></li>
<li>为 <code>PyCell&lt;T&gt;</code> 实现 <code>Deref&lt;Target = PyAny&gt;</code>。<a href="https://github.com/PyO3/pyo3/pull/911">#911</a></li>
<li>在 <code>#[pymethods]</code> 中的关联常量上支持 <code>#[classattr]</code>。<a href="https://github.com/PyO3/pyo3/pull/914">#914</a></li>
</ul>
<h3 id="变更-15"><a class="header" href="#变更-15">变更</a></h3>
<ul>
<li>现在，恐慌（panics）将作为 Python 的 <code>PanicException</code> 被抛出。<a href="https://github.com/PyO3/pyo3/pull/797">#797</a></li>
<li>更改 <code>PyObject</code> 和 <code>Py&lt;T&gt;</code> 的引用计数行为，当持有 GIL 时，立即在 <code>drop</code> 时递减。<a href="https://github.com/PyO3/pyo3/pull/851">#851</a></li>
<li>允许 <code>PyIterProtocol</code> 方法使用 <code>PyRef</code> 或 <code>PyRefMut</code> 作为接收器类型。<a href="https://github.com/PyO3/pyo3/pull/856">#856</a></li>
<li>更改 <code>FromPyObject</code> 对 <code>Py&lt;T&gt;</code> 的实现，以适用于更广泛的 <code>T</code>，包括所有 <code>T: PyClass</code>。<a href="https://github.com/PyO3/pyo3/pull/880">#880</a></li>
<li>将 <code>ObjectProtocol</code> trait 的所有方法移至 <code>PyAny</code> 结构体。<a href="https://github.com/PyO3/pyo3/pull/911">#911</a></li>
<li>移除依赖 PyO3 的 crate 中对 <code>#![feature(specialization)]</code> 的需求。<a href="https://github.com/PyO3/pyo3/pull/917">#917</a></li>
</ul>
<h3 id="移除-9"><a class="header" href="#移除-9">移除</a></h3>
<ul>
<li>移除 <code>PyMethodsProtocol</code> trait。<a href="https://github.com/PyO3/pyo3/pull/889">#889</a></li>
<li>移除 <code>num-traits</code> 依赖。<a href="https://github.com/PyO3/pyo3/pull/895">#895</a></li>
<li>移除 <code>ObjectProtocol</code> trait。<a href="https://github.com/PyO3/pyo3/pull/911">#911</a></li>
<li>移除 <code>PyAny::None</code>。用户应改用 <code>Python::None</code>。<a href="https://github.com/PyO3/pyo3/pull/911">#911</a></li>
<li>移除所有 <code>*ProtocolImpl</code> traits。<a href="https://github.com/PyO3/pyo3/pull/917">#917</a></li>
</ul>
<h3 id="修复-43"><a class="header" href="#修复-43">修复</a></h3>
<ul>
<li>修复 <code>__radd__</code> 及其他 <code>__r*__</code> 方法作为 Python 数学运算符实现的支持。<a href="https://github.com/PyO3/pyo3/pull/839">#839</a></li>
<li>修复在垃圾回收期间遍历已被可变借用的对象时发生的恐慌。<a href="https://github.com/PyO3/pyo3/pull/855">#855</a></li>
<li>防止在 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 中将 <code>&amp;'static</code> 引用作为 Python 对象参数。<a href="https://github.com/PyO3/pyo3/pull/869">#869</a></li>
<li>修复 <code>AsPyRef::as_ref</code> 的生命周期安全漏洞。<a href="https://github.com/PyO3/pyo3/pull/876">#876</a></li>
<li>修复作用于 <code>Py&lt;T&gt;</code> 字段的 <code>#[pyo3(get)]</code> 属性。<a href="https://github.com/PyO3/pyo3/pull/880">#880</a></li>
<li>修复因 <code>PyList::get_item</code> 等函数在不安全的情况下返回借用对象而引起的段错误。<a href="https://github.com/PyO3/pyo3/pull/890">#890</a></li>
<li>修复嵌套调用 <code>Python::acquire_gil</code> 产生悬垂引用导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/893">#893</a></li>
<li>修复在调用 <code>Python::allow_threads</code> 期间发生恐慌导致的段错误。<a href="https://github.com/PyO3/pyo3/pull/912">#912</a></li>
</ul>
<h2 id="092---2020-04-09"><a class="header" href="#092---2020-04-09">[0.9.2] - 2020-04-09</a></h2>
<h3 id="新增-43"><a class="header" href="#新增-43">新增</a></h3>
<ul>
<li>为 <code>HashSet</code> 和 <code>BTreeSet</code> 添加 <code>FromPyObject</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/842">#842</a></li>
</ul>
<h3 id="修复-44"><a class="header" href="#修复-44">修复</a></h3>
<ul>
<li>正确检测 32 位架构。<a href="https://github.com/PyO3/pyo3/pull/830">#830</a></li>
</ul>
<h2 id="091---2020-03-23"><a class="header" href="#091---2020-03-23">[0.9.1] - 2020-03-23</a></h2>
<h3 id="修复-45"><a class="header" href="#修复-45">修复</a></h3>
<ul>
<li><code>#[pyclass]</code> 的错误消息。<a href="https://github.com/PyO3/pyo3/pull/826">#826</a></li>
<li><code>PySequence</code> 的 <code>FromPyObject</code> 实现。<a href="https://github.com/PyO3/pyo3/pull/827">#827</a></li>
</ul>
<h2 id="090---2020-03-19"><a class="header" href="#090---2020-03-19">[0.9.0] - 2020-03-19</a></h2>
<h3 id="新增-44"><a class="header" href="#新增-44">新增</a></h3>
<ul>
<li><code>PyCell</code>，具有类似 <code>RefCell</code> 的功能。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li><code>PyClass</code>、<code>PyLayout</code>、<code>PyClassInitializer</code>。<a href="https://github.com/PyO3/pyo3/pull/683">#683</a></li>
<li>为 <code>PySet</code> 和 <code>PyFrozenSet</code> 实现 <code>IntoIterator</code>。<a href="https://github.com/PyO3/pyo3/pull/716">#716</a></li>
<li>现在，对于实现 <code>Clone</code> 的 pyclass <code>T</code>，自动实现 <code>FromPyObject</code>。<a href="https://github.com/PyO3/pyo3/pull/730">#730</a></li>
<li><code>#[pyo3(get)]</code> 和 <code>#[pyo3(set)]</code> 现在会使用字段的 Rust 文档注释作为 Python 属性的文档。<a href="https://github.com/PyO3/pyo3/pull/755">#755</a></li>
<li><code>#[setter]</code> 函数现在可以接受 <code>Pyo3::Python</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/760">#760</a></li>
<li><code>PyTypeInfo::BaseLayout</code> 和 <code>PyClass::BaseNativeType</code>。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li><code>PyDowncastImpl</code>。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li>为数组（最多 32 个）实现 <code>FromPyObject</code> 和 <code>IntoPy&lt;PyObject&gt;</code> traits。<a href="https://github.com/PyO3/pyo3/pull/778">#778</a></li>
<li>指南中添加了 <code>migration.md</code> 和 <code>types.md</code>。<a href="https://github.com/PyO3/pyo3/pull/795">#795</a>，<a href="https://github.com/PyO3/pyo3/pull/802">#802</a></li>
<li><code>ffi::{_PyBytes_Resize, _PyDict_Next, _PyDict_Contains, _PyDict_GetDictPtr}</code>。<a href="https://github.com/PyO3/pyo3/pull/820">#820</a></li>
</ul>
<h3 id="变更-16"><a class="header" href="#变更-16">变更</a></h3>
<ul>
<li><code>#[new]</code> 不再接收 <code>PyRawObject</code>，且可直接返回 <code>Self</code>。<a href="https://github.com/PyO3/pyo3/pull/683">#683</a></li>
<li><code>FromPyObject</code> 对 <code>&amp;T</code> 和 <code>&amp;mut T</code> 的泛型实现不再可特化。请为您的类型实现 <code>PyTryFrom</code>，以控制 <code>FromPyObject::extract</code> 的行为。<a href="https://github.com/PyO3/pyo3/pull/713">#713</a></li>
<li><code>IntoPy&lt;U&gt; for T</code>（当 <code>U: FromPy&lt;T&gt;</code> 时）的实现不再可特化。通过 <code>FromPy</code> 的实现来控制该行为。<a href="https://github.com/PyO3/pyo3/pull/713">#713</a></li>
<li>使用 <code>parking_lot::Mutex</code> 替代 <code>spin::Mutex</code>。<a href="https://github.com/PyO3/pyo3/pull/734">#734</a></li>
<li>将最低 Rust 版本提升至 <code>1.42.0-nightly 2020-01-21</code>。<a href="https://github.com/PyO3/pyo3/pull/761">#761</a></li>
<li><code>PyRef</code> 和 <code>PyRefMut</code> 为 <code>PyCell</code> 重新设计。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li>为 Python 3.8 添加了一些新的 FFI 函数。<a href="https://github.com/PyO3/pyo3/pull/784">#784</a></li>
<li><code>PyAny</code> 现在位于顶层模块和 prelude 中。<a href="https://github.com/PyO3/pyo3/pull/816">#816</a></li>
</ul>
<h3 id="移除-10"><a class="header" href="#移除-10">移除</a></h3>
<ul>
<li><code>PyRawObject</code>。<a href="https://github.com/PyO3/pyo3/pull/683">#683</a></li>
<li><code>PyNoArgsFunction</code>。<a href="https://github.com/PyO3/pyo3/pull/741">#741</a>- <code>initialize_type</code>。要为 <code>#[pyclass]</code> 设置模块名，请在宏中使用 <code>module</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/751">#751</a></li>
<li><code>AsPyRef::as_mut/with/with_mut/into_py/into_mut_py</code>。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li><code>PyTryFrom::try_from_mut/try_from_mut_exact/try_from_mut_unchecked</code>。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li><code>Python::mut_from_owned_ptr/mut_from_borrowed_ptr</code>。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
<li><code>ObjectProtocol::get_base/get_mut_base</code>。<a href="https://github.com/PyO3/pyo3/pull/770">#770</a></li>
</ul>
<h3 id="已修复-17"><a class="header" href="#已修复-17">已修复</a></h3>
<ul>
<li>修复了子类化的不安全问题。<a href="https://github.com/PyO3/pyo3/pull/683">#683</a></li>
<li>当异常在 Rust 侧被处理时，清除错误指示器。<a href="https://github.com/PyO3/pyo3/pull/719">#719</a></li>
<li>在 <code>#[pyo3(set)]</code> 中使用原始标识符的问题。<a href="https://github.com/PyO3/pyo3/pull/745">#745</a></li>
<li>在 <code>#[pyo3(get)]</code> 中使用 <code>PyObject</code> 的问题。<a href="https://github.com/PyO3/pyo3/pull/760">#760</a></li>
<li><code>#[pymethods]</code> 与 <code>#[cfg]</code> 一起使用的问题。<a href="https://github.com/PyO3/pyo3/pull/769">#769</a></li>
<li><code>#[pyfunction()]</code> 参数列表中的 <code>"*"</code> 错误地接受任意数量的位置参数（如需此行为，请使用 <code>args = "*"</code>）。<a href="https://github.com/PyO3/pyo3/pull/792">#792</a></li>
<li><code>PyModule::dict</code>。<a href="https://github.com/PyO3/pyo3/pull/809">#809</a></li>
<li>修复 <code>DESCRIPTION</code> 未以 null 结尾的情况。<a href="https://github.com/PyO3/pyo3/pull/822">#822</a></li>
</ul>
<h2 id="085---2020-01-05"><a class="header" href="#085---2020-01-05">[0.8.5] - 2020-01-05</a></h2>
<h3 id="新增-45"><a class="header" href="#新增-45">新增</a></h3>
<ul>
<li>为 <code>HashMap</code> 和 <code>BTreeMap</code> 实现 <code>FromPyObject</code></li>
<li>支持 <code>#[pyfunction]</code> 和 <code>#[pymethods]</code> 中的 <code>#[name = "foo"]</code> 属性。<a href="https://github.com/PyO3/pyo3/pull/692">#692</a></li>
</ul>
<h2 id="084---2019-12-14"><a class="header" href="#084---2019-12-14">[0.8.4] - 2019-12-14</a></h2>
<h3 id="新增-46"><a class="header" href="#新增-46">新增</a></h3>
<ul>
<li>支持 <code>#[text_signature]</code> 属性。<a href="https://github.com/PyO3/pyo3/pull/675">#675</a></li>
</ul>
<h2 id="083---2019-11-23"><a class="header" href="#083---2019-11-23">[0.8.3] - 2019-11-23</a></h2>
<h3 id="移除-11"><a class="header" href="#移除-11">移除</a></h3>
<ul>
<li>移除 <code>#[init]</code>。<a href="https://github.com/PyO3/pyo3/pull/658">#658</a></li>
</ul>
<h3 id="已修复-18"><a class="header" href="#已修复-18">已修复</a></h3>
<ul>
<li>现在所有 <code>&amp;Py~</code> 类型都有 <code>!Send</code> 限定。<a href="https://github.com/PyO3/pyo3/pull/655">#655</a></li>
<li>修复因 <code>!</code> 类型稳定化导致的编译错误。<a href="https://github.com/PyO3/pyo3/issues/672">#672</a>。</li>
</ul>
<h2 id="082---2019-10-27"><a class="header" href="#082---2019-10-27">[0.8.2] - 2019-10-27</a></h2>
<h3 id="新增-47"><a class="header" href="#新增-47">新增</a></h3>
<ul>
<li>为 PEP 590 Vectorcall 提供 FFI 兼容性。<a href="https://github.com/PyO3/pyo3/pull/641">#641</a></li>
</ul>
<h3 id="已修复-19"><a class="header" href="#已修复-19">已修复</a></h3>
<ul>
<li>修复 PySequenceProtocol::set_item。<a href="https://github.com/PyO3/pyo3/pull/624">#624</a></li>
<li>修复 BigInt::FromPyObject 的一个边界情况。<a href="https://github.com/PyO3/pyo3/pull/630">#630</a></li>
<li>修复参数转换中的索引错误。<a href="https://github.com/PyO3/pyo3/pull/631">#631</a></li>
<li>修复 <code>PyString::as_bytes</code> 中无效 UTF-8 序列的处理。<a href="https://github.com/PyO3/pyo3/pull/639">#639</a> 和 <code>PyString::to_string_lossy</code> <a href="https://github.com/PyO3/pyo3/pull/642">#642</a></li>
<li>从 PyMappingProtocol 中移除 <code>__contains__</code> 和 <code>__iter__</code>。<a href="https://github.com/PyO3/pyo3/pull/644">#644</a></li>
<li>修复 PySetAttrProtocol 的过程宏定义。<a href="https://github.com/PyO3/pyo3/pull/645">#645</a></li>
</ul>
<h2 id="081---2019-10-08"><a class="header" href="#081---2019-10-08">[0.8.1] - 2019-10-08</a></h2>
<h3 id="新增-48"><a class="header" href="#新增-48">新增</a></h3>
<ul>
<li>支持 <a href="https://github.com/rust-num/num-bigint">num-bigint</a> 与 Python int 之间的转换。<a href="https://github.com/PyO3/pyo3/pull/608">#608</a></li>
</ul>
<h3 id="已修复-20"><a class="header" href="#已修复-20">已修复</a></h3>
<ul>
<li>确保在 macOS 构建中使用正确的 Python 解释器。<a href="https://github.com/PyO3/pyo3/pull/604">#604</a></li>
<li>修复因 Rust 1.40 导致的特化功能失效问题。<a href="https://github.com/PyO3/pyo3/issues/614">#614</a></li>
<li>修复与 PyErr 相关的段错误。<a href="https://github.com/PyO3/pyo3/pull/597">#597</a></li>
</ul>
<h2 id="080---2019-09-16"><a class="header" href="#080---2019-09-16">[0.8.0] - 2019-09-16</a></h2>
<h3 id="新增-49"><a class="header" href="#新增-49">新增</a></h3>
<ul>
<li><code>pyclass</code> 宏的 <code>module</code> 参数。<a href="https://github.com/PyO3/pyo3/pull/499">#499</a></li>
<li><code>py_run!</code> 宏。<a href="https://github.com/PyO3/pyo3/pull/512">#512</a></li>
<li>在调用自定义 <code>**getattr**</code> 前，优先使用现有字段和方法。<a href="https://github.com/PyO3/pyo3/pull/505">#505</a></li>
<li><code>PyBytes</code> 现在可以像 <code>Vec&lt;u8&gt;</code> 一样被索引</li>
<li>为 <code>PyRef</code> 和 <code>PyRefMut</code> 实现 <code>IntoPy&lt;PyObject&gt;</code></li>
</ul>
<h3 id="更改-21"><a class="header" href="#更改-21">更改</a></h3>
<ul>
<li>使用 <code>pyclass</code> 的 <code>gc</code> 参数（例如 <code>#[pyclass(gc)]</code>）但未实现 <code>class::PyGCProtocol</code> trait 时，现在会触发编译时错误。未实现此 trait 可能导致段错误。<a href="https://github.com/PyO3/pyo3/pull/532">#532</a></li>
<li><code>PyByteArray::data</code> 已被 <code>PyDataArray::to_vec</code> 取代，因为返回 <code>&amp;[u8]</code> 是不安全的。（参见 <a href="https://github.com/PyO3/pyo3/issues/373#issuecomment-512332696">此评论</a> 了解原因）</li>
<li>用 <code>paste</code> 替换 <code>mashup</code></li>
<li><code>GILPool</code> 增加了 <code>Python</code> 标记，以防止在没有持有 GIL 的情况下错误释放 Python 对象</li>
</ul>
<h3 id="移除-12"><a class="header" href="#移除-12">移除</a></h3>
<ul>
<li><code>IntoPyObject</code> 被 <code>IntoPy&lt;PyObject&gt;</code> 替代</li>
<li><code>#[pyclass(subclass)]</code> 被隐藏，移至 <code>unsound-subclass</code> 特性，因为它会导致段错误</li>
</ul>
<h3 id="已修复-21"><a class="header" href="#已修复-21">已修复</a></h3>
<ul>
<li>为 <code>pyclass</code> 中的泛型提供更清晰的错误信息 <a href="https://github.com/PyO3/pyo3/pull/503">#503</a></li>
</ul>
<h2 id="070---2019-05-26"><a class="header" href="#070---2019-05-26">[0.7.0] - 2019-05-26</a></h2>
<h3 id="新增-50"><a class="header" href="#新增-50">新增</a></h3>
<ul>
<li>omerbenamram 在 <a href="https://github.com/PyO3/pyo3/pull/393">#393</a> 中添加了对 PyPy 的支持</li>
<li><code>PyModule</code> 现在生成其成员的索引（即 <code>__all__</code> 列表）</li>
<li>允许 <code>pyclass</code> 使用 <code>slf: PyRef&lt;T&gt;</code> (#419)</li>
<li>允许在 <code>pymethods</code> 中使用生命周期说明符</li>
<li>添加 <code>marshal</code> 模块。<a href="https://github.com/PyO3/pyo3/pull/460">#460</a></li>
</ul>
<h3 id="更改-22"><a class="header" href="#更改-22">更改</a></h3>
<ul>
<li><code>Python::run</code> 返回 <code>PyResult&lt;()&gt;</code> 而不是 <code>PyResult&lt;&amp;PyAny&gt;</code></li>
<li>使用 <code>#[getter]</code> 和 <code>#[setter]</code> 装饰的方法现在可以省略将返回类型包装在 <code>PyResult</code> 中，如果它们不抛出异常</li>
</ul>
<h3 id="已修复-22"><a class="header" href="#已修复-22">已修复</a></h3>
<ul>
<li><code>type_object::PyTypeObject</code> 被标记为 <code>unsafe</code>，因为违反 <code>type_object::PyTypeObject::init_type</code> 约定可能导致未定义行为</li>
<li>在 <a href="https://github.com/PyO3/pyo3/pull/423">#423</a> 中修复了 <code>PySequenceProtocol</code> 的自动派生实现</li>
<li>改进了 README.md 的大小写和措辞</li>
<li>属性的文档字符串现在正确地使用 <code>#[getter]</code> 方法的文档设置</li>
<li>修复了在包含双引号的文档注释中使用 <code>pymethods</code> 时崩溃的问题</li>
<li><code>PySet::new</code> 和 <code>PyFrozenSet::new</code> 现在返回 <code>PyResult&lt;&amp;Py[Frozen]Set&gt;</code>；如果元素不可哈希，则会抛出异常</li>
<li>修复了在 Windows 上使用 <code>venv</code> 构建的问题</li>
<li><code>PyTuple::new</code> 现在返回 <code>&amp;PyTuple</code> 而不是 <code>Py&lt;PyTuple&gt;</code></li>
<li>修复了多个参数解析问题；尤其，<code>*args</code> 和 <code>**kwargs</code> 元组/字典现在不会包含已分配给其他参数的值</li>
</ul>
<h2 id="060---2019-03-28"><a class="header" href="#060---2019-03-28">[0.6.0] - 2019-03-28</a></h2>
<h3 id="回归问题"><a class="header" href="#回归问题">回归问题</a></h3>
<ul>
<li>目前，<a href="https://github.com/PyO3/pyo3/issues/341">#341</a> 导致在启用 <code>extension-module</code> 功能时 <code>cargo test</code> 因奇怪的链接错误而失败。暂时可通过将 <code>extension-module</code> 功能设为可选，并使用 <code>cargo test --no-default-features</code> 运行测试来规避：</li>
</ul>
<pre><code class="language-toml">[dependencies.pyo3]
version = "0.6.0"

[features]
extension-module = ["pyo3/extension-module"]
default = ["extension-module"]
</code></pre>
<h3 id="新增-51"><a class="header" href="#新增-51">新增</a></h3>
<ul>
<li>添加了类似于 <code>wrap_pyfunction!</code> 的 <code>wrap_pymodule!</code> 宏。仅在 Python 3 上可用</li>
<li>mtp401 在 <a href="https://github.com/PyO3/pyo3/pull/327">#327</a> 中添加了对交叉编译（例如到 arm v7）的支持。详见指南中“构建与发布”章节的“交叉编译”部分</li>
<li><code>PyRef</code> 和 <code>PyRefMut</code> 类型，用于区分位于 Rust 堆上的 Rust 结构实例与嵌入在 Python 对象中的实例。由 kngwyu 在 <a href="https://github.com/PyO3/pyo3/pull/335">#335</a> 中添加</li>
<li>添加 <code>FromPy&lt;T&gt;</code> 和 <code>IntoPy&lt;T&gt;</code>，它们等同于 <code>From&lt;T&gt;</code> 和 <code>Into&lt;T&gt;</code>，但要求提供 GIL token</li>
<li>添加 <code>ManagedPyRef</code>，其最终将替代 <code>ToBorrowedObject</code></li>
</ul>
<h3 id="更改-23"><a class="header" href="#更改-23">更改</a></h3>
<ul>
<li>在 #388 中将 <code>PyObjectRef</code> 重命名为 <code>PyAny</code></li>
<li><code>add_function</code> 重命名为 <code>add_wrapped</code>，因为它现在也支持模块</li>
<li><code>#[pymodinit]</code> 重命名为 <code>#[pymodule]</code></li>
<li><code>py.init(|| value)</code> 变为 <code>Py::new(value)</code></li>
<li><code>py.init_ref(|| value)</code> 变为 <code>PyRef::new(value)</code></li>
<li><code>py.init_mut(|| value)</code> 变为 <code>PyRefMut::new(value)</code></li>
<li><code>PyRawObject::init</code> 现在是无失败的，即返回 <code>()</code> 而非 <code>PyResult&lt;()&gt;</code></li>
<li><code>py_exception!</code> 重命名为 <code>create_exception!</code> 并重构了错误宏</li>
<li><code>wrap_function!</code> 重命名为 <code>wrap_pyfunction!</code></li>
<li><code>#[prop(get, set)]</code> 重命名为 <code>#[pyo3(get, set)]</code></li>
<li><code>#[pyfunction]</code> 现在支持与 <code>#[pyfn()]</code> 相同的参数</li>
<li>一些宏现在发出正确的带位置错误而非 panic</li>
<li>迁移到 2018 版</li>
<li><code>crate::types::exceptions</code> 移至 <code>crate::exceptions</code></li>
<li>用 <code>IntoPy&lt;Py&lt;PyTuple&gt;&gt;</code> 替代 <code>IntoPyTuple</code></li>
<li><code>IntoPyPointer</code> 和 <code>ToPyPointer</code> 移至 crate 根目录</li>
<li><code>class::CompareOp</code> 移至 <code>class::basic::CompareOp</code></li>
<li>PyTypeObject 现为 PyTypeCreate 的直接子 trait，移除了 <a href="https://github.com/PyO3/pyo3/pull/350">#350</a> 中的循环实现</li>
<li>chr1sj0nes 在 <a href="https://github.com/PyO3/pyo3/pull/357">#357</a> 和 <a href="https://github.com/PyO3/pyo3/pull/358">#358</a> 中添加 <code>PyList::{sort, reverse}</code></li>
<li>将 <code>typeob</code> 模块重命名为 <code>type_object</code></li>
</ul>
<h3 id="移除-13"><a class="header" href="#移除-13">移除</a></h3>
<ul>
<li>由于不安全性移除了 <code>PyToken</code>（见 <a href="https://github.com/PyO3/pyo3/issues/94">#94</a>）</li>
<li>移除了 <code>PyObjectAlloc</code> 中不必要的类型参数</li>
<li><code>NoArgs</code>。请直接使用空元组</li>
<li><code>PyObjectWithGIL</code>。现在 <code>PyNativeType</code> 已足够，因为 PyToken 已被移除</li>
</ul>
<h3 id="已修复-23"><a class="header" href="#已修复-23">已修复</a></h3>
<ul>
<li>修复了 <code>#[pyclass]</code> 结构体的每个实例都被视为 Python 对象一部分的安全性漏洞，尽管可以创建不在 Python 堆中的实例。该问题通过 <code>PyRef</code> 和 <code>PyRefMut</code> 得到修复</li>
<li>在 <a href="https://github.com/PyO3/pyo3/pull/328">#328</a> 中修复 kwargs 支持</li>
<li>在 <a href="https://github.com/PyO3/pyo3/pull/403">#403</a> 中添加对 <code>__dict__</code> 的完整支持</li>
</ul>
<h2 id="053---2019-01-04"><a class="header" href="#053---2019-01-04">[0.5.3] - 2019-01-04</a></h2>
<h3 id="已修复-24"><a class="header" href="#已修复-24">已修复</a></h3>
<ul>
<li>kngwyu 在 <a href="https://github.com/PyO3/pyo3/pull/316">#316</a> 中修复 ArrayList 的内存泄漏问题</li>
</ul>
<h2 id="052---2018-11-25"><a class="header" href="#052---2018-11-25">[0.5.2] - 2018-11-25</a></h2>
<h3 id="已修复-25"><a class="header" href="#已修复-25">已修复</a></h3>
<ul>
<li>kngwyu 在 <a href="https://github.com/PyO3/pyo3/pull/281">#281</a> 中修复创建大量对象时的不确定段错误问题</li>
</ul>
<h2 id="051---2018-11-24"><a class="header" href="#051---2018-11-24">[0.5.1] - 2018-11-24</a></h2>
<p>已撤销发布</p>
<h2 id="050---2018-11-11"><a class="header" href="#050---2018-11-11">[0.5.0] - 2018-11-11</a></h2>
<h3 id="新增-52"><a class="header" href="#新增-52">新增</a></h3>
<ul>
<li><code>#[pyclass]</code> 对象现在可从 Rust 函数中返回- <code>PyComplex</code>，由 kngwyu 在 <a href="https://github.com/PyO3/pyo3/pull/226">#226</a> 中实现</li>
<li><code>PyDict::from_sequence</code>，等价于 <code>dict([(key, val), ...])</code></li>
<li>为标准库 <code>datetime</code> 类型提供绑定：<code>PyDate</code>、<code>PyTime</code>、<code>PyDateTime</code>、<code>PyTzInfo</code>、<code>PyDelta</code>，并附带相应的 <code>ffi</code> 类型，由 pganssle 在 <a href="https://github.com/PyO3/pyo3/pull/200">#200</a> 中实现</li>
<li><code>PyString</code>、<code>PyUnicode</code> 和 <code>PyBytes</code> 现在拥有 <code>as_bytes</code> 方法，返回 <code>&amp;[u8]</code></li>
<li><code>PyObjectProtocol::get_type_ptr</code>，由 ijl 在 <a href="https://github.com/PyO3/pyo3/pull/242">#242</a> 中实现</li>
</ul>
<h3 id="更改-24"><a class="header" href="#更改-24">更改</a></h3>
<ul>
<li>将类型从根模块和预导入模块（prelude）中移除，现存放于 <code>pyo3::types</code> 中</li>
<li>所有异常均使用 <code>py_err</code> 而非 <code>new</code> 构造，因为它们返回 <code>PyErr</code> 而非 <code>Self</code></li>
<li><code>as_mut</code> 及其相关方法现在接收 <code>&amp;mut self</code> 而非 <code>&amp;self</code></li>
<li><code>ObjectProtocol::call</code> 现在接收 <code>Option&lt;&amp;PyDict&gt;</code> 作为 kwargs 参数，而非 <code>IntoPyDictPointer</code></li>
<li><code>IntoPyDictPointer</code> 被 <code>IntoPyDict</code> 替代，后者不再转换 <code>PyDict</code> 自身，且返回 <code>PyDict</code> 而非 <code>*mut PyObject</code></li>
<li><code>PyTuple::new</code> 现在接收 <code>IntoIterator</code> 而非 slice</li>
<li>升级至 syn 0.15</li>
<li>将 <code>PyTypeObject</code> 拆分为不带 create 方法的 <code>PyTypeObject</code> 和要求 <code>PyObjectAlloc&lt;Self&gt; + PyTypeInfo + Sized</code> 的 <code>PyTypeCreate</code></li>
<li>执行 <code>cargo edition --fix</code>，为 Rust 2018 版本在路径前添加 <code>crate::</code></li>
<li>将 <code>async</code> 重命名为 <code>pyasync</code>，因为 <code>async</code> 将在 2018 版中成为关键字</li>
<li>开始使用 <code>NonNull&lt;*mut PyObject&gt;</code> 表示 <code>Py</code> 和 <code>PyObject</code>，由 ijl 在 <a href="https://github.com/PyO3/pyo3/pull/260">#260</a> 中实现</li>
</ul>
<h3 id="移除-14"><a class="header" href="#移除-14">移除</a></h3>
<ul>
<li>从 prelude 中移除了大多数条目，新的 prelude 更简洁清晰</li>
<li>逐步移除对特化（specialization）的使用</li>
<li><code>PyString</code>、<code>PyUnicode</code> 和 <code>PyBytes</code> 不再有 <code>data</code> 方法（已被 <code>as_bytes</code> 替代），同时移除了 <code>PyStringData</code></li>
<li><code>pyobject_extract</code> 宏</li>
</ul>
<h3 id="修复-46"><a class="header" href="#修复-46">修复</a></h3>
<ul>
<li>增加了说明：即使持有 GILGuard，GIL 仍可能被临时释放</li>
<li>修复了大量 clippy 错误</li>
<li>修复了在 PyObject 上调用未知方法时的段错误</li>
<li>通过 kngwyu 在 <a href="https://github.com/PyO3/pyo3/pull/252">#252</a> 中的工作，绕过了 <a href="https://github.com/rust-lang/rust/issues/55380">Rust 编译器的一个 bug</a></li>
<li>修复了通过子类继承 PyO3 创建的类并使用 <code>__class__</code> 时的段错误，由 kngwyu 在 <a href="https://github.com/PyO3/pyo3/pull/263">#263</a> 中实现</li>
</ul>
<h2 id="041---2018-08-20"><a class="header" href="#041---2018-08-20">[0.4.1] - 2018-08-20</a></h2>
<h3 id="更改-25"><a class="header" href="#更改-25">更改</a></h3>
<ul>
<li>PyTryFrom 的错误总是 <code>PyDowncastError</code></li>
</ul>
<h3 id="修复-47"><a class="header" href="#修复-47">修复</a></h3>
<ul>
<li>修复了在夜间版本（nightly）上无法编译的问题，因为 <code>use_extern_macros</code> 已稳定</li>
</ul>
<h3 id="移除-15"><a class="header" href="#移除-15">移除</a></h3>
<ul>
<li><code>pyobject_downcast</code> 宏</li>
</ul>
<h2 id="040---2018-07-30"><a class="header" href="#040---2018-07-30">[0.4.0] - 2018-07-30</a></h2>
<h3 id="更改-26"><a class="header" href="#更改-26">更改</a></h3>
<ul>
<li>将两个示例合并为一个</li>
<li>所有代码使用 rustfmt 格式化 :heavy_check_mark:</li>
<li>改为使用 <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a></li>
</ul>
<h3 id="移除-16"><a class="header" href="#移除-16">移除</a></h3>
<ul>
<li>由于 <a href="https://github.com/rust-lang/rust/issues/52050">rust-lang/rust#52050</a>，移除了元组到 PyDict 的转换</li>
</ul>
<h2 id="032---2018-07-22"><a class="header" href="#032---2018-07-22">[0.3.2] - 2018-07-22</a></h2>
<h3 id="更改-27"><a class="header" href="#更改-27">更改</a></h3>
<ul>
<li>用 mashup 替代 <code>concat_idents</code></li>
</ul>
<h2 id="031---2018-07-18"><a class="header" href="#031---2018-07-18">[0.3.1] - 2018-07-18</a></h2>
<h3 id="修复-48"><a class="header" href="#修复-48">修复</a></h3>
<ul>
<li>修复了 pyobject_native_type 宏中的作用域 bug，该 bug 会导致 rust-numpy 出现问题</li>
</ul>
<h2 id="030---2018-07-18"><a class="header" href="#030---2018-07-18">[0.3.0] - 2018-07-18</a></h2>
<h3 id="新增-53"><a class="header" href="#新增-53">新增</a></h3>
<ul>
<li>一些内部宏成为公共 API 的一部分（<a href="https://github.com/PyO3/pyo3/pull/155">#155</a>，<a href="https://github.com/PyO3/pyo3/pull/186">#186</a>）</li>
<li>获取器（getters）中始终进行克隆（clone），允许在所有 Clone 类型上使用 get 注解</li>
</ul>
<h3 id="更改-28"><a class="header" href="#更改-28">更改</a></h3>
<ul>
<li>升级至 syn 0.14，带来更好的错误提示 :tada:</li>
<li>支持 128 位整数，由 <a href="https://github.com/kngwyu">kngwyu</a> 实现 (<a href="https://github.com/PyO3/pyo3/pull/173">#137</a>)</li>
<li><code>proc_macro</code> 已在 nightly 版本中稳定 (<a href="https://github.com/rust-lang/rust/pull/52081">rust-lang/rust#52081</a>)，这意味着可以移除 <code>proc_macro</code> 特性，但需要使用 2018 版本中的 <code>use_extern_macros</code></li>
<li>所有过程宏均以 <code>py</code> 为前缀并位于 prelude 模块中，因此可直接使用 <code>#[pyclass]</code>、<code>#[pymethods]</code>、<code>#[pyproto]</code>、<code>#[pyfunction]</code> 和 <code>#[pymodinit]</code>（前提是使用 <code>use pyo3::prelude::*</code>），它们也被移至名为 <code>proc_macro</code> 的模块中。不应使用 <code>#[pyo3::proc_macro::pyclass]</code> 等较长路径，因为 <code>proc_macro_path_invoc</code> 无法很快稳定</li>
<li>将 <code>pyclass</code> 宏中的 <code>base</code> 选项重命名为 <code>extends</code></li>
<li><code>#[pymodinit]</code> 使用函数名作为模块名，除非通过 <code>#[pymodinit(name)]</code> 显式指定名称</li>
<li>文档指南（guide）已具备版本控制</li>
</ul>
<h2 id="027---2018-05-18"><a class="header" href="#027---2018-05-18">[0.2.7] - 2018-05-18</a></h2>
<h3 id="修复-49"><a class="header" href="#修复-49">修复</a></h3>
<ul>
<li>修复 nightly 版本中因 proc_macro_path 导致的构建错误</li>
</ul>
<h2 id="026---2018-04-03"><a class="header" href="#026---2018-04-03">[0.2.6] - 2018-04-03</a></h2>
<h3 id="修复-50"><a class="header" href="#修复-50">修复</a></h3>
<ul>
<li>修复与 TryFrom trait 的兼容性问题 #137</li>
</ul>
<h2 id="025---2018-02-21"><a class="header" href="#025---2018-02-21">[0.2.5] - 2018-02-21</a></h2>
<h3 id="新增-54"><a class="header" href="#新增-54">新增</a></h3>
<ul>
<li>支持 CPython 3.7</li>
</ul>
<h3 id="修复-51"><a class="header" href="#修复-51">修复</a></h3>
<ul>
<li>修复嵌入 CPython 3.7b1 在初始化时崩溃的问题 #110</li>
<li>修复生成的扩展函数类型较弱的问题 #108</li>
<li>修复 <code>call_method*</code> 在方法不存在时崩溃的问题 #113</li>
<li>允许从嵌套模块导入异常 #116</li>
</ul>
<h2 id="024---2018-01-19"><a class="header" href="#024---2018-01-19">[0.2.4] - 2018-01-19</a></h2>
<h3 id="新增-55"><a class="header" href="#新增-55">新增</a></h3>
<ul>
<li>允许从 PyObject 获取可变引用 #106</li>
<li>移除 <code>RefFromPyObject</code> trait</li>
<li>添加 <code>Python::register_any</code> 方法</li>
</ul>
<h3 id="修复-52"><a class="header" href="#修复-52">修复</a></h3>
<ul>
<li>修复 <code>Py&lt;T&gt;</code> 的 <code>FromPyObject</code> 实现</li>
<li>将操作原始指针的方法标记为 unsafe #95</li>
</ul>
<h2 id="023---2017-11-27"><a class="header" href="#023---2017-11-27">[0.2.3] - 2017-11-27</a></h2>
<h3 id="更改-29"><a class="header" href="#更改-29">更改</a></h3>
<ul>
<li>升级至 Rust 1.23.0-nightly (2017-11-07)</li>
</ul>
<h3 id="修复-53"><a class="header" href="#修复-53">修复</a></h3>
<ul>
<li>正确使用 <code>c_char</code> #93</li>
</ul>
<h3 id="移除-17"><a class="header" href="#移除-17">移除</a></h3>
<ul>
<li>移除不再需要的 ‘AsciiExt’ trait</li>
</ul>
<h2 id="022---2017-09-26"><a class="header" href="#022---2017-09-26">[0.2.2] - 2017-09-26</a></h2>
<h3 id="更改-30"><a class="header" href="#更改-30">更改</a></h3>
<ul>
<li>升级至 Rust 1.22.0-nightly (2017-09-30)</li>
</ul>
<h2 id="021---2017-09-26"><a class="header" href="#021---2017-09-26">[0.2.1] - 2017-09-26</a></h2>
<h3 id="修复-54"><a class="header" href="#修复-54">修复</a></h3>
<ul>
<li>修复 rustc const_fn 在 nightly 版本中的构建问题</li>
</ul>
<h2 id="020---2017-08-12"><a class="header" href="#020---2017-08-12">[0.2.0] - 2017-08-12</a></h2>
<h3 id="新增-56"><a class="header" href="#新增-56">新增</a></h3>
<ul>
<li>添加继承支持 #15</li>
<li>添加弱引用（weakref）支持 #56</li>
<li>添加子类支持 #64</li>
<li>添加 <code>self.__dict__</code> 支持 #68</li>
<li>添加 <code>pyo3::prelude</code> 模块 #70</li>
<li>改进 PyTuple、PyList、PyDict 的 <code>Iterator</code> 支持 #75</li>
<li>引入 <code>IntoPyDictPointer</code>，类似于 <code>IntoPyTuple</code> #69</li>
</ul>
<h3 id="更改-31"><a class="header" href="#更改-31">更改</a></h3>
<ul>
<li>允许在不实现 <code>PyGCProtocol</code> 的情况下添加 GC 支持 #57</li>
<li>重构 <code>PyErr</code> 的实现，构造函数中移除 <code>py</code> 参数</li>
</ul>
<h2 id="010---2017-07-23"><a class="header" href="#010---2017-07-23">[0.1.0] - 2017-07-23</a></h2>
<h3 id="新增-57"><a class="header" href="#新增-57">新增</a></h3>
<ul>
<li>初始发布[0.12.3]: https://github.com/pyo3/pyo3/compare/v0.12.2…v0.12.3
[0.12.2]: https://github.com/pyo3/pyo3/compare/v0.12.1…v0.12.2
[0.12.1]: https://github.com/pyo3/pyo3/compare/v0.12.0…v0.12.1
[0.12.0]: https://github.com/pyo3/pyo3/compare/v0.11.1…v0.12.0
[0.11.1]: https://github.com/pyo3/pyo3/compare/v0.11.0…v0.11.1
[0.11.0]: https://github.com/pyo3/pyo3/compare/v0.10.1…v0.11.0
[0.10.1]: https://github.com/pyo3/pyo3/compare/v0.10.0…v0.10.1
[0.10.0]: https://github.com/pyo3/pyo3/compare/v0.9.2…v0.10.0
[0.9.2]: https://github.com/pyo3/pyo3/compare/v0.9.1…v0.9.2
[0.9.1]: https://github.com/pyo3/pyo3/compare/v0.9.0…v0.9.1
[0.9.0]: https://github.com/pyo3/pyo3/compare/v0.8.5…v0.9.0
[0.8.5]: https://github.com/pyo3/pyo3/compare/v0.8.4…v0.8.5
[0.8.4]: https://github.com/pyo3/pyo3/compare/v0.8.3…v0.8.4
[0.8.3]: https://github.com/pyo3/pyo3/compare/v0.8.2…v0.8.3
[0.8.2]: https://github.com/pyo3/pyo3/compare/v0.8.1…v0.8.2
[0.8.1]: https://github.com/pyo3/pyo3/compare/v0.8.0…v0.8.1
[0.8.0]: https://github.com/pyo3/pyo3/compare/v0.7.0…v0.8.0
[0.7.0]: https://github.com/pyo3/pyo3/compare/v0.6.0…v0.7.0
[0.6.0]: https://github.com/pyo3/pyo3/compare/v0.5.3…v0.6.0
[0.5.3]: https://github.com/pyo3/pyo3/compare/v0.5.2…v0.5.3
[0.5.2]: https://github.com/pyo3/pyo3/compare/v0.5.1…v0.5.2
[0.5.1]: https://github.com/pyo3/pyo3/compare/v0.5.0…v0.5.1
[0.5.0]: https://github.com/pyo3/pyo3/compare/v0.4.1…v0.5.0
[0.4.1]: https://github.com/pyo3/pyo3/compare/v0.4.0…v0.4.1
[0.4.0]: https://github.com/pyo3/pyo3/compare/v0.3.2…v0.4.0
[0.3.2]: https://github.com/pyo3/pyo3/compare/v0.3.1…v0.3.2
[0.3.1]: https://github.com/pyo3/pyo3/compare/v0.3.0…v0.3.1
[0.3.0]: https://github.com/pyo3/pyo3/compare/v0.2.7…v0.3.0
[0.2.7]: https://github.com/pyo3/pyo3/compare/v0.2.6…v0.2.7
[0.2.6]: https://github.com/pyo3/pyo3/compare/v0.2.5…v0.2.6
[0.2.5]: https://github.com/pyo3/pyo3/compare/v0.2.4…v0.2.5
[0.2.4]: https://github.com/pyo3/pyo3/compare/v0.2.3…v0.2.4
[0.2.3]: https://github.com/pyo3/pyo3/compare/v0.2.2…v0.2.3
[0.2.2]: https://github.com/pyo3/pyo3/compare/v0.2.1…v0.2.2
[0.2.1]: https://github.com/pyo3/pyo3/compare/v0.2.0…v0.2.1
[0.2.0]: https://github.com/pyo3/pyo3/compare/v0.1.0…v0.2.0
[0.1.0]: https://github.com/PyO3/pyo3/tree/0.1.0</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="python-typing-hints.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="contributing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="python-typing-hints.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="contributing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/tabs-6977231d.js"></script>



    </div>
    </body>
</html>
